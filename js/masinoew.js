(function(t,a,n){"use strict";function i(){return Et?yt:(Et=1,function(e){!function(){function t(e){return n(i(e),arguments)}function a(e,a){return t.apply(null,[e].concat(a||[]))}function n(e,a){var n=1,r=e.length,s="",o,l,c,u,p,g,f,m,h;for(l=0;l<r;l++)if("string"==typeof e[l])s+=e[l];else if("object"==typeof e[l]){if(u=e[l],u.keys)for(o=a[n],c=0;c<u.keys.length;c++){if(null==o)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',u.keys[c],u.keys[c-1]));o=o[u.keys[c]]}else o=u.param_no?a[u.param_no]:a[n++];if(d.not_type.test(u.type)&&d.not_primitive.test(u.type)&&o instanceof Function&&(o=o()),d.numeric_arg.test(u.type)&&"number"!=typeof o&&isNaN(o))throw new TypeError(t("[sprintf] expecting number but found %T",o));switch(d.number.test(u.type)&&(m=0<=o),u.type){case"b":o=parseInt(o,10).toString(2);break;case"c":o=String.fromCharCode(parseInt(o,10));break;case"d":case"i":o=parseInt(o,10);break;case"j":o=JSON.stringify(o,null,u.width?parseInt(u.width):0);break;case"e":o=u.precision?parseFloat(o).toExponential(u.precision):parseFloat(o).toExponential();break;case"f":o=u.precision?parseFloat(o).toFixed(u.precision):parseFloat(o);break;case"g":o=u.precision?+o.toPrecision(u.precision)+"":parseFloat(o);break;case"o":o=(parseInt(o,10)>>>0).toString(8);break;case"s":o+="",o=u.precision?o.substring(0,u.precision):o;break;case"t":o=!!o+"",o=u.precision?o.substring(0,u.precision):o;break;case"T":o=Object.prototype.toString.call(o).slice(8,-1).toLowerCase(),o=u.precision?o.substring(0,u.precision):o;break;case"u":o=parseInt(o,10)>>>0;break;case"v":o=o.valueOf(),o=u.precision?o.substring(0,u.precision):o;break;case"x":o=(parseInt(o,10)>>>0).toString(16);break;case"X":o=(parseInt(o,10)>>>0).toString(16).toUpperCase()}d.json.test(u.type)?s+=o:(d.number.test(u.type)&&(!m||u.sign)?(h=m?"+":"-",o=o.toString().replace(d.sign,"")):h="",g=u.pad_char?"0"===u.pad_char?"0":u.pad_char.charAt(1):" ",f=u.width-(h+o).length,p=u.width?0<f?g.repeat(f):"":"",s+=u.align?h+o+p:"0"===g?h+p+o:p+h+o)}return s}function i(e){if(r[e])return r[e];for(var t=e,a=[],n=0,i;t;){if(null!==(i=d.text.exec(t)))a.push(i[0]);else if(null!==(i=d.modulo.exec(t)))a.push("%");else if(null!==(i=d.placeholder.exec(t))){if(i[2]){n|=1;var s=[],o=i[2],l=[];if(null!==(l=d.key.exec(o))){for(s.push(l[1]);""!==(o=o.substring(l[0].length));)if(null!==(l=d.key_access.exec(o)))s.push(l[1]);else if(null!==(l=d.index_access.exec(o)))s.push(l[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key")}else throw new SyntaxError("[sprintf] failed to parse named argument key");i[2]=s}else n|=2;if(3===n)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");a.push({placeholder:i[0],param_no:i[1],keys:i[2],sign:i[3],pad_char:i[4],align:i[5],width:i[6],precision:i[7],type:i[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");t=t.substring(i[0].length)}return r[e]=a}var d={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},r=Object.create(null);e.sprintf=t,e.vsprintf=a,"undefined"!=typeof window&&(window.sprintf=t,window.vsprintf=a)}()}(yt),yt)}function d(e){return function(t){let a=ew.parseNumber(ew.getValue(t)),n;if(e="function"==typeof e?e():e,e instanceof HTMLElement?n=ew.parseNumber(ew.getValue(e)):"string"==typeof e?n=ew.parseNumber(e):"number"==typeof e&&(n=e),"number"==typeof a&&"number"==typeof n){var i;if(a<n)return{min:_t.sprintf(ew.language.phrase(null==(i=t.dataset.error)?"IncorrectMin":i),n)}}return!1}}function r(e){return function(t){let a=ew.parseNumber(ew.getValue(t)),n;if(e="function"==typeof e?e():e,e instanceof HTMLElement?n=ew.parseNumber(ew.getValue(e)):"string"==typeof e?n=ew.parseNumber(e):"number"==typeof e&&(n=e),"number"==typeof a&&"number"==typeof n){var i;if(a>n)return{max:_t.sprintf(ew.language.phrase(null==(i=t.dataset.error)?"IncorrectMax":i),n)}}return!1}}function s(e){"@babel/helpers - typeof";return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(a,t){if("object"!=s(a)||!a)return a;var n=a[Symbol.toPrimitive];if(void 0!==n){var e=n.call(a,t||"default");if("object"!=s(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(a)}function l(e){var t=o(e,"string");return"symbol"==s(t)?t:t+""}function c(a,e){for(var n=0,i;n<e.length;n++)i=e[n],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,l(i.key),i)}function u(a,e,n){return e&&c(a.prototype,e),n&&c(a,n),Object.defineProperty(a,"prototype",{writable:!1}),a}function p(a,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,t){return a.__proto__=t,a},p(a,t)}function g(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,p(e,t)}function f(a,e,n){return(e=l(e))in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){var e;let n=null==(e=null==t?void 0:t.target)?document:e,i={...ew.tooltipOptions,container:"body",trigger:ew.IS_MOBILE?"manual":"hover"};a(n).find(".ew-icon").closest(".btn, .ew-home, .ew-row-link:not(.dropdown-item)").each((function(){let e=a(this);if(e.hasClass("dropdown-toggle")){let t=e.closest(".btn-group");1==t.children(".btn").length&&(t.tooltip({...i,title:this.dataset.title||this.title}).on("mouseleave",(t=>{var e;return null==(e=bootstrap.Tooltip.getInstance(t.currentTarget))?void 0:e.hide()})),e.next(".dropdown-menu").on("mouseover",(t=>t.stopPropagation())))}else e.tooltip(i)}))}function b(t){var e=null==(n=null==t?void 0:t.target)?document:n,n;a.fn.pStrength&&"undefined"!=typeof ew.MIN_PASSWORD_STRENGTH&&a(e).find(".ew-password-strength").each((function(){var e=a(this);e.data("pStrength")||e.pStrength({changeBackground:!1,backgrounds:[],passwordValidFrom:ew.MIN_PASSWORD_STRENGTH,onPasswordStrengthChanged:function(e,t){var n=a("[id='"+this.attr("data-password-strength")+"']"),i=n.find(".progress-bar");if(this.val()&&!ew.isMaskedPassword(this)){var d=t+"%",r=ew.MIN_PASSWORD_STRENGTH,s=t>=r;t<.25*r?i.addClass("text-bg-danger").removeClass("text-bg-warning text-bg-info text-bg-success"):t<.5*r?i.addClass("text-bg-warning").removeClass("text-bg-danger text-bg-info text-bg-success"):t<.75*r?i.addClass("text-bg-primary").removeClass("text-bg-danger text-bg-warning text-bg-success"):i.addClass("text-bg-success").removeClass("text-bg-danger text-bg-warning text-bg-info"),i.css("width",d),t>.5*r&&(d=sprintf(ew.language.phrase("PasswordStrength"),d)),i.html(d),n.removeClass("d-none"),this.data("validated",s),s&&ce(this[0])}else n.addClass("d-none"),this.data("validated",null);n.width(this.outerWidth())}})})),a.fn.pGenerator&&a(e).find(".ew-password-generator").each((function(){var e=a(this);e.data("pGenerator")||e.pGenerator({passwordLength:ew.GENERATE_PASSWORD_LENGTH,uppercase:ew.GENERATE_PASSWORD_UPPERCASE,lowercase:ew.GENERATE_PASSWORD_LOWERCASE,numbers:ew.GENERATE_PASSWORD_NUMBER,specialChars:ew.GENERATE_PASSWORD_SPECIALCHARS,onPasswordGenerated:function(e){a("#"+this.attr("data-password-confirm")).val(e),a("#"+this.attr("data-password-field")).val(e).trigger("change").trigger("focus").triggerHandler("click")}})}))}function w(e,t){var n=ew.PATH_BASE+ew.API_URL,i=t instanceof URLSearchParams?t:new URLSearchParams(t),d=i.toString();if(a.isString(e))n+=e?e:"";else if(Array.isArray(e)){var r=e.map((function(e){return encodeURIComponent(e)})).join("/");n+=r?r:""}return n+(d?"?"+d:"")}function y(e){var t,a;let n,i,d;[n,d]=e.split("#"),[n,i]=n.split("?"),!i&&n.includes("=")&&([n,i]=["",n]);let r={url:e,pathname:null==(t=n)?"":t,hash:null==(a=d)?"":a,searchParams:new URLSearchParams(i)};return Object.defineProperty(r,"search",{value:i,writable:!1,enumerable:!0}),r}function _(e){try{return new URLSearchParams(e)}catch(t){return console.log(t),new URLSearchParams}}function v(e){return y(e).searchParams}function E(e){let t=y(e);for(var a=arguments.length,n=Array(1<a?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];return t.searchParams=A(t.searchParams,...n),x(t)}function A(){let e=new URLSearchParams;for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const t of n)if(a.isObject(t)||a.isString(t)&&t){let a=t instanceof URLSearchParams?t:_(t);a.forEach(((t,a)=>e.has(a)?a.endsWith("[]")?e.append(a,t):e.set(a,t):e.set(a,t)))}return e}function S(e,t,a){return E(e,{[t]:a})}function T(e){let t=y(e);for(var a=arguments.length,n=Array(1<a?a-1:0),i=1;i<a;i++)n[i-1]=arguments[i];return n.forEach((e=>t.searchParams.delete(e))),x(t)}function x(e){let t=e.searchParams.toString();return e.pathname+(e.pathname&&t?"?":"")+t+(e.hash?"#"+e.hash:"")}function I(e,t){return e&&"#"!=e?E(e,{[ew.PAGE_LAYOUT]:t+""}):e}function O(e){let t=y(e),a=t.searchParams;return a.forEach(((e,t)=>{e=decodeURIComponent(e),["<>","<=",">=",">","<"].includes(e)?a.set(t,e):a.set(t,ew.sanitize(e))})),x(t)}function C(t){var e;let n=a(null==(e=null==t?void 0:t.target)?document:e);null!=t&&t.target&&!n.find("a.ew-export-link[href]")[0]&&(n=n.closest(".content")),n.find("a.ew-export-link[href]:not(.ew-email):not(.ew-print):not(.ew-xml)").on("click",(function(t){let e=this.href;e&&"#"!=e&&R(e,Q()),t.preventDefault()})),n.find("a.ew-export-link[href].ew-print, a.ew-export-link[href].ew-xml").each((function(){let e=new URL(this.href);e.searchParams.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME),e.searchParams.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN),this.href=e.pathname+e.search}))}function N(t){var e=null==(r=null==t?void 0:t.target)?document:r,n=a(e),i=n.find("input[type=checkbox].ew-multi-select"),d=function(e){var t=i.filter("[name^='"+e+"_']"),n=t.length,d=t.filter(":checked").length;a("input[type=checkbox]#"+e).prop("checked",d==n).prop("indeterminate",d!=n&&0!=d)},r;i.on("change",(t=>d(t.target.name.split("_")[0]))),n.find("input[type=checkbox].ew-priv:not(.ew-multi-select)").each(((e,t)=>d(t.id)))}function P(e){var t,n;return e&&((null==(t=e.error)?void 0:t.description)||(null==(n=e.error)?void 0:n.message)||a.isString(e.error)&&e.error||e.failureMessage||!1===e.success&&e.message||null)}function R(e,t){let n=e.includes("export=html")||e.includes(w([ew.API_EXPORT_ACTION,"html"])),i=window.parent.Swal;return t=A(t,[[ew.TOKEN_NAME_KEY,ew.TOKEN_NAME],[ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN]]),i.fire({...ew.sweetAlertSettings,showConfirmButton:!1,html:"<p>"+ew.language.phrase("Exporting")+"</p>",allowOutsideClick:!1,allowEscapeKey:!1,willOpen:()=>{i.showLoading(),Le(e,{method:t?"POST":"GET",body:t||null}).then((async t=>{let a=t.headers.get("Content-Type");if(null!=a&&a.includes("json")){var d;let a=await t.json(),n=null==(d=P(a))?ew.language.phrase("FailedToExport"):d;n&&(i.hideLoading(),i.update({html:"<div class='text-danger'>"+n+"</div>",showConfirmButton:!0}),Ra.trigger("export",[{type:"fail",url:e}]))}else{let d=n?await t.text():await t.blob(),r=URL.createObjectURL(n?new Blob([d],{type:"text/html"}):d),s=document.createElement("a"),a=t.headers.get("Content-Disposition"),o=null==a?void 0:a.match(/\bfilename=((['"])(.+)\2|([^;]+))/i);s.style.display="none",s.href=r,o&&(s.download=o[3]||o[4]),document.body.appendChild(s),s.click(),Ra.trigger("export",[{type:"done",url:e,objectUrl:r}]),URL.revokeObjectURL(r),i.close()}})).catch((t=>{i.hideLoading(),i.update({html:"<div class='text-danger'>"+t+"</div>",showConfirmButton:!0}),Ra.trigger("export",[{type:"fail",url:e}])})).finally((()=>{Ra.trigger("export",[{type:"always",url:e}])}))}})}function F(t){var e;if(ew.LAZY_LOAD){var a=null==(e=null==t?void 0:t.target)?document:e;a.querySelectorAll("img.ew-lazy").forEach(((e,t)=>{0<ew.LAZY_LOAD_DELAY?setTimeout((()=>e.src=e.dataset.src),t*ew.LAZY_LOAD_DELAY):e.src=e.dataset.src})),Ra.trigger("lazyload")}}function k(t){var e;if(ew.USE_COLORBOX){var n=null==(e=null==t?void 0:t.target)?document:e,i=Object.assign({},ew.lightboxSettings,{title:ew.language.phrase("LightboxTitle"),current:ew.language.phrase("LightboxCurrent"),previous:ew.language.phrase("LightboxPrevious"),next:ew.language.phrase("LightboxNext"),close:ew.language.phrase("LightboxClose"),xhrError:ew.language.phrase("LightboxXhrError"),imgError:ew.language.phrase("LightboxImgError")});a(n).find(".ew-lightbox").each((function(){var e=a(this);e.colorbox(Object.assign({rel:e.data("rel")},i))}))}}function L(t){var e;if(!ew.EMBED_PDF)return;let n=null==(e=null==t?void 0:t.target)?document:e,i=Object.assign({},ew.PDFObjectOptions);a(n).find(".ew-pdfobject").not(":has(.pdfobject)").each((function(){let e=a(this),t=e.data("url"),n=e.html();t&&PDFObject.embed(t,this,Object.assign(i,{fallbackLink:n}))}))}function D(t){var e;let n=null==(e=null==t?void 0:t.target)?document:e,i=a(n);i.find("input[data-bs-toggle=tooltip], textarea[data-bs-toggle=tooltip], select[data-bs-toggle=tooltip]").each((function(){let e=a(this);e.tooltip({...ew.tooltipOptions,html:!0,...e.data()})})),i.find("a.ew-tooltip-link").each(qe),i.find(".ew-tooltip").tooltip(ew.tooltipOptions),i.find(".ew-popover").popover(ew.popoverOptions),i.find(".ew-tippy[data-title]").each((function(){tippy(this,{content:this.dataset.title,...ew.tippyOptions})}))}function M(e){if(a.isString(e))try{return JSON.parse(e)}catch(t){return}return e}function U(e){let t=a(e),n=t.closest("[id^=r_], [id^=xs_]"),i=e.id.substring(2),d=n.find(".ew-search-field"),r=n.find(".ew-search-field2"),s=r.find("[name='y_"+i+"'], [name='y_"+i+"[]']"),o=s.length,l=n.find(".ew-search-cond"),c=l.length,u=n.find(".ew-search-and"),p=n.find(".ew-search-operator"),g=p.find("[name='z_"+i+"']").val(),f=n.find(".ew-search-operator2"),m=f.find("[name='w_"+i+"']").val(),h=g.includes("BETWEEN"),b=["IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"].includes(g),w=["IS NULL","IS NOT NULL","IS EMPTY","IS NOT EMPTY"].includes(m),y=!o||h,_=b,v=!h&&(!c||w);l.toggleClass("d-none",y).find(":input").prop("disabled",y),u.toggleClass("d-none",!h),f.toggleClass("d-none",y).find(":input").prop("disabled",y),d.toggleClass("d-none",_).find(":input").prop("disabled",_),r.toggleClass("d-none",v).find(":input").prop("disabled",v)}function B(t){var e;let a=null==(e=null==t?void 0:t.target)?document:e,n=ew.forms.ids();for(let e of n)(null!=a.matches&&a.matches("#"+e)||a.querySelector("#"+e))&&Pa.get(e).init()}function j(e){return"function"==typeof e}function K(e,t,n){let i=a.isObject(e)?e:{};e=a.isString(e)?e:"",n=a.isString(t)?t:n,i=a.extend(!0,{},ew.sweetAlertSettings,{html:e,icon:n,confirmButtonText:ew.language.phrase("OKBtn"),customClass:{htmlContainer:"ew-swal2-html-container text-"+(n||"danger")}},i);let d={config:i,type:n,show:!0};if(Ra.trigger("alert",[d]),d.show)return Swal.fire(d.config).then((e=>j(t)?t(e.isConfirmed):e))}function V(e,t){var n,i;let d=a.isObject(e)?e:{};return d=a.extend(!0,{},ew.sweetAlertSettings,{title:a.isString(e)?e:"",icon:"question",showCancelButton:!0,confirmButtonText:ew.language.phrase("OKBtn"),cancelButtonText:ew.language.phrase("CancelBtn")},d),d.input&&(null==(i=(n=d).inputValidator)?n.inputValidator=e=>{if(!e)return ew.language.phrase("EnterValue")}:i),Swal.fire(d).then((e=>j(t)?t(e.value):e))}function q(e){e=Object.assign({},ew.toastOptions,e),Ra.Toasts("create",e);var t=e.position,n=a("#toastsContainer"+t[0].toUpperCase()+t.substring(1));return n.children().first()}function W(e,t,a){if(e){t||(t="danger"),a||(a=ew.language.phrase(t));let n={message:e,type:t,title:a,show:!0};if(Ra.trigger("toast",[n]),!!n.show)return({message:e,type:t,title:a}=n),q({class:"ew-toast text-bg-"+t,title:a,body:e,autohide:"success"==t&&ew.autoHideSuccessMessage,delay:"success"==t?ew.autoHideSuccessMessageDelay:500})}}function G(e){if(e instanceof It)return e.$element[0];var t=a(e),n=t.closest(".ew-form");return n[0]||(n=t.closest(".ew-grid, .ew-multi-column-grid, .modal").find(".ew-form")),n[0]}function H(e,t,n,d){var r=this.$element?this.$element[0]:this.form||(null==(s=e)?void 0:s.form),s,o;if(r){var l=this.htmlForm?this:Pa.get(r.id);if(l&&(this.form&&a.isUndefined(e)?e=Pa.get(this).getList(this).childFields.slice():a.isString(e)&&(e=_e(e,r)),e&&(!Array.isArray(e)||0!=e.length))){var c=this,u=new St;if(Array.isArray(e)&&a.isString(e[0])){for(var p=[],g=0,f=e.length,h;g<f;g++){if(h=e[g].split(" "),1==h.length&&c.form){var b=Ne(c,!1).match(/^([xy]\d*_)/);b&&(e[g]=e[g].replace(/^([xy]\d*_)/,b[1]))}var m=_e(e[g],r),w=[];if(!(se(m)||ne(m)))if(p.push(m),2==h.length&&Array.isArray(m)){var y=a(m);y.each((function(){if(!w.includes(this.name)){w.push(this.name);var e=y.filter("[name='"+this.name+"']"),a=e.attr("type"),i=["radio","checkbox"].includes(a)?e.get():e[0];u.add(Y.bind(c,i,t,n,d))}}))}else u.add(Y.bind(c,m,t,n,d))}e=p;var _=Pa.get(c).getList(c);Array.isArray(null==_?void 0:_.autoFillTargetFields)&&_.autoFillTargetFields[0]&&u.add(Ve.bind(null,c))}else{if(se(e)||ne(e))return;u.add(Y.bind(c,e,t,n,d))}return null==(o=u.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)}))?void 0:o.then((function(){Ra.trigger("updatedone",[{source:c,target:e}])}))}}}function Y(e,t,n,d){void 0===d&&(d=!0);var r=Ne(e,!1);if(r){var s=G(e);if(s&&s.id){var o=Pa.get(s.id);if(o){var l=this,c=Array.from(arguments),u=xe(e),p=r.match(/^([xy])(\d*)_/),g=p?p[1]:"",f=p?p[2]:"",m=[],h=o.getList(e),b=a(e).data("updating",!0);if(!b.data("hidden")){if(a.isUndefined(t)&&(t=h.parentFields.slice(),""!=f))for(var y=0,_=t.length,v;y<_;y++)v=t[y].split(" "),1==v.length&&(t[y]=t[y].replace(/^x_/,"x"+f+"_"));if(Array.isArray(t)&&0<t.length)if(Array.isArray(t[0]))m=t;else if(a.isString(t[0]))for(var y=0,_=t.length;y<_;y++)m.push(xe(t[y],s));ie(e)||Ce(e);var E=function(t){var a=Ne(e);t.forEach((function(t){let n={data:t,parents:m,valid:!0,name:a,form:s};Ra.trigger("addoption",[n]),n.valid&&Fe(e,t,s)})),null==e.render||e.render(),ke(e,u,d),d&&!e.options&&e.length&&b.first().triggerHandler("click")};a.isUndefined(n)&&(n=h.ajax);var A=function(){/(srch|search|summary|crosstab)$/.test(s.id)&&"x"==g&&!f&&(c[0]=r.replace(/^x_/,"y_"),H.apply(l,c))};if(!a.isBoolean(n)||Array.isArray(h.lookupOptions)&&0<h.lookupOptions.length){var S=h.lookupOptions;return E(S),A(),b.first().trigger("updated",[{target:e}]),S}var T=Ne(e),x=Object.assign({page:h.page,field:h.field,ajax:"updateoption",language:ew.LANGUAGE_ID,name:T},z("#p_"+r,s));ie(e)&&l.htmlForm?x.v0=u[0]||Ze():(e.options&&!e.list&&!re(e)||ae(e))&&(x.v0=u[0]?e.multiple?u.join(ew.MULTIPLE_OPTION_SEPARATOR):u[0]:Ze());for(var y=0,I=m.length;y<I;y++)x["v"+(y+1)]=m[y].join(ew.MULTIPLE_OPTION_SEPARATOR);return null==e.showLoading||e.showLoading(),a.ajax(w(ew.API_LOOKUP_ACTION),{method:"POST",dataType:"json",data:x,async:n,processData:!1,success:t=>{let a=P(t);if(a)return void K({title:a,icon:"error"});let n=t.records||[];return E(n),A(),b.first().trigger("updated",[Object.assign({},t,{target:e})]),n},error:(e,t,a)=>K({title:a,icon:"error"}),complete:()=>b.data("updating",!1)})}}}}}function z(e,t){var e=e.replace(/\[\]$/,""),n={},t=a.isString(t)?/^#/.test(t)?t:"#"+t:t,i=t?a(t).find(e):a(e),d=i.val();if(d){var r=new URLSearchParams(d);r.forEach((function(e,t){n[t]=e}))}return n}function J(e,t,a){var n;let i=document.getElementById(e);null!=(n=i.children[0])&&n.matches("div[id^=ct_]")&&(i=i.children[0]);let d={customexport:t,data:i.innerHTML,...Q()};ew.TOKEN_NAME&&ew.ANTIFORGERY_TOKEN&&(d[ew.TOKEN_NAME_KEY]=ew.TOKEN_NAME,d[ew.ANTIFORGERY_TOKEN_KEY]=ew.ANTIFORGERY_TOKEN),"email"==t?Ge(a,A(Na.searchParams,d)):R(w([ew.API_EXPORT_ACTION,t,a]),d)}function X(e){let t=a(e),n=t.closest("tr");if(!n.data("group"))n.closest("table").find("tbody").find(".ew-rpt-grp-field-1 > .ew-group-toggle").each((function(){X(this),t.toggleClass("ew-rpt-grp-hide")}));else{let e="tr",d;for(let t=1;6>=t;t++){let i=1==t?"":"-"+t,r=n.data("group"+i);a.isValue(r)&&(d=t,""!=r&&(e+="[data-group"+i+"='"+(r+"").replace(/'/g,"\\'")+"']"))}t.hasClass("ew-rpt-grp-hide")?(a(e).slice(1).removeClass("ew-rpt-grp-hide-"+d),t.removeClass("ew-rpt-grp-hide")):(a(e).slice(1).addClass("ew-rpt-grp-hide-"+d),t.addClass("ew-rpt-grp-hide"))}}function Z(e){return e&&["1","y","t","true"].includes((e+"").toLowerCase())}function Q(){let e=Array.from(Object.entries(window.exportCharts)).map((e=>{let[t,a]=e;return{chartEngine:"Chart.js",streamType:"base64",stream:a.toBase64Image(),fileName:t+".png"}}));return e.length?{charts:JSON.stringify(e)}:null}async function ee(e){let{evt:t,url:n,export:i,custom:d,exportSelected:r,emailForm:s}=e,o=t.currentTarget.form;if(r&&(r=o&&!!o.querySelector("input[type=checkbox][name='key_m[]']")),r&&!pe(o))return K({title:ew.language.phrase("NoRecordSelected"),icon:"warning"}),!1;let l=o?a(o):a('<form class="ew-export-form" method="post"></form>').appendTo(Fa),c=l.attr("target"),u=l.attr("action"),p=[[ew.TOKEN_NAME_KEY,ew.TOKEN_NAME],[ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN]];try{if(d){var g;document.body.style.cursor="wait";n=E(n,{export:i,custom:1},a(s).serialize()),null==(g=document.querySelector("iframe[name='ew-export-frame']"))||g.remove();let e=a("<iframe>").attr("name","ew-export-frame").addClass("d-none").appendTo(Fa);l.attr({action:n,target:"ew-export-frame"}),p.forEach((e=>{let[t,n]=e;return l.find('input[name="'+t+'"]').val(n)[0]||a("<input>").attr({type:"hidden",name:t,value:n}).appendTo(l)})),e.one("load",(()=>document.body.style.cursor="default")).one("load",(()=>l.attr({action:u,target:c}))),l.trigger("submit")}else n=S(n,"export",i),"print"==i?l.attr("action",n).trigger("submit"):R(n,A(l.serialize(),Q()))}finally{o||l.remove()}return!1}function te(e){var t=a(e);return t.is(":hidden")&&t.data("editor")}function ae(e){var t;return null==e||null==(t=e.dataset)?void 0:t.modalLookup}function ne(e){var t;return null==e||null==(t=e.dataset)?void 0:t.filter}function ie(e){var t=a(e);return t.is(":hidden")&&t.data("autosuggest")}function de(e){return null==e||null==e.matches?void 0:e.matches("select.select2-hidden-accessible")}function re(e){return(null==e||null==e.matches?void 0:e.matches("select:not(.select2-hidden-accessible)"))&&"select-one"==e.type}function se(e){return(null==e||null==e.matches?void 0:e.matches("input:not([type=checkbox]):not([type=radio])"))&&!ie(e)}function oe(e){return null==e||null==e.matches?void 0:e.matches("input[type=checkbox][data-boolean]")}function le(e,t){if(e){var n=a(e);if(!Ae(n)){if(te(e))return n.data("editor").focus();!e.options&&e.length?e=n[0]:ie(e)&&(e=e.input),e.focus(t)}}}function ce(e){if(!e)return;let t=a(e);if(Ae(t))return;!e.options&&e.length&&(e=t[0]);let n=t.closest(ka),i=()=>n.find(".is-valid").removeClass("is-valid");if(ie(e))n.find(".ew-auto-suggest").removeClass("is-invalid").addClass("is-valid").one("click keydown paste",i);else if(te(e))t.removeClass("is-invalid").addClass("is-valid"),t.data("editor").instance.once("change",i);else if(ae(e))t.removeClass("is-invalid").addClass("is-valid").one("select2:open",i);else if(["checkbox","radio"].includes(e.type))t.removeClass("is-invalid").addClass("is-valid").one("click keydown",i);else{let e=ew.BROWSER_NAME.includes("Safari")&&!ew.BROWSER_NAME.includes("Chrome")?"change input":"click input";t.parent().one(e,i),t.add(t.closest(".input-group")).removeClass("is-invalid").addClass("is-valid")}}function ue(e){null==e||e.scrollIntoView(ew.scrollIntoViewOptions)}function pe(e){return!!(null!=e&&e.querySelector("input[type=checkbox][name='key_m[]']:checked"))}function ge(e){null!=e&&e.form&&a(e.form.elements).filter("input[type=checkbox][name^="+e.name+"_], [type=checkbox][name="+e.name+"]").not(e).not(":disabled").prop("checked",e.checked).each(((e,t)=>a(t).triggerHandler("change")))}function fe(e){let t=a(e).find("input[type=checkbox][name='key_m[]']:checked").closest("[data-rowindex]").map(((e,t)=>t.dataset.rowindex)).get();a(null==e?void 0:e.rows).filter(((e,a)=>a.classList.contains("table-active")&&!t.includes(a.dataset.rowindex))).removeClass("table-active ew-table-selected-row").triggerHandler("change")}function me(e){let t=null==e?void 0:e.closest(".ew-table");if(t){let t=a(e).closest(".ew-table > tbody > tr");t.siblings("[data-rowindex='"+t.data("rowindex")+"']").addBack().removeClass("table-active").triggerHandler("change")}}function he(e){let t=null==e?void 0:e.closest(".ew-table");if(t){fe(t);let n=a(e).closest(".ew-table > tbody > tr");n.siblings("[data-rowindex='"+n.data("rowindex")+"']").addBack().addClass("table-active").triggerHandler("change")}}function be(){let e,t;a.isNumber(arguments[0])?e=arguments[1]:arguments[0]instanceof HTMLTableElement&&(e=arguments[0],t=arguments[1]);let i=a(e),d=a(e.rows);if(!e||!e.rows||!t&&e.dataset.isset||0==e.tBodies.length)return;let r=function(t){let e=a(this),n=this.closest(".ew-table"),i=a(t.target);!n||i.hasClass("btn")||i.hasClass("ew-preview-btn")||i.is(":input")||(fe(n),e.siblings("[data-rowindex='"+e.data("rowindex")+"']").addBack().toggleClass("table-active").triggerHandler("change"))},s=d.filter("[data-rowindex=1]").length||d.filter("[data-rowindex=0]").length||1,n=d.filter(":not(.ew-template)").each((function(){a(this.cells).removeClass("ew-table-last-row").last().addClass("ew-table-last-col")})).get();if(n.length>=s){let t=i.parentsUntil(".ew-grid","."+ew.RESPONSIVE_TABLE_CLASS)[0];n[n.length-1].classList.add("border-bottom-0"),n.splice(-1*s).forEach(((a,n)=>Array.from(a.cells).filter((e=>e.rowSpan==n+1)).forEach((a=>{a.classList.add("ew-table-last-row"),a.classList.toggle("ew-table-border-bottom",(null==t?void 0:t.clientHeight)>e.offsetHeight)}))))}let o=e.closest("form"),l=o&&0<a(o.elements).filter("input#action:not([value^=grid])").length;a(e.tBodies[e.tBodies.length-1].rows).filter(":not(.ew-template):not(.ew-table-preview-row)").each((function(){let e=a(this);l&&!e.data("isset")&&e.on("click",r).data("isset",!0)})),we(e.closest(".ew-grid"),t),e.dataset.isset="true"}function we(e,t){let n=a(e);if(e&&(t||!e.dataset.isset)){let t=n.find("table.ew-table > tbody").first().children("tr:not(.ew-table-preview-row, .ew-template)").length;if(0!=t||e.querySelector(".ew-grid-upper-panel, .ew-grid-lower-panel")||n.hide(),n.find(".ew-grid-middle-panel:visible").hasClass(ew.RESPONSIVE_TABLE_CLASS)&&n.width()>a(".content").width()&&(n.addClass("d-flex"),n.closest(".ew-detail-pages").addClass("d-block"),n.closest(".ew-form").addClass("w-100")),n.find(".ew-grid-middle-panel:visible")&&(!e.querySelector(".ew-grid-upper-panel")||n.find(".ew-grid-upper-panel:hidden")[0])){let e=n.find(".ew-grid-middle-panel:not(.overflow-y-auto):visible").addClass("rounded-top"),t=e.children(".ew-table:not(.table-head-fixed):visible").first().children("thead:visible").first().children("tr:visible").first().children("th:visible");t.first().addClass("rounded-top-left"),t.last().addClass("rounded-top-right")}if(n.find(".ew-grid-middle-panel:visible")&&(!e.querySelector(".ew-grid-lower-panel")||n.find(".ew-grid-lower-panel:hidden")[0])){let e=n.find(".ew-grid-middle-panel:not(.overflow-y-auto):visible").addClass("rounded-bottom"),t=e.children(".ew-table:not(.table-head-fixed):visible").last().children("tbody:visible").last().children("tr:visible").last().children("td:visible");t.first().addClass("rounded-bottom-left"),t.last().addClass("rounded-bottom-right")}e.dataset.isset="true"}}function ye(e){return(e+"").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">")}function _e(e,t){t=a.isString(t)?/^#/.test(t)?t:"#"+t:t;let n=t?a(t):Ra,i=[],d=e=>"[data-field='"+e+"']:not(.ew-custom-option):not([name^=y_]):not([data-old])";if(e instanceof HTMLElement&&e.dataset.table&&e.dataset.field){if(oe(e))return e;i=["[data-table='"+e.dataset.table+"']"+d(e.dataset.field)]}else if(a.isString(e)){let[t,a]=e.split(" ");i=a?["[data-table='"+t+"']"+d(Ne(a))]:["[name='"+e+"']:not(.ew-custom-option):not([data-old])",d(Ne(e))]}let r=["input","select","textarea","button","selection-list"].flatMap((e=>i.map((t=>e+t)))).join(),s=n.find(r);return n.is("form.ew-form")&&n.find("div.ew-form")[0]&&(s=s.not("div.ew-form *")),1==s.length&&(s.is(":not([type=checkbox]):not([type=radio])")||oe(s[0]))||2==s.length&&s.eq(0).is("selection-list")&&s.eq(1).is("input[type=hidden]")?s[0]:s[0]?s.get():null}function ve(e,t){t=a.isString(t)?/^#/.test(t)?t:"#"+t:t;let n="#"+e.replace(/([\$\[\]])/g,"\\$1")+",[name='"+e+"']";return t?a(t).find(n)[0]:a(n).first()[0]}function Ee(e,t){for(;e=e.parentNode;){var a;if(1==(null==(a=e)?void 0:a.nodeType)&&(!t||t(e)))return e}return null}function Ae(e){var t=a(e);return"none"==t.css("display")&&!t.is("selection-list")&&!t.closest(".dropdown-menu")[0]&&!ae(e)&&!ie(e)&&!te(e)||null!=Ee(e,(e=>"none"==e.style.display&&!e.classList.contains("tab-pane")&&!e.classList.contains("collapse")))}function Se(e,t){return(e+"").toLowerCase()==(t+"").toLowerCase()}function Te(e,t){if(e=e instanceof URL?e.pathname:y(e).pathname,t=t instanceof URL?t.pathname:y(t).pathname,e!=t&&e.startsWith(ew.PATH_BASE)&&t.startsWith(ew.PATH_BASE)){e=e.substring(ew.PATH_BASE.length),t=t.substring(ew.PATH_BASE.length);let a=e.split("/"),n=t.split("/");if(a[0]==n[0]&&a[0].match(/(list|view|edit)$/i)||a[0]==n[0]&&a[1]==n[1]&&[ew.LIST_ACTION,ew.VIEW_ACTION,ew.EDIT_ACTION].includes(a[1]))return!0}return e==t}function xe(e,t){let n=e;if(a.isString(e)?n=2==e.split(" ").length?_e(e):_e(e,t):["checkbox","radio"].includes(e.type)&&(n=_e(e)),!n)return[];if(n.options){if(n.list)return n.values;if(de(n)){let e=a(n).val();return Array.isArray(e)?e:a.isValue(e)?[e]:[]}return Array.from(n.options).filter((e=>e.selected&&""!==e.value)).map((e=>e.value))}return Array.isArray(n)||oe(n)?a(n).filter(":checked").map((function(){return this.value})).get():ew.isHiddenTextArea(n)?(a(n).data("editor").save(),[n.value]):[n.value]}function Ie(e,t){return xe(e,t).join(ew.MULTIPLE_OPTION_SEPARATOR)}function Oe(e,t){let n=e;return a.isString(e)?n=2==e.split(" ").length?_e(e):_e(e,t):["checkbox","radio"].includes(e.type)&&(n=_e(e)),n?ie(n)?[n.input.value]:n.options?de(n)?a(n).find(":selected").map(((e,t)=>t.innerHTML)).get():Array.from(n.options).filter((e=>e.selected&&""!==e.value)).map((e=>e.text)):Array.isArray(n)||oe(n)?a(n).filter(":checked").map((function(){return a(this).parent().text()})).get():ew.isHiddenTextArea(n)?(a(n).data("editor").save(),[n.value]):[n.value]:[]}function Ce(e){if(e.options){var t="select-multiple"==e.type||e.hasAttribute("data-dropdown")||0<e.length&&""!=e.options[0].value?0:1;if(e.list)e.removeAll(),e.render();else for(var a=e.length-1;a>=t;a--)e.remove(a);ie(e)&&(e.input.value="",e.value="")}}function Ne(e,t){var n=a.isString(e)?e:a(e).attr("name")||a(e).attr("id");return!1===t?n:n.replace(/\[\]$/,"")}function Pe(e,t){var n=a(t).data("value-separator");return Array.isArray(n)?n[e-1]:n||", "}function Re(e,t){return[e.df,e.df2,e.df3,e.df4].reduce(((e,n,d)=>{let i=0<d?Pe(d,t):"";return!a.isUndefined(i)&&a.isValue(n)&&""!=n?e+i+n:e}),"")}function Fe(e,t,a,n){let i=Pa.get(a.id),d=Ne(e),r=i.getList(e),s=t.gf,o=t.lf,l=i.getOptionTemplate(r),c=null!=l&&l.render&&!ie(e)?l.render(t):Re(t,e)||o;if(e.options){let i;e.list?i=new ew.SelectionListOption(c,o,!!n):(i=document.createElement("option"),i.value=o,i.innerHTML=c,i.selected=!!n);let r={name:d,form:a.$element,data:t,group:s,option:i};if(Ra.trigger("newoption",[r]),e.list)e.addOption(r.option);else if(r.group&&!de(e)){var u;let t=Array.from(null==(u=e.querySelector(":scope > optgroup"))?[]:u).find((e=>e.label==r.group));t||(t=document.createElement("optgroup"),t.label=r.group,e.add(t)),t.appendChild(r.option)}else e.add(r.option);return r.option.text}return c}function ke(e,t,n){var i,d;if(void 0===n&&(n=!0),e&&t){let s=a(e);if(t=Array.isArray(t)?t:[t],e.options){if(e.list)e.value=t;else{var r;s.val(t),n&&de(e)&&s.triggerHandler("change"),"select-one"!=e.type||-1!=e.selectedIndex||null!=(r=e.options[0])&&r.value||(e.selectedIndex=0)}if(ie(e)&&1==t.length){let a=e.options||[];for(let n of a)if(n.value==t[0]){e.value=n.value,e.input.value=n.text;break}}}else oe(e)?e.checked=Z(t.join(ew.MULTIPLE_OPTION_SEPARATOR)):e.type&&"file"!=e.type&&(s.val(t.join(ew.MULTIPLE_OPTION_SEPARATOR)),te(s)&&s.data("editor").set());if("false"!==(null==(i=e.dataset)?void 0:i.autoselect)){let t=G(e),a=t&&!(t.id.endsWith("search")||t.id.endsWith("srch")||0===(null==(d=Pa.get(t.id).getList(e))||null==(d=d.parentFields)?void 0:d.length));if(a&&e.options&&(e.list||"select-one"!=e.type||2!=e.options.length||e.options[1].selected?1==e.options.length&&!e.options[0].selected&&(e.options[0].selected=!0,!n||s.trigger("change")):(e.options[1].selected=!0,!n||s.trigger("change")),ie(e))){let t=e.options||[];1==t.length&&(e.value=t[0].value,e.input.value=t[0].text)}}}}function Le(e,t){var a;null==(a=t)?t={}:a,t.headers=new Headers(t.headers||{});let n=e.startsWith(w());n?ew.API_JWT_TOKEN&&t.headers.set(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN):!t.method||Se(t.method,"GET")?(e=E(e,t.body),delete t.body):ew.TOKEN_NAME&&ew.ANTIFORGERY_TOKEN&&(t.body instanceof FormData?(t.body.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME),t.body.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN)):t.body=A(t.body,{[ew.TOKEN_NAME_KEY]:ew.TOKEN_NAME,[ew.ANTIFORGERY_TOKEN_KEY]:ew.ANTIFORGERY_TOKEN}));let i={url:e,init:t};return Ra.trigger("fetch",[i]),fetch(i.url,i.init)}function De(e,t,a){let n=a?/<(head)[^>]*>[\s\S]*?<\/\1\s*>/gi:/<(head|template)[^>]*>[\s\S]*?<\/\1\s*>/gi,i=e.replaceAll(n,"").matchAll(/<script[^>]*>[\s\S]*?<\/script\s*>/gi);Array.from(document.createRange().createContextualFragment(Array.from(i).map((e=>e[0])).filter((e=>!e.includes("$rowindex$"))).join("")).querySelectorAll("script:not([type]), script[type='text/javascript']")).sort(((e,t)=>t.classList.contains("ew-apply-template")?1:e.classList.contains("ew-apply-template")?-1:0)).forEach(((e,a)=>Ue(e,"scr_"+t+"_"+a,e.nonce)))}function Me(e){let t=e.replaceAll(/<(head|template)[^>]*>[\s\S]*?<\/\1\s*>/gi,"").matchAll(/<script([^>]*)>([\s\S]*?)<\/script\s*>/gi);return Array.from(t).filter((e=>document.createRange().createContextualFragment(e[0]).querySelector("script:not([type]), script[type='text/javascript']"))).reduce(((e,t)=>e.replace(t[0],"")),e)}function Ue(e,t,n){let i=document.createElement("SCRIPT");return a.isString(e)?i.text=e:e instanceof HTMLScriptElement&&(i.text=e.text),t&&(i.id=t),n&&(i.nonce=n),document.body.appendChild(i)}function Be(e){e&&a("script[id^='scr_"+e+"_']").remove()}function je(e,t){var n;e=e.trim().replace(/<head>[\s\S]*<\/head>/,"");let i=t?e:Me(e),d=i.match(/<body[\s\S]*>[\s\S]*<\/body>/i);i=null==(n=null==d?void 0:d[0])?i:n;let r=a(i).find("section.content");return r[0]?r.html():i}function $e(e){return null!=e&&e.options?Array.prototype.map.call(e.options,(e=>[e.value,e.text])):[]}function Ke(){let e=a(this),t=e.data("args"),n=e.removeData("args").find(".modal-body form").data("form");Be("modal_dialog"),null==n||n.destroyEditor(),e.find(".modal-footer .btn-primary").off(),e.find(".modal-dialog").removeClass(((e,t)=>{let a=t.match(/table\-\w+/);return a?a[0]:""})),e.data({showing:!1,url:null}),null!=t&&t.reload&&window.location.reload()}function Ve(e){let t=Pa.get(e).$element[0];if(!t)return;let n=xe(e),i=Ne(e),d=i.match(/^([xy])(\d*)_/),r=d?d[2]:"",s=Pa.get(e).getList(i),o=s.autoFillTargetFields,l=function(n){let d=null==n?void 0:n.records,s=Array.isArray(d)&&0<d.length?d[0]:[];for(let l=0,c;l<o.length;l++)if(c=_e(o[l].replace(/^x_/,"x"+r+"_"),t),c){let n=a.isValue(s["af"+l])?s["af"+l]+"":"",r={results:d,result:s,data:n,form:t,name:i,target:o[l],cancel:!1,trigger:!0};if(a(e).trigger("autofill",[r]),r.cancel)continue;n=r.data,c.options?(ke(c,n.split(",")),ie(c)&&(c.input.value=n,H.call(Pa.get(t.id),c))):te(c)?(c.value=n,a(c).data("editor").set()):"checkbox"==c.type?c.checked=Z(n):c.value=n,r.trigger&&a(c).trigger("change")}return s};if(0<n.length&&""!=n[0]){let e=Object.assign({page:s.page,field:s.field,ajax:"autofill",v0:n[0],language:ew.LANGUAGE_ID},z("#p_"+i,t)),d=s.parentFields.slice();if(""!=r)for(let e=0,t=d.length,a;e<t;e++)a=d[e].split(" "),1==a.length&&(d[e]=d[e].replace(/^x_/,"x"+r+"_"));let o=d.map((e=>Ie(e,t)));return o.forEach(((t,a)=>e["v"+(a+1)]=t)),a.post(w(ew.API_LOOKUP_ACTION),e,l,"json")}return l()}function qe(e,t){var n=a(t),i=a("#"+n.data("tooltip-id")),d=n.data("trigger")||"hover",r=n.data("placement")||"auto";i[0]&&(""!=i.text().trim()||i.find("img[src!='']")[0])&&(bootstrap.Popover.getInstance(t)||n.popover({...ew.popoverOptions,placement:r,trigger:d,delay:100,container:document.getElementById("ew-tooltip"),content:i.html()}).on("show.bs.popover",(function(){var e=n.data("tooltip-width");e&&a(bootstrap.Popover.getInstance(this)._getTipElement()).css("max-width",parseInt(e,10)+"px")})))}function We(t){var e;let n=null==(e=null==t?void 0:t.target)?document:e,i=null==n?void 0:n.querySelector(".ew-filter-option");ew.CLIENT_SEARCH_FILTER||ew.SERVER_SEARCH_FILTER&&ew.IS_LOGGED_IN&&!ew.IS_SYS_ADMIN&&""!=ew.CURRENT_USER_NAME?a(i).removeClass("d-none").find(".ew-btn-dropdown").on("show.bs.dropdown",(function(t){var e,n;let i=a(this).find(".ew-save-filter[data-form], .ew-delete-filter[data-form]").data("form"),d=ew.forms.get(i),r=ew.CLIENT_SEARCH_FILTER?ew.parseJson(localStorage.getItem(ew.PROJECT_NAME+"_"+d.id+"_filters")||"[]")||[]:null==(e=null==d||null==(n=d.filterList)?void 0:n.filters)?[]:e;d.setupFilters(t,r.filter((e=>Array.isArray(e)&&2==e.length)))})):null==i||i.classList.add("d-none")}function Ge(e,t){let a=window.parent.Swal;return t=A(t,[[ew.TOKEN_NAME_KEY,ew.TOKEN_NAME],[ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN]]),a.fire({...ew.sweetAlertSettings,showConfirmButton:!1,html:"<p>"+ew.language.phrase("Exporting")+"</p>",allowOutsideClick:!1,allowEscapeKey:!1,willOpen:()=>{a.showLoading(),Le(w([ew.API_EXPORT_ACTION,"email",e])+"?rnd="+Ze(),{method:"POST",body:t}).then((async n=>{a.hideLoading();let i=await n.json();if(null!=i&&i.success)a.update({title:"<div class='text-success'>"+i.message+"</div>"}),Ra.trigger("export",[{type:"done",tblVar:e,data:t,result:i}]);else{var d;a.update({title:null==(d="<div class='text-danger'>"+P(i))?ew.language.phrase("FailedToExport")+"</div>":d}),Ra.trigger("export",[{type:"fail",tblVar:e,data:t,result:i}])}})).catch((n=>{var i;a.hideLoading(),a.update({title:null==(i="<div class='text-danger'>"+n)?ew.language.phrase("FailedToExport")+"</div>":i}),Ra.trigger("export",[{type:"fail",tblVar:e,data:t,error:n}])})).finally((()=>{a.update({showConfirmButton:!0}),Ra.trigger("export",[{type:"always",tblVar:e,data:t}])}))}})}function He(){return location.href.split("#")[0].split("?")[0]}function Ye(e){var t,n;e=a.isString(e)?document.querySelector(e):e;const i=(null==(t=e)?void 0:t.value)||(null==(n=e)?void 0:n.innerText);if(i){const e=document.createElement("textarea");e.value=i,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}return i}function ze(e){return!(e+="",e&&0!=e.length)||(e=e.trim(),null!==ew.parseNumber(e))}function Je(e){return!(e&&0!=e.length)||/^[\w.%+-]+@[\w.-]+\.[A-Z]{2,18}$/i.test(e.trim())}function Xe(e){var t;let n,i;try{[n,i]=[window.parent.document,window.parent.Swal]}catch(t){[n,i]=[window.document,window.Swal]}let d=null==(t=null==e?void 0:e.target)?n:t,r=a(d).find("div.ew-message-dialog.d-none").first(),s=r.length?r.text():"";if((a.isString(e)&&(s=a("<div>"+e.trim()+"</div>").text()),""!=s.trim())&&r.length)if(!ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST){if(["success","info","warning","danger"].forEach((function(e){let t=r.find(".alert-"+e).toggleClass("alert-"+e),a=t.find(".alert-heading").detach(),n=t.children(":not(.icon)");if(t.find(".icon").remove(),t[0]){let i=parseInt(n.css("width"),10);0<i&&n.first().css("width","auto");let d=W(t.html(),e,a.html());return void(0<i&&d.css("max-width",i))}})),a.isString(e))return i.fire({...ew.sweetAlertSettings,title:e})}else if(ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST){let t="";$.each(["success","info","warning","danger"],(function(e,t){r.find(".alert-"+t).toggleClass("alert-"+t+" text-"+t)}));var o=a.isString(e)?e:r.length?ew.IS_MOBILE?r.text():r.html():"";if(o.toLowerCase().includes("ew-success")&&(t+="success"),o.toLowerCase().includes("ew-warning")&&(t+=",warning"),o.toLowerCase().includes("ew-error")&&(t+=",error"),o.toLowerCase().includes("ew-info")&&(t+=",info"),""==o.trim())return;"success"==t?"success"==t&&(!alertify.successalert&&alertify.dialog("successalert",(function(){return{main:function(e){this.message='<p class="text-danger">'+e+"</p>"},setup:function(){return{buttons:[{text:"OK",key:27,invokeOnClose:!0,className:alertify.defaults.theme.ok,attrs:{attribute:"value"},scope:"primary",element:void 0}],focus:{element:0},options:{resizable:!1}}},prepare:function(){this.setContent(this.message)}}}),!0,"confirm"),alertify.successalert(o).set("title",ew.language.phrase("MessageAlert")).set("modal",!0).set("maximizable",!1).autoOk(5)):alertify.alert(o,(function(){})).set("title",ew.language.phrase("MessageAlert")).set("modal",!0)}}function Ze(){return Math.floor(100001*Math.random())+1e5}function Qe(e,t){let n;return a.isString(e)?n=La.fromSQL(e,{zone:"utc"}):a.isNumber(e)?n=La.fromSeconds(e,{zone:"utc"}):e instanceof Date?n=La.fromJSDate(e,{zone:"utc"}):e instanceof La&&(n=e),n.toFormat(t,{locale:ew.LANGUAGE_ID,numberingSystem:ew.getNumberingSystem()})}function et(e,t){return La.fromFormat(e,t,{locale:ew.LANGUAGE_ID,numberingSystem:ew.getNumberingSystem()})}function tt(e,t,n,i){var d;let r=null!=(d=ew.vars)&&d.login?Array.from(Object.entries(ew.vars.login)).filter((e=>{var t;return(null==(t=e[1])?void 0:t.url)||e[0].endsWith("Url")})).map((e=>{var t;return(null==(t=e[1])?void 0:t.url)||e[1]})):[];if(r.includes(e))return window.location=e,!1;let s;if(e.startsWith("http"))s=new URL(e);else if(e.startsWith("/"))s=new URL(e,location.protocol+"//"+location.host);else return K({title:ew.language.phrase("IncorrectUrl"),icon:"error"}),!1;let o=s.searchParams;if(i&&(o=A(o,i)),Se(n,"post")){const a=t||document.createElement("form");a.method="post",a.action=e.split("?")[0],document.body.appendChild(a),o.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME),o.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN),o.forEach(((e,t)=>{const n=document.createElement("input");n.type="hidden",n.name=t,n.value=ew.sanitize(e),a.appendChild(n)})),a.submit()}else t&&(o=A(o,a(t).serialize())),window.location=O(s.toString()+(o.size?"?"+o.toString():""));return!1}function at(){return window.matchMedia(ew.screenMediaQuery).matches}function nt(e,t){var n;null==(n=t)?t=".ew-card.ew-grid":n,t=t.startsWith(".")||t.startsWith("#")?t:"."+t;let i=document.querySelector(t+", .ew-multi-column-grid, .ew-view-form, .ew-edit-form, .ew-calendar, .ew-dashboard, main.ew-no-record"),d=document.querySelector(".ew-dashboard");if(!i)return;let r=a(ew.overlayTemplate()),s=a(i).addClass("ew-loading").toggleClass("overlay-wrapper",!i.classList.contains("card")).append(r);return e.then((async n=>{if(!(n instanceof Response))return n;let r=n.headers.get("Content-Type");if(null!=r&&r.includes("json")){let e=await n.json(),t=e.validation,r=P(e),s=i.querySelector(".ew-form"),o=ew.forms.get(s);if(d)for(let t in e)a("#"+t).find(".card-body").html(""),a("#"+t).find("[data-card-widget='card-refresh']").CardRefresh("load");else if(o&&t){for(let[e,n]of Object.entries(t))if(e=parseInt(e,10),a.isNumber(e)&&a.isObject(n)){s.dataset.rowindex=e;for(let[t,a]of Object.entries(n))o.addCustomError(t,a,e)}else a.isString(n)&&o.addCustomError(e,n);o.focus()}return r?W(r):a.isString(e.warningMessage)?W(e.warningMessage,"warning"):a.isString(e.message)?W(e.message,"body"):a.isString(e.successMessage)&&W(e.successMessage,"success"),!1}let o=await n.text(),l=new URL(n.url),c=[".ew-message-dialog",".ew-chart-top",".ew-chart-bottom",".ew-debug .card-body",".ew-timer",".ew-dashboard"];"false"==l.searchParams.get("layout")&&(o="<div>"+o+"</div>",l.searchParams.delete("layout")),l.searchParams.delete("rnd"),l.searchParams.delete("action"),o=je(o,!0);let u=a("<div>"+o+"</div>");i.closest(".ew-dashboard")||(c.unshift(".ew-toolbar"),Te(l,Na)&&Na.toString()!=l.toString()&&window.history.pushState(null,"",l.toString())),c=u.find("main.ew-no-record")[0]||s.is("main.ew-no-record")?[".ew-ext-search-form","main",...c]:s.hasClass("ew-view-form")?[".ew-view-form",".ew-pager",...c]:s.hasClass("ew-edit-form")?[".ew-edit-form",".ew-pager",...c]:s.hasClass("ew-multi-column-grid")?[".ew-ext-search-form",".ew-multi-column-grid",...c]:["#ew-filter-list",".ew-ext-search-form",t+" .card-header",t+" .card-body",t+" .card-footer",...c],c.forEach((e=>a(e).each(((t,n)=>{let i=a(n),d=u.find(e).eq(t);if(i[0]&&d[0]&&(delete n.dataset.isset,i.html(d.html()),i.attr("class",d.attr("class"))),".ew-toolbar"==e){let t={target:n};h(t),We(t)}else if(".ew-ext-search-form"==e){ew.initForms({target:d[0]});let e=d.find("#navbar-basic-search");if(e[0]){let t=e.render(null),n=a(t),i=n.find("#"+ew.TABLE_BASIC_SEARCH),d=n.find("#"+ew.TABLE_BASIC_SEARCH_TYPE);(i.val()!=a("#"+ew.TABLE_BASIC_SEARCH).val()||d.val()!=a("#"+ew.TABLE_BASIC_SEARCH_TYPE).val())&&a(".nav-item.navbar-basic-search").replaceWith(n)}i.find(".ew-search-operator .form-select.ew-operator-select").each(((e,t)=>U(t)))}else".ew-message-dialog"==e&&(d.hasClass("d-none")||i.html(d.html()))})))),c.filter((e=>".ew-message-dialog"!=e)).forEach((e=>u.find(e).remove())),Be("refresh"),De(u.html(),"refresh");let p=a.Event({type:"load.ew",target:i});ew.initPage(p),i.querySelectorAll(".btn-group").forEach((e=>{var t;return null==(t=bootstrap.Tooltip.getInstance(e))?void 0:t.update()})),a(".toast.show").toast("dispose"),Xe({target:u}),Ra.trigger(p),Ra.trigger(a.Event({type:"refresh.ew",target:i}))})).finally((()=>s.removeClass("ew-loading").find(r).remove()))}function it(){Ma&&Ma.cancel(),Ma=a.later(50,null,(function(){var e=Fa.data("lte.layout");e&&e.fixLayoutHeight()}))}function dt(){return"serviceWorker"in navigator&&"PushManager"in window}function rt(e){const t="=".repeat((4-e.length%4)%4),a=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(a),d=new Uint8Array(n.length);for(let t=0;t<n.length;++t)d[t]=n.charCodeAt(t);return d}async function st(e,a){const n=e.getKey("p256dh"),i=e.getKey("auth"),d=(PushManager.supportedContentEncodings||["aesgcm"])[0];let r=new FormData;r.set("endpoint",e.endpoint),r.set("publicKey",n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null),r.set("authToken",i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):null),r.set("contentEncoding",d);let s=await t.fetch(a,{method:"POST",body:r});return s.json()}async function ot(){var e;let a=t.getApiUrl([t.API_PUSH_NOTIFICATION_ACTION,t.API_PUSH_NOTIFICATION_SUBSCRIBE]),n=await navigator.serviceWorker.ready,i=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:rt(t.PUSH_SERVER_PUBLIC_KEY)}),d=await st(i,a);return null!=d&&null!=(e=d.error)&&e.description&&t.alert(d.error.description),d.success?i:null}async function lt(){let e=await navigator.serviceWorker.ready;return e.pushManager.getSubscription()}function ct(e){let n=a("#subscribe-notification").toggleClass("ew-enable-notification",!e).removeClass("disabled");n.find("i").toggleClass("fa-bell",!e).toggleClass("fa-bell-slash",!!e);let i=bootstrap.Tooltip.getInstance(n[0]);i&&(i._config.title=t.language.phrase(e?"DisableNotifications":"EnableNotifications"))}async function ut(){if("denied"!==Notification.permission&&!t.IS_SYS_ADMIN){document.body.style.cursor="wait";try{if("granted"===Notification.permission){var e,a;ct(null==(e=await lt())?await ot():e),null!=(a=document.getElementById("subscribe-notification"))&&a.classList.contains("ew-enable-notification")||t.showToast(t.language.phrase("NotificationsEnabled"),"success")}else if("default"===Notification.permission&&"granted"==await Notification.requestPermission()){var n;ct(await ot()),null!=(n=document.getElementById("subscribe-notification"))&&n.classList.contains("ew-enable-notification")||t.showToast(t.language.phrase("NotificationsEnabled"),"success")}}catch(a){t.alert(a)}finally{document.body.style.cursor="default"}}return!1}async function pt(){return a("#subscribe-notification").tooltip(),"granted"==Notification.permission?ct(await lt()):ct(null),!0}async function gt(){return t.prompt({html:t.language.phrase("DisableNotificationsConfirm")},(async e=>{if(e){document.body.style.cursor="wait";try{var a;let e=await lt();await e.unsubscribe();let n=t.getApiUrl([t.API_PUSH_NOTIFICATION_ACTION,t.API_PUSH_NOTIFICATION_DELETE]),i=await st(e,n);if(null!=i&&null!=(a=i.error)&&a.description)return t.alert(i.error.description),!1;i.success&&(ct(null),t.showToast(t.language.phrase("NotificationsDisabled"),"success"))}catch(a){t.alert(a)}finally{document.body.style.cursor="default"}}})),!1}function ft(e){if(e.inited)return!0;let t=e.latlng,n=e.useSingleMap,i=e.showAllMarkers,d=e.useMarkerClusterer,r=a("#"+e.id+"."+(n?"ew-single-map":"ew-map")),s=ew.maps[e.ext];if(n){let t=e.id.replace(/^mp\d*_/,"mp_");r=a("#"+t),r[0]||(r=a("<div></div>").attr("id",t).addClass("ew-single-map").height(e.singleMapHeight),e.singleMapWidth&&r.width(e.singleMapWidth),a(".ew-grid, .ew-multi-column-grid").first()[e.showMapOnTop?"before":"after"](r),e.map=s.createMap(r[0],e),r.data("map",e.map),r.data("ext",e.ext),r.data("bounds",i?s.createBounds():null),r.data("markerClusterer",d?s.createMarkerClusterer(e):null)),e=Object.assign(e,r.data())}else{if(!t)return r.addClass("d-none").html(e.status),!0;r.next(".ew-map-value").addClass("d-none"),e.map||(e.map=s.createMap(r[0],e))}return e.marker=s.createMarker(e),e.inited=!0,a(document).trigger("map",[e]),!0}function mt(){a(".ew-single-map").each((function(){let e=a(this).data();ew.maps[e.ext].fitBounds(e)})),a(document).trigger("maps")}function ht(e){let t=a(".ew-map").filter((function(){return!e||a(this).data("ext")==e})).map((function(e){let t=a(this).data();if(t.inited)return ft(t);if(t.id=this.id,t.address=(t.address||"").trim(),t.address){let n=t.geocodingDelay;return new Promise((i=>{a.later(e*n,null,(()=>{i(ew.maps[t.ext].geocode(t).then((e=>{t.latlng=e})).catch((e=>{t.status=e})).finally((()=>ft(t))))}))}))}else{let e=t.latitude,a=t.longitude,n=t.coordinate;if(n){let t=n.match(/[-.\d]+/g);Array.isArray(t)&&2==t.length&&(e=parseFloat(t[0]),a=parseFloat(t[1]))}return e&&!isNaN(e)&&a&&!isNaN(a)&&(t.latlng=ew.maps[t.ext].createLatLng(e,a)),ft(t)}})).get();return Promise.all(t).then(mt)}function bt(...e){const t={},a=e.length;for(let n=0;n<a;n++)for(const a in e[n])t[a]=e[n][a];return t}function wt(e,t,a){const n=pn(t)?t:null,i=un(t)?t:un(a)?a:{};return pi(e,n,i)}var yt={},_t=i(),vt=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}(_t),Et;let At=n.DateTime;a.batchSettings={type:"POST",contentType:"application/json",processData:!1,dataType:"json",toJSON:JSON.stringify,parse:e=>e},a.batchSetup=function(e){return a.extend(a.batchSettings,e)};var St=a.batch=function(e,t){return this instanceof St?("object"==typeof e&&(t=e,e=void 0),this.options=a.extend({},a.batchSettings,t),this.parent=a.ajaxSetup()._batch,this.requests=[],e&&this.add(e),this):new St(e,t)};a.extend(St.prototype,{add:function(e){var t;return a.ajaxSetup({_batch:this.parent||this}),null!=(t=e.name)&&t.startsWith("bound ")?e():e.call(a.ajaxSetup()._batch),this.parent||a.ajaxSetup({_batch:null}),this},clear:function(){this.requests=[]},send:function(e){e=e||{};var t=this;if(this.parent&&e.success){var n=this.parent.options.success;this.parent.options.success=function(t,a,i){e.success(t,a,i),n&&n(t,a,i)}}else if(this.requests.length){var i=a.map(this.requests,(function(e){return e.settings.data})),d=e.success,r=this.options.success;return e.success=function(e,a,n){t._deliver.call(t,e,a),r&&r(e,a,n),d&&d(e,a,n)},e=a.extend({},this.options,e),e.data||(e.data=a.batchSettings.toJSON(i)),a.ajax(e)}},_addRequest:function(e,t){this.requests.push({xhr:e,settings:t})},_deliver:function(e,n){var d=this,r=a.batchSettings.parse(e),s;if(null!=r&&null!=(s=r.error)&&s.description){var o;return void t.alert(null==r||null==(o=r.error)?void 0:o.description)}a.each(r,(function(e,t){var a;if(d.requests[e]){var i=d.requests[e];if(i.xhr.statusText=n,"success"===n){var r;null==(r=i.settings.success)||r.call(i.xhr,t,n)}null==(a=i.settings.complete)||a.call(i.xhr,n)}}))}});var Tt=a.ajax;a.ajax=function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var a=t.beforeSend;return t.beforeSend=function(e,t){if(a){var n=a(e,t);if(!1===n)return n}return t._batch?(t._batch._addRequest(e,t),!1):void 0},Tt.call(this,e,t)};let xt=function(){function e(e,t,a){if(f(this,"name",""),f(this,"validators",[]),f(this,"_validate",!0),this.name=e,Array.isArray(t))for(let e of t)this.addValidator(e);else"function"==typeof t&&this.addValidator(t);this.invalid=a}var t=e.prototype;return t.addValidator=function(e){return"function"==typeof e&&this.validators.push(e),this},t.addError=function(e){if(e){var t;let a=null==(t=this._error)?{}:t;this._error={...a,...e},this.invalid=!0}return this},t.clearErrors=function(){return this._error=null,this.invalid=!1,this},t.clearValidators=function(){return this.validators=[],this},t.validate=function(){let e=!0;if(this.clearErrors(),this._element&&this.shouldValidate&&Array.isArray(this.validators)){for(let t of this.validators){let a=t(this._element);!1!==a&&(this.addError(a),e=!1)}this.updateFeedback()}return e},t.resetInvalid=function(){var e,t;return this.clearErrors(),null!=(e=this._element)&&null!=(e=e.classList)&&e.contains("is-invalid")&&!this._error&&this.addError({server:null==(t=this._element.closest(ew.fieldContainerSelector))||null==(t=t.querySelector(".invalid-feedback"))?void 0:t.innerHTML}),this},t.updateFeedback=function(){let e=this.errorMessage;if(this._element&&e){var t;let a=null==(t=this._element.closest(ew.fieldContainerSelector))?void 0:t.querySelector(".invalid-feedback");a&&(a.innerHTML=e),ew.setInvalid(this._element)}return this},t.focus=function(e){return this._element&&ew.setFocus(this._element,e),this},t.canFocus=function(){var e,t;let a=this._element;return a&&!(a.hidden&&"SELECTION-LIST"==!a.tagName||a.readonly||a.disabled||"hidden"==a.type||"none"==(null==(e=a.style)?void 0:e.display)||null!=(t=a.classList)&&t.contains("d-none"))},u(e,[{key:"error",get:function(){return this._error}},{key:"errorMessage",get:function(){return this._error?Array.from(Object.values(this._error)).join("<br>"):""}},{key:"shouldValidate",get:function(){return!this._checkbox||this._checkbox.checked}},{key:"element",get:function(){return this._element},set:function(e){var t;this._element=e,this._checkbox=null!=(t=this._element)&&null!=(t=t.id)&&t.match(/^[xy]_/)?document.getElementById(this._element.id.replace(/^[xy]_/,"u_").replace(/\[\]$/,"")):null}},{key:"value",get:function(){return this._element?ew.getValue(this._element):""}},{key:"focused",get:function(){return this._element&&this._element==document.activeElement}}])}(),It=function(e){function t(t,a){var n;return n=e.call(this,t,a)||this,f(n,"row",{}),f(n,"fields",{}),f(n,"validateRequired",!0),f(n,"autoFocus",!0),f(n,"autoFocusPreventScroll",!0),n.on("initiated",(function(){let e=this.getForm();return e.classList.contains("ew-wait")?void this.one("enabled",(function(){this.setInvalid(),this.tryFocus()})):void(this.setInvalid(),this.tryFocus())})),n}g(t,e);var a=t.prototype;return a.addField=function(e,t,a){e in this.fields||(this.fields[e]=new xt(e,t,a))},a.getField=function(e){return this.fields[e]},a.addFields=function(e){if(Array.isArray(e))for(let t of e)Array.isArray(t)&&this.addField.apply(this,t)},a.addError=function(e,t){if(t){var a;this._error=null==(a=this._error)?{}:a,this._error[e]=t}},a.addCustomError=function(e,t,a){if(e in this.fields){let n=this.fields[e],i={custom:t};n.addError(i),this.setFieldElement(e,a),n.updateFeedback(),this.addError(e,i)}return!1},a.setFocus=function(e){let a=this.makeVisible(e)?t.focusDelay:0;if(e&&e!=document.activeElement&&e.focus){let n=!e.closest(".modal-body")&&t.autoFocusPreventScroll&&this.autoFocusPreventScroll;setTimeout((()=>{e.focus({preventScroll:n})}),a),this._focused=!0,this.trigger("focused")}},a.focus=function(){if(this.canFocus())for(let[t,a]of Object.entries(this.fields)){var e;if((a.invalid||null!=(e=this._error)&&e[t])&&(this.getFocusable(a),a.canFocus())){this.setFocus(a.element);break}}},a.getFocusable=function(e){var t;null==(t=e.element)?e.element=this.getFieldElements(e.name):t,e.canFocus()||(e.element=this.getFieldElements(e.name,0)),e.canFocus()||(e.element=this.getFieldElements(e.name,1))},a.tryFocus=function(e){if(this.canFocus()&&(e||t.autoFocus&&this.autoFocus&&!this._focused)){if(!e&&this.invalid)return void this.focus();if(["add","edit"].includes(this.pageId)){let e=this.getForm(),t=Array.from(e.querySelectorAll("input[name=detailpage]")).find((e=>{var t;return null==(t=ew.forms.get(e.value))?void 0:t.invalid}));if(t)return void t.focus()}for(let[t,a]of Object.entries(this.fields))if(("string"!=typeof e||e===t)&&(a.element=null,this.getFocusable(a),a.canFocus()))return void this.setFocus(a.element);let a=this.element[ew.TABLE_BASIC_SEARCH];this.id.endsWith("srch")&&a&&a!=document.activeElement&&(a.focus({preventScroll:t.autoFocusPreventScroll&&this.autoFocusPreventScroll}),this._focused=!0,this.trigger("focused"))}},a.canFocus=function(){var e,t;let a=this.element;return a&&!(a.hidden||"hidden"==a.type||"none"==(null==(e=a.style)?void 0:e.display)||null!=(t=a.classList)&&t.contains("d-none"))},a.makeVisible=function(e){if(this.multiPage)return this.multiPage.gotoPageByElement(e),!0;if(this.$element.is("div")){let e=this.$element.closest(".tab-pane");if(e[0]&&!e.hasClass("active"))return e.closest(".ew-nav").find("a[data-bs-toggle=tab][href='#"+e.attr("id")+"']").trigger("click"),!0}return!1},a.validateFields=function(e){var t;null==(t=e)?e=this.getCurrentRowIndex():t,2>e&&(this.value=null),this.row={},this._error=null;let a=!0;for(let t of Object.values(this.fields))t.element=this.getFieldElements(t.name,e),this.row[t.name]=t.value,t.element&&!t.validate()&&(this.addError(t.name,t.error),a=!1);if(!this.value)this.value={...this.row};else{Array.isArray(this.value)||(this.value=[this.value]);let t=parseInt(e,10)||0;t=1<t?t-1:0,this.value[t]={...this.row}}return this.focus(),a},a.validate=async function(t){var e,a,n,i;if(!this.validateRequired)return!0;let d=this.getForm();if("confirm"==(null==(e=d.querySelector("#confirm"))?void 0:e.value))return!0;if("update"==this.pageId&&!ew.updateSelected(d))return ew.alert({title:ew.language.phrase("NoFieldSelected"),icon:"error"}),!1;let r=0,s=d.querySelector(".ew-inline-insert"),o=(null==(a=d.querySelector("#action"))?void 0:a.value)||(null==(n=null==(i=null==t?void 0:t.currentTarget)?s:i)?void 0:n.dataset.action),l=s?0:this.keyCount,c="gridinsert"==o||["insert","confirm"].includes(o)&&l,u=s?0:1,p=s?0:l||1;for(let e=u;e<=p;e++){var g,f;let t=0<=l?e+"":"";if(d.dataset.rowindex=t,["list","grid"].includes(this.pageId))if(!c||!this.emptyRow(t))r++;else continue;if(!this.validateFields(t))return!1;if(null!=(g=await(null==(f=this.customValidate)?void 0:f.call(this,d)))&&!g)return this.focus(),!1}if(delete d.dataset.rowindex,"list"==this.pageId&&c&&0==r)return ew.alert({title:ew.language.phrase("NoAddRecord"),icon:"error",returnFocus:!1}),this.tryFocus(!0),!1;if(["add","edit"].includes(this.pageId)){let e=d.querySelectorAll("input[name=detailpage]");for(let a of e){var m;let e=ew.forms.get(a.value);if(null!=(m=await(null==e||null==e.validate?void 0:e.validate(t)))&&!m)return!1}}return!0},a.getCurrentRowIndex=function(){var e;return null==(e=this.getForm().dataset.rowindex)?"":e},a.getValue=function(e){var t;null==(t=e)?e=this.getCurrentRowIndex():t;let a={};for(let t of Object.values(this.fields)){var n;null==(n=t.element)?t.element=this.getFieldElements(t.name,e):n,a[t.name]=t.value}return a},a.getFieldValue=function(e,t){let a=this.getField(e);if(a){var n,i;return null==(n=t)?t=this.getCurrentRowIndex():n,null==(i=a.element)?a.element=this.getFieldElements(a.name,t):i,a.value}return null},a.getFieldElements=function(e,t){var a;return null==(a=t)?t=this.getCurrentRowIndex():a,this.getElements("x"+t+"_"+e)||this.getElements("x"+t+"_"+e+"[]")||this.getElements(e)},a.setFieldElement=function(e,t){let a=this.getField(e);return a&&(a.element=this.getFieldElements(a.name,t)),null==a?void 0:a.element},a.setInvalid=function(e){let t=this.getForm();if("undefined"==typeof e&&this.formKeyCountName){let e=t.querySelector(".ew-inline-insert"),a=e?0:this.keyCount,n=e?0:1,d=e?0:a||1;for(let e=n,t;e<=d;e++)t=0<=a?e+"":"",this.setInvalid(t)}else{var a;null==(a=e)?e="":a;for(let t of Object.values(this.fields)){if(t.element=this.getFieldElements(t.name,e),e&&t.resetInvalid(),t.invalid)this.addError(t.name,t.error),this._focused||this.focus();else continue;ew.setInvalid(t.element)}["add","edit"].includes(this.pageId)&&t.querySelectorAll("input[name=detailpage]").forEach((e=>{var t;return null==(t=ew.forms.get(e.value))?void 0:t.setInvalid()}))}},u(t,[{key:"error",get:function(){return this._error}},{key:"invalid",get:function(){return this._error||Object.values(this.fields).some((e=>e.invalid))}},{key:"keyCount",get:function(){var e;let t=this.formKeyCountName?null==(e=this.getForm().querySelector("#"+this.formKeyCountName))?void 0:e.value:void 0;return parseInt(t,10)}}])}((function(e,t){let n=this,i=a(n);this._initiated=!1,this.id=e,this.element=document.getElementById(e),this.$element=a(this.element),this.pageId=t,this.htmlForm=null,this.initSearchPanel=!1,this.modified=!1,this.emptyRow=null,this.multiPage=null,this.autoSuggests={},this.lists={},this.batch=new St,this.formKeyCountName="",this.submitWithFetch=!1,this.enableOnInit=!1,this.filterList=null,this.disableForm=function(){document.body.style.cursor="wait";let e=this.getForm();a(e.elements).filter(":submit:not(.dropdown-toggle), .ew-submit").prop("disabled",!0).addClass("disabled"),this.trigger("disabled")},this.enableForm=function(){let e=this.getForm(),t=a(e.elements);t.filter(".ew-disabled-element").removeClass("ew-disabled-element").prop("disabled",!1),t.filter(".ew-enabled-element").removeClass("ew-enabled-element").prop("disabled",!0),t.filter(":submit:not(.dropdown-toggle), .ew-submit").not(".ew-disabled").prop("disabled",!1).removeClass("disabled"),this.trigger("enabled"),document.body.style.cursor="default"},this.appendHidden=function(e){var t=this.getForm(),n=a(t),i=a(e).closest(".ew-form"),d=i.attr("id")+"$"+e.name;if(!n.find("input:hidden[name='"+d+"']")[0]){var r=i.find('[name="'+e.name+'"]').serializeArray();r.length?r.forEach((function(e){a('<input type="hidden" name="'+d+'">').val(e.value).appendTo(n)})):a('<input type="hidden" name="'+d+'">').val("").appendTo(n)}},this.canSubmit=async function(t){var e=this.getForm(),d=a(e),r,s;if(this.disableForm(),this.updateTextArea(),(null==(r=await(null==(s=this.validate)?void 0:s.call(this,t)))||r)&&!d.find(".is-invalid")[0]){d.find("input[name^=sv_], input[name^=p_], [name*=_query_builder_rule_], .ew-template input, .ew-custom-option").prop("disabled",!0).addClass("ew-disabled-element"),d.find("[data-readonly=1][disabled]").prop("disabled",!1).addClass("ew-enabled-element");var o=d.find("input[name=detailpage]").map((function(e,t){return d.find("#"+t.value)[0]}));1<o.length&&o.each((function(e,t){a(t).find(":input, selection-list").each((function(e,a){if(/^(fn_)?(x|o)\d*_/.test(a.name)){var i=o.not(t).find(a.tagName+"[name='"+a.name+"']");i.length&&(n.appendHidden(a),i.each((function(){n.appendHidden(this)})))}}))}));let i={form:e,result:!0},r=a.Event("beforesubmit",{originalEvent:t});d.trigger(r,[i]);let s=await i.result;if(!r.isDefaultPrevented()&&(!0===s||a.isObject(s)&&s.value))return!0}else this.enableForm();return!1},this.submit=async function(t){var e;let n=this.getForm(),i=null==t||null==(e=t.originalEvent)||null==(e=e.submitter)?void 0:e.formAction;if(i&&(i=ew.parseUrl(i).pathname,n.setAttribute("action",i)),await this.canSubmit(t)){if(this.submitWithFetch){let e=n.getAttribute("action"),t=n.method.toUpperCase(),i=a(n).serialize();return ew.fetch(e,{method:t,body:i}).finally((()=>this.enableForm()))}n.submit()}else this.enableForm()},this.getList=function(e){var t;if(a.isObject(e)){let t=e;e=t.name||t.id||"",e.includes("query_builder_rule")&&(e=t.dataset.field)}if(e=e.replace(/^(sv_)?[xy](\d*|\$rowindex\$)_|\[\]$/g,""),this.lists[e])return this.lists[e];let n=null==(t=this.getElement(e))||null==(t=t.dataset.field)?void 0:t.replace(/^x_|\[\]$/g,"");return n?this.lists[n]:{}},this.compileTemplates=function(){let e=Object.values(this.lists);for(let t of e)t.template&&a.isString(t.template)&&(t.template=a.templates(t.template))},this.getOptionTemplate=function(e){return e.template&&a.isString(e.template)&&(e.template=a.templates(e.template)),e.template},this.getForm=function(){if(!this.htmlForm){var e,t;"FORM"==(null==(e=this.element)?void 0:e.tagName)?this.htmlForm=this.element:"DIV"==(null==(t=this.element)?void 0:t.tagName)&&(this.htmlForm=this.element.closest("form"))}return this.htmlForm},this.getElement=function(e){return e?ew.getElement(e,this.$element):this.$element[0]},this.getElements=function(e){return ew.getElements(e,this.$element)},this.fixId=function(e,n,i){let d="",r=e.split(" ");1<r.length&&(d=r[0],i="",e=r[1]);let s=a.isNumber(i)?"x"+i+"_":"x_";return e=e.startsWith("x_")?e.replace(/^x_/,s):s+e,n&&!e.endsWith("[]")&&(e+="[]"),d?d+" "+e:e},this.updateList=function(e,t,n,i){var d,r;null==(d=t)?t=a.isString(e)?null==(r=Object.entries(this.lists).find((t=>t[0]==e.replace(/^x_/,""))))?void 0:r[1]:this.getList(e):d,t.template&&a.isString(t.template)&&(t.template=a.templates(t.template));let s=this.element,o=t.parentFields.slice().map((e=>this.fixId(e,!1,n))),l=t.ajax&&!t.lookupOptions.length;return e=a.isString(e)?this.fixId(e,t.multiple,n):e,!l||i?ew.updateOptions.call(this,e,o,l,!1):[e,o.map((e=>ew.getOptionValues(e,s))),l,!1]},this.updateLists=function(e,t){var i;if(null===e)return;if("grid"==this.pageId&&!a.isNumber(e)&&!a.isUndefined(e))return;let d=this.getForm();if("confirm"!=(null==d||null==(i=d.querySelector("input#confirm"))?void 0:i.value)){let i=Object.entries(this.lists).map((t=>{let[a,n]=t;return"[name='"+this.fixId(a,n.multiple,e)+"']"})).join();if(i&&this.element.querySelector(i)&&Object.entries(this.lists).map((t=>{let[a,n]=t;return this.updateList(a,n,e)})).filter((e=>Array.isArray(e))).forEach((e=>this.batch.add(ew.updateOptions.bind(this,...e)))),!this.batch.requests.length)a(document).trigger("updatedone",[{source:n,target:d}]);else if(void 0===e||t){let e=[],t=0<ew.ajaxBatchSize?ew.ajaxBatchSize:1;for(;this.batch.requests.length>t;){let a=new St;a.requests=this.batch.requests.splice(0,t),e.push(a.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)}))}0<this.batch.requests.length&&e.push(this.batch.send({url:ew.getApiUrl(ew.API_LOOKUP_ACTION)})),a.when(...e).then((()=>a(document).trigger("updatedone",[{source:n,target:d}]))).fail((e=>console.log(e))).always((()=>this.batch.clear()))}}},this.createAutoSuggest=function(e){var t=Object.assign({limit:ew.AUTO_SUGGEST_MAX_ENTRIES,form:this},ew.autoSuggestSettings,e);n.autoSuggests[e.id]=new ew.AutoSuggest(t)},this.initEditors=function(){var e=this.getForm();a(e.elements).filter("textarea.editor").each((function(e,t){var n=a(t).data("editor");!n||n.active||n.name.includes("$rowindex$")||n.create()}))},this.updateTextArea=function(e){var t=this.getForm();a(t.elements).filter("textarea.editor").each((function(t,n){var i=a(n).data("editor");return!(i&&(!e||i.name==e))||(i.save(),!e)&&void 0}))},this.destroyEditor=function(e){var t=this.getForm();a(t.elements).filter("textarea.editor").each((function(t,n){var i=a(n).data("editor");return!(i&&(!e||i.name==e))||(i.destroy(),!e)&&void 0}))},this.onError=function(e,t){return ew.onError(this,e,t)},this.initUpload=function(){var e=this.getForm();a(e.elements).filter("input:file:not([name*='$rowindex$'])").each((function(e){a.later(ew.AJAX_DELAY*e,null,ew.upload,this)}))},this.setupFilters=function(t,e){let i=this.id,d=this.filterList?this.filterList.data:null,r=a(".ew-save-filter[data-form="+i+"]").toggleClass("disabled",!d),s=a(".ew-delete-filter[data-form="+i+"]").toggleClass("disabled",!e.length).toggleClass("dropdown-toggle",!!e.length),o=s.parent("li").toggleClass("dropdown-submenu dropdown-hover",!!e.length).toggleClass("disabled",!e.length),l=r.parent("li").toggleClass("disabled",!d),c=function(e,t){ew.CLIENT_SEARCH_FILTER?localStorage.setItem(ew.PROJECT_NAME+"_"+e+"_filters",JSON.stringify(t)):ew.SERVER_SEARCH_FILTER&&(document.body.style.cursor="wait",a.ajax(ew.currentPage(),{type:"POST",dataType:"json",data:{ajax:"savefilters",filters:JSON.stringify(t)}}).done((function(e){var a;null!=(a=e[0])&&a.success&&(n.filterList.filters=t)})).always((function(){document.body.style.cursor="default"})))};if(l.off("click.ew").on("click.ew",(function(){return!l.hasClass("disabled")&&void ew.prompt({input:"text",title:ew.language.phrase("EnterFilterName")},(t=>{t=ew.sanitize(t),t&&(e.push([t,d]),c(i,e),alertify.success(ew.language.phrase("MessageAdded")).dismissOthers())}),!0)})).prevAll().remove(),s.next("ul.dropdown-menu").remove(),e.length){let t=a('<ul class="dropdown-menu"></ul>');e.forEach(((n,d,r)=>{a('<li><a class="dropdown-item" data-index="'+d+'" data-ew-action="none">'+n[0]+"</a></li>").on("click",(function(){let t=this.querySelector("a[data-index]").dataset.index;ew.prompt({title:ew.sprintf(ew.language.phrase("DeleteFilterConfirm"),n[0]),icon:"question"},(a=>{a&&(r.splice(t,1),c(i,e),alertify.success(ew.language.phrase("MessageDeleted")).dismissOthers())}))})).appendTo(t),a('<li><a class="dropdown-item ew-reset-filter-list" data-index="'+d+'" data-ew-action="none">'+n[0]+"</a></li>").insertBefore(l).on("click",(function(){if("calendar"==currentPageID)a("<form>").attr({method:"post",action:ew.currentPage()}).append(a("<input type='hidden'>").attr({name:"cmd",value:"resetfilter"}),a("<input type='hidden'>").attr({name:ew.TOKEN_NAME_KEY,value:ew.TOKEN_NAME}),a("<input type='hidden'>").attr({name:ew.ANTIFORGERY_TOKEN_KEY,value:ew.ANTIFORGERY_TOKEN}),a("<input type='hidden'>").attr({name:"filter",value:JSON.stringify(n[1])})).appendTo("body").trigger("submit");else{let e={cmd:"resetfilter",filter:JSON.stringify(n[1])};ew.refresh(ew.fetch(ew.setLayout(ew.currentPage(),!1),{method:"POST",body:e}))}}))})),a('<li class="dropdown-divider"></li>').insertBefore(l),o.append(t)}},this.on=function(){i.on(...arguments)},this.one=function(){i.one(...arguments)},this.off=function(){i.off(...arguments)},this.trigger=function(){i.trigger(...arguments)},this.init=function(){if(!this._initiated){var t=this.getForm();if(t){var i=a(t);this.compileTemplates(),/s(ea)?rch$/.test(this.id)&&(this.initSearchPanel&&!ew.hasFormData(t)&&a("#"+this.id+"_search_panel").removeClass("show"),!a(".ew-table .ew-search-operator").text().trim()&&a(".ew-table .ew-search-operator").parent("td").hide(),i.find("select[id^=z_]").each((function(){var e=a(this).trigger("change");"BETWEEN"!=e.val()&&i.find("#w_"+this.id.substring(2)).trigger("change")}))),this.multiPage&&this.multiPage.render(),loadjs.ready(["editor"],(()=>setTimeout(this.initEditors.bind(this),0))),this.updateLists(),this.initUpload(),this.$element.is("form")&&(this.$element.find(".ew-detail-pages .ew-nav a[data-bs-toggle=tab]").on("shown.bs.tab",(function(t){var e=a(t.target.getAttribute("href")),n=e.find(".table-responsive.ew-grid-middle-panel"),i=e.closest(".container-fluid");n.width()>=i.width()?n.width(i.width()+"px"):n.width("auto")})),i.off("submit.ew").on("submit.ew",(function(i){let e={form:t,result:n.submit(i)},d=a.Event("aftersubmit",{originalEvent:i});return n.trigger(d,[e]),!1})),i.find("[data-field], .ew-priv").on("change",(function(){ew.CONFIRM_CANCEL&&(n.modified=!0)})),i.find("#btn-cancel[data-href]").on("click",(function(){n.updateTextArea();var e=this.dataset.href;n.modified&&ew.hasFormData(t)?ew.prompt({title:ew.language.phrase("ConfirmCancel"),icon:"question"},(t=>{t&&(i.find("#btn-action").prop("disabled",!0),window.location=e)})):(i.find("#btn-action").prop("disabled",!0),window.location=e)}))),this._initiated=!0,this.$element.data("form",this),(this.enableOnInit||Array.from(t.elements).find((e=>e.matches("button.disabled.enable-on-init"))))&&this.enableForm(),this.trigger("initiated")}}},ew.forms.add(this)}));f(It,"autoFocus",!0),f(It,"autoFocusPreventScroll",!0),f(It,"focusDelay",200);let Ot=function(){function e(){f(this,"lists",{}),f(this,"fields",[]),f(this,"validateRequired",!1),f(this,"multiPage",!1),f(this,"submitWithFetch",!1),f(this,"initSearchPanel",!1),f(this,"enableOnInit",!1)}var t=e.prototype;return t.setId=function(e){return this.id=e,this},t.setPageId=function(e){return this.pageId=e,this},t.setLists=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&(this.lists=e),this},t.setQueryBuilderLists=function(e){if(e&&"object"==typeof e&&!Array.isArray(e)){for(let[t,a]of Object.entries(e))e[t]={...a,...{autoFillTargetFields:[],childFields:[],filterFieldVars:[],filterFields:[],parentFields:[]}};this.lists=e}return this},t.addList=function(e,t){return this.lists[e]=t,this},t.setFields=function(e){return Array.isArray(e)&&(this.fields=e),this},t.addField=function(e,t,a){return this.fields.find((t=>t[0]==e))||this.fields.push([e,t,a]),this},t.addFields=function(e){return Array.isArray(e)&&(this.fields=[...this.fields,...e]),this},t.setValidate=function(e){return this.validate=e,this},t.setCustomValidate=function(e){return this.customValidate=e,this},t.setValidateRequired=function(e){return this.validateRequired=e,this},t.setSubmit=function(e){return this.submit=e,this},t.setFormKeyCountName=function(e){return this.formKeyCountName=e,this},t.setEmptyRow=function(e){return this.emptyRow=e,this},t.setMultiPage=function(e){return this.multiPage=e,this},t.setSubmitWithFetch=function(e){return this.submitWithFetch=e,this},t.setFilterList=function(e){return this.filterList=e,this},t.setInitSearchPanel=function(e){return this.initSearchPanel=e,this},t.setEnableOnInit=function(e){return this.enableOnInit=e,this},t.build=function(){let e=new ew.Form(this.id,this.pageId);return Array.isArray(this.fields)&&e.addFields(this.fields),"function"==typeof this.validate&&(e.validate=this.validate),"function"==typeof this.customValidate&&(e.customValidate=this.customValidate),"function"==typeof this.emptyRow&&(e.emptyRow=this.emptyRow),"function"==typeof this.submit&&(e.submit=this.submit),this.formKeyCountName&&(e.formKeyCountName=this.formKeyCountName),this.multiPage&&(e.multiPage=new ew.MultiPage(this.id)),this.enableOnInit&&(e.enableOnInit=!0),this.submitWithFetch&&(e.submitWithFetch=!0,e.on("aftersubmit",((t,e)=>ew.refresh(null==e?void 0:e.result,null==e?void 0:e.context)))),this.filterList&&(e.filterList=this.filterList),this.lists&&(e.lists=this.lists),e.validateRequired=!!this.validateRequired,e.initSearchPanel=!!this.initSearchPanel,e.lists=this.lists,e},e}(),Ct=function(){function e(e){var t,n;if(f(this,"_isAutoSuggest",null),this.elementId=e.id,this.form=e.form,a.isString(this.form)&&(this.form=ew.forms.get(this.form)),this.element=this.form.getElement(this.elementId),!this.element)return;this.formElement=this.form.getElement(),this.list=this.form.getList(this.element);let i=this.elementId.match(/^[xy](\d*|\$rowindex\$)_/),d=i?i[1]:"";this.parentFields=null==(t=null==(n=this.list.parentFields)?void 0:n.slice().map((e=>1==e.split(" ").length?e.replace(/^x_/,"x"+d+"_"):e)))?[]:t,this.limit=e.limit,this.debounce=e.debounce,this.data=e.data,this.recordCount=0,this.action=e.action||"autosuggest"}var t=e.prototype;return t.formatResult=function(e){return this.form.compileTemplates(),this.list.template&&!this.isAutoSuggest?this.list.template.render(e):ew.displayValue(e,this.element)||e[0]},t.generateRequest=function(){var e=Object.assign({},this.data,{name:this.element.name,page:this.list.page,field:this.list.field,language:ew.LANGUAGE_ID},ew.getUserParams("#p_"+this.elementId,this.formElement)),t;return null==(t=e.ajax)?e.ajax=this.action:t,0<this.parentFields.length&&this.parentFields.forEach(((t,a)=>e["v"+(a+1)]=ew.getOptionValue(t,this.formElement))),e},t.getUrl=function(e,t){let n=new URLSearchParams({q:e||"",n:this.limit,rnd:ew.random(),start:a.isNumber(t)?t:-1});return ew.getApiUrl(ew.API_LOOKUP_ACTION,n.toString())},t.prepare=function(e,t){return{url:this.getUrl(e,t),type:"POST",dataType:"json",data:this.generateRequest()}},t.transform=function(e){let t=[];return"OK"==(null==e?void 0:e.result)&&(this.recordCount=e.totalRecordCount,t=e.records),t},t.toSelect2Data=function(e){if(Array.isArray(e)){if(e.every((e=>e.hasOwnProperty("gf")))){let t=[...new Set(e.map((e=>e.gf)))];return t.map((t=>({text:t,children:e.filter((e=>e.gf==t)).map((e=>({id:e.lf,text:this.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})})))})))}return e.map((e=>({id:e.lf,text:this.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})})))}return e},u(e,[{key:"isAutoSuggest",get:function(){var e;return null==(e=this._isAutoSuggest)?this._isAutoSuggest=ew.isAutoSuggest(this.element):e,this._isAutoSuggest}},{key:"options",get:function(){return this.list.lookupOptions}}])}(),Nt=function(e){function t(t){var n;if(n=e.call(this,t)||this,!n.element)return m(n);if(n.input=n.form.getElement("sv_"+n.elementId),!n.input||n.elementId.includes("$rowindex$"))return m(n);let r=n,s=a(n.input),o=a(n.element);n.minWidth=t.minWidth,n.maxHeight=t.maxHeight,n.highlight=t.highlight,n.hint=t.hint,n.minLength=t.minLength,n.templates=Object.assign({},t.templates),n.classNames=Object.assign({},t.classNames),n.delay=t.delay,n.debounce=t.debounce,n.display=t.display||"text",n.forceSelection=t.forceSelect,n.lineHeight=t.lineHeight,n.paddingY=t.paddingY,n.lookupAllDisplayFields=t.lookupAllDisplayFields,n.$input=s,n.$element=o,o.data("autosuggest",n),s.val()&&o.val()&&n.element.add(o.val(),s.val(),!0),s.on("typeahead:select",((t,e)=>{r.setValue(e[r.display])})).on("change",(()=>{let e=s.data("tt-typeahead");if(null!=e&&e.isOpen()&&!e.menu.empty()){let t=e.menu.getActiveSelectable();if(t){let e=t.index(),a=r.element.options[e].text;s.typeahead("val",a)}}r.setValue()})).on("blur",(()=>{let e=s.data("tt-typeahead");null!=e&&e.isOpen()&&e.menu.close()})).on("focus",(()=>{s.attr("placeholder",s.data("placeholder")).removeClass("is-invalid"),o.removeClass("is-invalid")}));let l=!n.options.length,c=!1,u=r.list.template||r.templates.suggestion,p;u&&a.isString(u)&&(u=a.templates(u)),u&&(r.templates.suggestion=u.render.bind(u)),l&&!r.templates.footer&&(r.templates.footer='<div class="tt-footer dropdown-item"><div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">'+ew.language.phrase("LoadingMore")+"</span></div></div>");let g=(e,t,i)=>{if(l)p&&p.cancel(),p=a.later(n.debounce,null,(()=>{n.recordCount=0,a.ajax(n.prepare(e)).done((e=>i(n.transform(e))))}));else{let a=n.getSyncResults(e);t(n.transform({result:"OK",totalRecordCount:a.length,records:a}))}};return a((function(){let e={highlight:r.highlight,minLength:r.minLength,hint:r.hint,classNames:r.classNames},t={name:r.form.id+"-"+r.elementId,source:g,async:l,templates:r.templates,display:r.display,limit:l?r.limit:1/0},n=[e,t];o.trigger("typeahead",[n]),r.typeahead=s.typeahead.apply(s,n).off("blur.tt").data("tt-typeahead");let i=r.typeahead.menu,d=i.$node,u=d.find(".tt-dataset"),p=()=>d.find(".tt-suggestion").outerHeight(!1);if(r.minWidth&&d.css("min-width",r.minWidth),s.on("typeahead:rendered",((t,e)=>{let a=e.length,n=r.count;if(n>=r.limit){let e=p();e&&u.css("max-height",e*r.limit)}0<a&&u.scrollTop(p()*(n-a)),l&&d.find(".tt-footer").toggle(r.recordCount>n)})),l){let e;u.on("scroll",(()=>{var t;null==(t=e)||t.cancel(),e=a.later(r.delay,null,(()=>{let t=d.find(".tt-footer");if(!t.is(":hidden")&&!c){let n=u.offset().top+u.outerHeight(!1),i=t.offset().top+t.outerHeight(!1);if(n+20>i)c=!0,r.getMore().always((()=>c=!1));else{var a;null==(a=e)||a.cancel()}}}))}))}})),n}g(t,e);var n=t.prototype;return n.setValue=function(e){e||(e=this.$input.val());let t=this.element.options.findIndex((t=>t.text==e));if(!(0>t))this.element.options[t].selected=!0,(!/s(ea)?rch$/.test(this.formElement.id)||this.forceSelection)&&(e=this.element.options[t].value);else if(this.forceSelection&&e)return this.$input.typeahead("val","").addClass("is-invalid"),this.$element.next(".invalid-feedback").html(ew.language.phrase("ValueNotExist")),void this.$element.addClass("is-invalid").val("").trigger("change");e!==this.$element.attr("value")&&this.$element.attr("value",e).trigger("change")},n.transform=function(t){let a=e.prototype.transform.call(this,t).map((t=>Object.assign({},t,{text:e.prototype.formatResult.call(this,t)})));return this.element.options=a.map((e=>new ew.SelectionListOption(e.text,e.lf||e[0]))),a},n.getSyncResults=function(e){if(this.options.length){let t=this.options.filter((t=>{if(this.lookupAllDisplayFields){let a=[t.df,t.df2,t.df3,t.df4].map((e=>(e+"").toLowerCase())).join(" ");return e.toLowerCase().split(" ").filter((e=>""!==e)).every((e=>a.includes(e)))}return(t.df+"").toLowerCase().startsWith(e)}));return this.recordCount=t.length,t}return[]},n.getMore=function(){let e=this.typeahead.menu,t=this.count,n=this.prepare(e.query,t);return a.ajax(n).done((t=>e.datasets[0]._append(e.query,this.transform(t))))},u(t,[{key:"count",get:function(){return this.typeahead.menu.$node.find(".tt-suggestion.tt-selectable").length||0}}])}(Ct),Pt=function(){function e(){f(this,"_forms",{})}var t=e.prototype;return t.get=function(e){var t;if(!e)return null;let n=a.isString(e)?e:null==(t=ew.getForm(e))?void 0:t.id;return this._forms[n]},t.add=function(e){this._forms[e.id]&&this._forms[e.id]!==e&&delete this._forms[e.id],this._forms[e.id]=e},t.ids=function(){return Object.keys(this._forms)},e}(),Rt=ew.language.phrase("select2");var Ft={errorLoading:function(){return Rt.errorLoading},inputTooLong:function(e){var t=e.input.length-e.maximum;return sprintf(Rt.inputTooLong,t)},inputTooShort:function(e){var t=e.minimum-e.input.length;return sprintf(Rt.inputTooShort,t)},loadingMore:function(){return'<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">'+Rt.loadingMore+"</span></div>"},maximumSelected:function(e){return sprintf(Rt.maximumSelected,e.maximum)},noResults:function(){return Rt.noResults},searching:function(){return'<div class="spinner-border spinner-border-sm text-primary" role="status"><span class="visually-hidden">'+Rt.searching+"</span></div>"},removeAllItems:function(){return Rt.removeAllItems},removeItem:function(){return Rt.removeItem},search:function(){return Rt.search}};let kt=a.fn.select2.amd.require._defined,Lt=kt["select2/utils"],Dt=function(){function e(){}var t=e.prototype;return t.render=function(){var e=a('<div class="select2-results__options '+this.options.get("containerClass")+'" role="listbox"></div>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e,e},t.displayMessage=function(e,t){var n=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var i=a('<div role="alert" aria-live="assertive" class="select2-results__option"></div>');if(t.message.includes("<")&&t.message.includes(">"))i.append(t.message);else{var d=this.options.get("translations").get(t.message);i.append(n(d(t.args)))}i[0].className+=" select2-results__message",this.$results.append(i)},t.append=function(e,t){if(this.hideLoading(),null==t.results||0===t.results.length)return void(0===this.$results.children().length&&(this.$element.data("updating")&&t.pagination.more?(this.trigger("results:message",{message:'<div class="spinner-border spinner-border-sm text-primary ew-select-spinner" role="status"><span class="visually-hidden">'+ew.language.phrase("Loading")+"</span></div> "+ew.language.phrase("Loading")}),this.$element.one("updated",(()=>this.$element.select2("close").select2("open")))):this.trigger("results:message",{message:"noResults"})));t.results=this.sort(t.results);for(var n=this.options.get("columns"),r=t.results.length,s=this.$results.find("."+this.options.get("rowClass")).last(),o=0;o<t.results.length;o++){var l=t.results[o],c=this.option(l);if(s.length&&s.children().length!=n||(s=a('<div class="'+this.options.get("rowClass")+'"></div>'),this.$results.append(s)),s.append(c),o==r-1)for(var u=n-s.children().length,p=0;p<u;p++)s.append('<div class="'+this.options.get("cellClass")+'"></div>')}},t.option=function e(t,a){var e=document.createElement("div");e.classList.add("select2-results__option"),e.classList.add("select2-results__option--selectable"),this.options.get("cellClass").split(" ").forEach((t=>e.classList.add(t)));var n={role:"option","aria-selected":"false"},i=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(var d in(null!=a.element&&i.call(a.element,":disabled")||null==a.element&&a.disabled)&&(n["aria-disabled"]="true",e.classList.remove("select2-results__option--selectable"),e.classList.add("select2-results__option--disabled")),null==a.id&&e.classList.remove("select2-results__option--selectable"),null!=a._resultId&&(e.id=a._resultId),a.title&&(e.title=a.title),n){var r=n[d];e.setAttribute(d,r)}return this.template(a,e),Lt.StoreData(e,"data",a),e},e}(),Mt=a.fn.select2.amd.require._defined,Ut=Mt["select2/utils"],Bt=function(){function e(){}var t=e.prototype;return t.bind=function(e,t,n){var i=this,d;e.call(this,t,n),null==(d=t.listeners["results:select"])||d.pop(),this.$results.off("mouseup"),t.on("results:select",(function(e){var t=i.getHighlightedResults();if(0!==t.length){var a=Ut.GetData(t[0],"data");t.hasClass("select2-results__option--selected")?i.trigger("unselect",{originalEvent:e,data:a}):i.trigger("select",{originalEvent:e,data:a})}})),this.$results.on("mousedown",".select2-results__option--selectable",(function(){this._mousedown=!0})),this.$results.on("mouseup",".select2-results__option--selectable",(function(e){if(this._mousedown){var t=a(this),n=Ut.GetData(this,"data");return t.hasClass("select2-results__option--selected")?void i.trigger("unselect",{originalEvent:e,data:n}):void i.trigger("select",{originalEvent:e,data:n})}}))},e}(),jt=function(){function e(){}var t=e.prototype;return t.bind=function(e,t,a){var n=this,i;e.call(this,t,a),null==(i=t.listeners.close)||i.pop(),t.on("close",(function(){n.$search.attr("tabindex",-1).removeAttr("aria-controls").removeAttr("aria-activedescendant")}))},e}(),$t=$.fn.select2.amd.require._defined["select2/keys"];$t.PRINT_SCREEN=44;let Kt=function(){function e(){}var t=e.prototype;return t.handleSearch=function(e,t){var a=t.which;if(![$t.TAB,$t.SHIFT,$t.CTRL,$t.ALT,$t.PRINT_SCREEN].includes(a)){if(!this._keyUpPrevented){var n=this.$search.val();this.trigger("query",{term:n})}this._keyUpPrevented=!1}},e}(),Vt=a.fn.select2.amd.require._defined["select2/dropdown/attachBody"],qt=function(e){function t(t,a,n){return e.call(this,t,a,n)||this}g(t,e);var n=t.prototype;return n._attachPositioningHandler=function(e,t){var n=this,i=["scroll.select2."+t.id,"resize.select2."+t.id,"orientationchange.select2."+t.id],d=()=>{n._positionDropdown(),n._resizeDropdown()};a(window).on(i.join(" "),d),t.$element.closest(".modal").on("scroll.select2."+t.id,d)},n._detachPositioningHandler=function(e,t){var n=["scroll.select2."+t.id,"resize.select2."+t.id,"orientationchange.select2."+t.id];a(window).off(n.join(" ")),t.$element.closest(".modal").off("scroll.select2."+t.id)},n._showDropdown=function(){var e;this.$dropdownContainer.appendTo(this.$dropdownParent),null==(e=this._popper)?this._popper=Popper.createPopper(this.$container[0],this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:!0},{name:"preventOverflow",enabled:!0}]}):e,this._positionDropdown(),this._resizeDropdown()},n._positionDropdown=function(){var e;null==(e=this._popper)||e.update()},n.destroy=function(t){var a;e.prototype.destroy.call(this,t),null==(a=this._popper)||a.destroy(),this._popper=null},t}(Vt),Wt=function(){function e(e,t,n){f(this,"$modal",null),n.set("dropdownParent",a(document.body)),e.call(this,t,n)}var t=e.prototype;return t.bind=function(e,t,a){let n=this;e.call(this,t,a),t.on("open",(function(){n._showDropdown(),n._bindContainerResultHandlers(t)})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},t.position=function(e,t,a){t.attr("class",a.attr("class")),t.removeClass("select2"),this.$container=a},t.render=function(e){let t=a("<span></span>"),n=e.call(this);return t.append(n),this.$dropdownContainer=t,t},t._bindContainerResultHandlers=function(e,t){if(this._containerResultsHandlersBound)return;let a=this;t.$modal=this.$modal,t.on("results:all",(function(){var e;a._updateDropdown(),null==(e=a.$search[0])||e.focus()})),t.on("results:append",(function(){a._updateDropdown()})),t.on("results:message",(function(){a._updateDropdown()})),t.on("select",(function(t){var e;let n=null==(e=t.originalEvent)?void 0:e.currentTarget;null==n||n.classList.add("select2-results__option--selected"),a._updateDropdown()})),t.on("unselect",(function(t){var e;let n=null==(e=t.originalEvent)?void 0:e.currentTarget;null==n||n.classList.remove("select2-results__option--selected"),a._updateDropdown()})),this._containerResultsHandlersBound=!0},t._updateDropdown=function(){this.$modal.find(this.$dropdownContainer)[0]||this.$modal.find(".modal-body").children().detach().end().append(this.$dropdownContainer)},t._showDropdown=function(){var e;let t=this,n=this.$element.val();this.$dropdownContainer.appendTo(this.options.get("dropdownParent")),null==(e=this.$modal)?this.$modal=a("#ew-modal-lookup-dialog"):e,this._updateDropdown(),this.$modal.find(".modal-title").empty().append(sprintf(ew.language.phrase("LookupTitle"),this.$element.data("caption"))),this.$modal.find(".modal-footer button[data-value]").off().on("click",(function(){a(this).data("value")||t.$element.val(n).trigger("change")})),this.$modal.modal("show").on("hidden.bs.modal",(function(){t.$container.removeClass("select2-container--open")})).draggable(this.options.get("draggableOptions"))},e}(),Gt=a.fn.select2.amd.require._defined["select2/dropdown/attachBody"],Ht=function(e){function t(t,a,n){return e.call(this,t,a,n)||this}g(t,e);var n=t.prototype;return n.bind=function(e,t,a){var n=this;e.call(this,t,a),t.on("open",(function(){n._showDropdown(),n._bindContainerResultHandlers(t)})),t.on("close",(function(){n._hideDropdown()})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},n._positionDropdown=function(){var e;null==(e=this._popper)||e.update()},n._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},n._showDropdown=function(){var e,t;this.$dropdownContainer.appendTo(this.$dropdownParent);let n=this,i=this.$element.val(),d=a("#ew-filter-dropdown-footer").contents().clone();d.find(".ew-filter-btn[data-value]").off("click.ew").on("click.ew",(function(){let e=a(this).data("value");e?a(n.$element[0].form).triggerHandler("submit"):n.$element.val(i).trigger("change"),n.$element.select2("close")})),d.find(".ew-filter-clear").off("click.ew").on("click.ew",(t=>n.$element.data("select2").selection._handleClear(t)));let r=this.$dropdownContainer.find(".ew-filter-dropdown");r.find(".ew-filter-btn")[0]||r.append(d);var s=document.querySelector(".ew-filter-dropdown-btn[data-table="+this.$element.data("table")+"][data-field="+this.$element.data("field")+"]"),o=null==(e=s.closest(".ew-table-header-cell"))?s.closest(".ew-table-header-btn"):e;null==(t=this._popper)?this._popper=Popper.createPopper(o,this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:!0},{name:"preventOverflow",enabled:!0}]}):t,this._positionDropdown(),this._resizeDropdown()},n.position=function(e,t,a){t.attr("class",a.attr("class")),t[0].classList.remove("select2"),t[0].classList.add("select2-container--open"),this.$container=a},n.destroy=function(t){var a;e.prototype.destroy.call(this,t),null==(a=this._popper)||a.destroy(),this._popper=null},t}(Gt),Yt=a.fn.select2.amd.require._defined["select2/dropdown/attachBody"],zt=function(e){function t(t,a,n){return e.call(this,t,a,n)||this}g(t,e);var a=t.prototype;return a.bind=function(e,t,a){var n=this;e.call(this,t,a),t.on("open",(function(){n._showDropdown(),n._bindContainerResultHandlers(t)})),t.on("close",(function(){n._hideDropdown()})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},a._showDropdown=function(){var e;this.$dropdownContainer.appendTo(this.$dropdownParent),null==(e=this._popper)?this._popper=Popper.createPopper(this.$element.parent().find(".select2-container")[0],this.$dropdownContainer[0],{placement:ew.IS_RTL?"bottom-end":"bottom-start",modifiers:[{name:"flip",enabled:!0},{name:"preventOverflow",enabled:!0}]}):e,this._positionDropdown(),this._resizeDropdown()},a._positionDropdown=function(){var e;null==(e=this._popper)||e.update()},a.position=function(e,t,a){t.attr("class",a.attr("class")),t[0].classList.remove("select2"),t[0].classList.add("select2-container--open"),this.$container=a},a.destroy=function(t){var a;e.prototype.destroy.call(this,t),null==(a=this._popper)||a.destroy(),this._popper=null},t}(Yt),Jt=a.fn.select2.amd.require._defined,Xt=Jt["select2/selection/allowClear"],Zt=Jt["select2/utils"],Qt=function(e){function t(){return e.apply(this,arguments)||this}g(t,e);var a=t.prototype;return a._handleClear=function(e,t){if(!this.isDisabled()){var a=this.$selection.find(".select2-selection__clear");if(0!==a.length){t.stopPropagation();var n=Zt.GetData(a[0],"data"),i=this.$element.val();this.$element.val(this.placeholder.id);var r={data:n};if(this.trigger("clear",r),r.prevented)return void this.$element.val(i);for(var s=0;s<n.length;s++)if(r={data:n[s]},this.trigger("unselect",r),r.prevented)return void this.$element.val(i);this.$element.trigger("input").trigger("change")}}},t}(Xt),ea=function(){function e(){}var t=e.prototype;return t.bind=function(e,t,a){e.call(this,t,a),this.$selection.on("click",".select2-selection__choice__remove",(function(e){e.stopPropagation()}))},e}(),ta=function(){function e(){}var t=e.prototype;return t.option=function(e,t){var a=t.text,n=null==(d=t.element)?void 0:d.innerHTML,i=e.call(this,t),d;return a.startsWith("<")&&a.endsWith(">")?i.html(a):n&&n!=a&&i.html(n),i},e}(),aa=$.fn.select2.amd.require._defined,na=aa["select2/results"],ia=aa["select2/selection/single"],da=aa["select2/selection/multiple"],ra=aa["select2/selection/placeholder"],sa=aa["select2/selection/allowClear"],oa=aa["select2/selection/search"],la=aa["select2/selection/eventRelay"],ca=aa["select2/utils"],ua=aa["select2/translation"],pa=aa["select2/data/select"],ga=aa["select2/data/array"],fa=aa["select2/data/ajax"],ma=aa["select2/data/tags"],ha=aa["select2/data/tokenizer"],ba=aa["select2/data/minimumInputLength"],wa=aa["select2/data/maximumInputLength"],ya=aa["select2/data/maximumSelectionLength"],_a=aa["select2/dropdown"],va=aa["select2/dropdown/search"],Ea=aa["select2/dropdown/hidePlaceholder"],Aa=aa["select2/dropdown/infiniteScroll"],Sa=aa["select2/dropdown/minimumResultsForSearch"],Ta=aa["select2/dropdown/selectOnClose"],xa=aa["select2/dropdown/closeOnSelect"],Ia=aa["select2/dropdown/dropdownCss"],Oa=aa["select2/dropdown/tagsSearchHighlight"],Ca=aa["select2/defaults"];Ca.apply=function(e){return e=$.extend(!0,{},this.defaults,e),null==e.dataAdapter&&(e.dataAdapter=null==e.ajax?null==e.data?pa:ga:fa,e.dataAdapter=ca.Decorate(e.dataAdapter,ta),0<e.minimumInputLength&&(e.dataAdapter=ca.Decorate(e.dataAdapter,ba)),0<e.maximumInputLength&&(e.dataAdapter=ca.Decorate(e.dataAdapter,wa)),0<e.maximumSelectionLength&&(e.dataAdapter=ca.Decorate(e.dataAdapter,ya)),e.tags&&(e.dataAdapter=ca.Decorate(e.dataAdapter,ma)),(null!=e.tokenSeparators||null!=e.tokenizer)&&(e.dataAdapter=ca.Decorate(e.dataAdapter,ha))),null==e.resultsAdapter&&(e.resultsAdapter=na,0<e.columns&&e.customOption?(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Dt),e.iconClass&&e.multiple&&e.templateResult==ew.selectOptions.templateResult&&(e._templateResult=e.templateResult,e.templateResult=t=>t.loading?t.text:'<div class="form-check-input ew-dropdown-check-input"></div><label class="'+e.iconClass+' ew-dropdown-check-label">'+e._templateResult(t)+"</label>")):(e.modal||e.filter)&&(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Bt)),null!=e.ajax&&(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Aa)),null!=e.placeholder&&(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Ea)),e.selectOnClose&&(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Ta)),e.tags&&(e.resultsAdapter=ca.Decorate(e.resultsAdapter,Oa))),null==e.dropdownAdapter&&(e.modal||e.filter?(e.dropdownAdapter=ca.Decorate(_a,va),e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,Kt),e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,jt)):(e.dropdownAdapter=_a,!e.multiple&&(e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,va),e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,Kt))),0!==e.minimumResultsForSearch&&(e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,Sa)),e.closeOnSelect&&(e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,xa)),null!=e.dropdownCssClass&&(e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,Ia)),e.dropdownAdapter=ca.Decorate(e.dropdownAdapter,e.modal?Wt:e.filter?Ht:e.dropdown?zt:qt)),null==e.selectionAdapter&&(e.multiple?(e.selectionAdapter=da,e.selectionAdapter=ca.Decorate(e.selectionAdapter,ea)):e.selectionAdapter=ia,null!=e.placeholder&&(e.selectionAdapter=ca.Decorate(e.selectionAdapter,ra)),e.allowClear&&(e.selectionAdapter=ca.Decorate(e.selectionAdapter,e.filter?Qt:sa)),e.multiple&&(e.selectionAdapter=ca.Decorate(e.selectionAdapter,oa)),e.selectionAdapter=ca.Decorate(e.selectionAdapter,la)),e.translations=new ua(Ft),e.dir=ew.IS_RTL?"rtl":"ltr",e};let Na=new URL(window.location),Pa=new Pt,Ra=a(document),Fa=a("body"),ka=".row, [id^=el_], [class^=el_], form";Pace.on("done",(()=>{var e;let t=document.querySelector(".modal.show form.ew-form")||document.querySelector("form.ew-form");null==(e=Pa.get(null==t?void 0:t.id))||e.tryFocus()})),Ra.on("ajaxSend",(function(e,t,a){let n=a.url,i=n.startsWith(w()),d=i||n.startsWith(ew.PATH_BASE)||n.startsWith(He());if(!d&&n.match(/^http/i)){let e=new URL(n);d=e.hostname==Na.hostname}if(d)if(i)ew.API_JWT_TOKEN&&t.setRequestHeader(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN);else if(Se(a.type,"POST")&&ew.TOKEN_NAME&&ew.ANTIFORGERY_TOKEN)if(a.data instanceof FormData)a.data.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME),a.data.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN);else{let e=A(new URLSearchParams(a.data),{[ew.TOKEN_NAME_KEY]:ew.TOKEN_NAME,[ew.ANTIFORGERY_TOKEN_KEY]:ew.ANTIFORGERY_TOKEN});a.data=e.toString()}})),Ra.on("ajaxStart",(function(){Ra.data("_ajax",!0),a("form.ew-form").addClass("ew-wait").each((function(){let e=Pa.get(this.id);!e||e.multiPage&&e.multiPage.lastPageSubmit||e.disableForm()}))})),Ra.on("ajaxStop ajaxError",(function(){a("form.ew-form.ew-wait").removeClass("ew-wait").each((function(){let e=Pa.get(this.id);!e||e.multiPage&&e.multiPage.lastPageSubmit||e.enableForm()})),Ra.data("_ajax",!1)}));let La=n.DateTime,Da=n.Interval;var Ma;loadjs.ready("foot",(()=>{t.PUSH_SERVER_PUBLIC_KEY&&dt()?navigator.serviceWorker.register(t.PATH_BASE+t.SERVICE_WORKER,{scope:t.PATH_BASE}).then((()=>{pt(),a("#subscribe-notification").on("click",(function(){this.classList.contains("ew-enable-notification")?ut():gt()}))})).catch((t=>console.log(t))):a("#subscribe-notification").addClass("d-none")}));a((function(){a("#ew-modal-dialog").on("load.ew",(()=>ht())),a(document).on("preview.ew",(()=>ht()))}));var Ua,Ba;ew.UA_PARSER=new UAParser(window.navigator.userAgent),ew.IS_MOBILE="mobile"==(null==(Ua=ew.UA_PARSER.getDevice())?void 0:Ua.type),ew.BROWSER_NAME=null==(Ba=ew.UA_PARSER.getBrowser())?void 0:Ba.name,window.exportCharts={},Object.assign(ew,{MultiPage:function(e){var t=this;this.$form=null,this.formID=e,this.pageIndex=1,this.maxPageIndex=0,this.minPageIndex=0,this.pageIndexes=[],this.$pages=null,this.$collapses=null,this.isTab=!1,this.isCollapse=!1,this.lastPageSubmit=!1,this.hideDisabledButton=!1,this.hideInactivePages=!1,this.lockTabs=!1,this.hideTabs=!1,this.showPagerTop=!1,this.showPagerBottom=!1,this.pagerTemplate='<nav><ul class="pagination"><li class="page-item previous ew-prev"><a href="#" class="page-link"><i class="fa-solid fa-angle-left"></i> {Prev}</a></li><li class="page-item next ew-next"><a href="#" class="page-link">{Next} <i class="fa-solid fa-angle-right"></i></a></li></ul></nav>';var n=function(t){t.preventDefault()},d=["lastPageSubmit","hideDisabledButton","hideInactivePages","lockTabs","hideTabs","showPagerTop","showPagerBottom","pagerTemplate"];this.set=function(){if(1==arguments.length&&a.isObject(arguments[0])){var e=arguments[0];for(var t in e){var n=t[0].toLowerCase()+t.substring(1);d.includes(n)&&(this[n]=e[t])}}},this.init=function(){var e=this.pagerTemplate.replace(/\{prev\}/i,ew.language.phrase("Prev")).replace(/\{next\}/i,ew.language.phrase("Next"));this.isTab?(this.showPagerTop&&this.$pages.closest(".ew-nav").before(e),this.showPagerBottom&&this.$pages.closest(".ew-nav").after(e),this.$form.find(".ew-prev").click((function(){return t.$pages.off("show.bs.tab",n).filter(".active").parent().prev(":has([data-bs-toggle=tab]:not(.ew-hidden):not(.ew-disabled))").find("[data-bs-toggle=tab]").toggleClass("disabled d-none",!1).click(),!1})),this.$form.find(".ew-next").click((function(){return t.$pages.off("show.bs.tab",n).filter(".active").parent().next(":has([data-bs-toggle=tab]:not(.ew-hidden):not(.ew-disabled))").find("[data-bs-toggle=tab]").toggleClass("disabled d-none",!1).click(),!1})),this.hideTabs&&this.$form.find(".ew-multi-page > .ew-nav > .nav").hide()):this.isCollapse&&(this.showPagerTop&&this.$collapses.closest(".ew-accordion").before(e),this.showPagerBottom&&this.$collapses.closest(".ew-accordion").after(e),this.$form.find(".ew-prev").click((function(){return t.$pages.closest(".accordion-item").filter(":has(.collapse.show)").prev(":has([data-bs-toggle=collapse]:not(.ew-hidden):not(.ew-disabled))").toggleClass("disabled d-none",!1).find("[data-bs-toggle=collapse]").click(),!1})),this.$form.find(".ew-next").click((function(){return t.$pages.closest(".accordion-item").filter(":has(.collapse.show)").next(":has([data-bs-toggle=collapse]:not(.ew-hidden):not(.ew-disabled))").toggleClass("disabled d-none",!1).find("[data-bs-toggle=collapse]").click(),!1}))),this.pageShow()},this.pageShow=function(){this.isTab?(this.lockTabs&&this.$pages.on("show.bs.tab",n),this.$pages.each((function(){var e=a(this);t.hideInactivePages&&e.toggleClass("d-none",!e.hasClass("active")),t.lockTabs&&e.toggleClass("disabled",!e.hasClass("active"))}))):this.isCollapse&&this.$pages.closest(".accordion-item").each((function(){var e=a(this);t.hideInactivePages&&e.toggleClass("d-none",!e.find(".collapse.show")[0])}));var e=this.lastPageSubmit&&this.pageIndex!=this.maxPageIndex,i=this.$form.closest(".content, .modal-content").find("#btn-action, button.ew-submit").prop("disabled",e).toggle(!this.hideDisabledButton||!e);a(".ew-captcha").toggle(i.is(":visible:not(:disabled)")),e=this.pageIndex<=this.minPageIndex,this.$form.find(".ew-prev").toggleClass("disabled",e),e=this.pageIndex>=this.maxPageIndex,this.$form.find(".ew-next").toggleClass("disabled",e)},this.gotoPage=function(e){if(!(0>=e||e<this.minPageIndex||e>this.maxPageIndex)&&this.pageIndex!=e){var t=this.$pages.eq(e-1);if(this.isTab)t.is(":not(.d-none):not(.disabled)")?t.click():t.parent().next(":has([data-bs-toggle=tab]):not(.d-none):not(.disabled)").find("[data-bs-toggle=tab]").toggleClass("disabled",!1).click();else if(this.isCollapse){var a=t.closest(".accordion-item");a.is(":not(.d-none)")?t.click():a.next(":has([data-bs-toggle=collapse]):not(.d-none)").find("[data-bs-toggle=collapse]").click()}this.pageIndex=e}},this.gotoPageByIndex=this.gotoPage,this.gotoPageByElement=function(e){this.gotoPage(parseInt(a(e).data("page"),10)||-1)},this.gotoPageByElementId=function(e){var t=this.$form.find("[data-page]").filter("[id='"+e+"'],[name='"+e+"'],[data-field='"+e+"']");this.gotoPageByElement(t)},this.togglePage=function(e,t){this.isTab?this.$pages.eq(e-1).toggleClass("d-none",!t):this.isCollapse&&this.$pages.eq(e-1).closest(".accordion-item").toggle("d-none",!t)},this.render=function(){this.$form=a("#"+e),this.pageIndexes=this.$form.find("[data-page]").map((function(){var e=parseInt(this.dataset.page,10);return 0<e?e:null})).get(),this.pageIndexes.sort((function(e,t){return e-t})),this.minPageIndex=this.pageIndexes[0],this.maxPageIndex=this.pageIndexes[this.pageIndexes.length-1];var n=this.$form.find("[data-bs-toggle=tab]");if(n[0])this.$pages=n,this.isTab=!0,n.on("shown.bs.tab",(function(i){t.pageIndex=n.index(i.target)+1,t.pageShow(),a(a(this).attr("href")).find(".ew-map").each((function(){var e=ew.maps[this.id];null!=e&&e.map&&(google.maps.event.trigger(e.map,"resize"),e.map.setCenter(e.latlng))}))})),this.pageIndex=n.index(n.parent(".active"))+1;else if(this.$collapses=this.$form.find("[data-bs-toggle=collapse]"),this.$collapses[0]){this.$pages=this.$collapses,this.isCollapse=!0;var i=this.$collapses;i.on("shown.bs.collapse",(function(n){t.pageIndex=i.index(n.target)+1,t.pageShow(),a(this).find(".ew-map").each((function(){var e=ew.maps[this.id];null!=e&&e.map&&(google.maps.event.trigger(e.map,"resize"),e.map.setCenter(e.latlng))}))})),this.pageIndex=i.index(i.hasClass("show"))+1}a((function(){t.init()}))}},Form:It,FormBuilder:Ot,Validators:{__proto__:null,between:function(e){let t,n;if(e.id.startsWith("y_")?(t=document.getElementById(e.id.replace(/^y_/,"x_")),n=document.getElementById(e.id.replace(/^y_/,"z_"))):e.id.endsWith("_value_1")&&(t=document.getElementById(e.id.replace(/_value_1$/,"_value_0")),n=document.getElementById(e.id.replace(/_value_1$/,"_operator"))),ew.hasValue(t)&&"BETWEEN"==a(n).val().toUpperCase()&&!ew.hasValue(e)){var i;return{between:ew.language.phrase(null==(i=e.dataset.error)?"EnterValue2":i)}}return!1},captcha:function(e){if(e&&!ew.hasValue(e)){var t;return{captcha:ew.language.phrase(null==(t=e.dataset.error)?"EnterValidateCode":t)}}return!1},creditCard:function(e){let t=ew.getValue(e);if(!ew.checkCreditCard(t)){var a;return{creditCard:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectCreditCard":a)}}return!1},custom:function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return function(t){if("function"==typeof e){var n,i;let d=ew.getValue(t);if(!e(d,...a))return{custom:ew.language.phrase(null==(n=null==(i=t.dataset.error)?t.dataset.error:i)?"IncorrectValue":n)}}return!1}},datetime:function(e){return function(t){let a=ew.getValue(t);if(!ew.checkDate(a,e)){var n;return{datetime:_t.sprintf(ew.language.phrase(null==(n=t.dataset.error)?"IncorrectDate":n),e)}}return!1}},email:function(e){let t=ew.getValue(e);if(!ew.checkEmail(t)){var a;return{email:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectEmail":a)}}return!1},emails:function(e,t){return function(a){let n=ew.getValue(a);return!ew.checkEmails(n,e)&&{emails:t}}},fileRequired:function(e){return function(t){let a=document.getElementById("fn_"+t.id);if(a&&!ew.hasValue(a)){var n;return{fileRequired:_t.sprintf(ew.language.phrase(null==(n=t.dataset.error)?"EnterRequiredField":n),e)}}return!1}},float:function(e){let t=ew.getValue(e);if(!ew.checkNumber(t)){var a;return{float:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectFloat":a)}}return!1},guid:function(e){let t=ew.getValue(e);if(!ew.checkGuid(t)){var a;return{guid:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectGUID":a)}}return!1},integer:function(e){let t=ew.getValue(e);if(!ew.checkInteger(t)){var a;return{integer:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectInteger":a)}}return!1},max:r,maxDate:function(e){return function(t){let a=ew.getValue(t),n=t.dataset.formatPattern,i;if(e="function"==typeof e?e():e,e instanceof HTMLElement){let t=e.value,a=e.dataset.formatPattern;e.value&&e.dataset.formatPattern&&(i=ew.parseDate(t,a))}else e instanceof Date?i=At.fromJSDate(e,{zone:"utc"}):e instanceof At&&(i=e);if(a&&n&&i){var d;let e=ew.parseDate(a,n);if(e>i)return{maxDate:_t.sprintf(ew.language.phrase(null==(d=t.dataset.error)?"IncorrectMaxDate":d),ew.formatDateTime(i,ew.DATE_FORMAT+" "+ew.TIME_FORMAT))}}return!1}},min:d,minDate:function(e){return function(t){let a=ew.getValue(t),n=t.dataset.formatPattern,i;if(e="function"==typeof e?e():e,e instanceof HTMLElement){let t=e.value,a=e.dataset.formatPattern;e.value&&e.dataset.formatPattern&&(i=ew.parseDate(t,a))}else e instanceof Date?i=At.fromJSDate(e,{zone:"utc"}):e instanceof At&&(i=e);if(a&&n&&i){var d;let e=ew.parseDate(a,n);if(e<i)return{minDate:_t.sprintf(ew.language.phrase(null==(d=t.dataset.error)?"IncorrectMinDate":d),ew.formatDateTime(i,ew.DATE_FORMAT+" "+ew.TIME_FORMAT))}}return!1}},mismatchPassword:function(e){let t;e.id.startsWith("c_")?t=e.id.replace(/^c_/,"x_"):"cpwd"==e.id&&(t="npwd");let a=document.getElementById(t);if(e.value!==a.value){var n;return{mismatchPassword:ew.language.phrase(null==(n=e.dataset.error)?"MismatchPassword":n)}}return!1},password:function(e){return function(t){var a;return!(e||ew.ENCRYPTED_PASSWORD||!t.value.match(new RegExp("["+ew.escapeRegExChars(ew.INVALID_PASSWORD_CHARACTERS)+"]")))&&{password:ew.language.phrase(null==(a=t.dataset.error)?"InvalidPasswordChars":a)}}},passwordStrength:function(e){let t=a(e);if(!ew.isMaskedPassword(e)&&t.hasClass("ew-password-strength")&&!t.data("validated")){var n;return{passwordStrength:ew.language.phrase(null==(n=e.dataset.error)?"PasswordTooSimple":n)}}return!1},phone:function(e){let t=ew.getValue(e);if(!ew.checkPhone(t)){var a;return{phone:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectPhone":a)}}return!1},range:function(e,t){return function(a){let n=ew.getValue(a);if(!ew.checkRange(n,e,t)){var i;return{range:_t.sprintf(ew.language.phrase(null==(i=a.dataset.error)?"IncorrectRange":i),e,t)}}return!1}},recaptcha:function(e){var t;if(e&&!ew.hasValue(e)&&""===(null==(t=grecaptcha)?void 0:t.getResponse(e.dataset.id))){var a;return{recaptcha:ew.language.phrase(null==(a=e.dataset.error)?"ClickReCaptcha":a)}}return!1},regex:function(e){return function(t){let a=ew.getValue(t);if(!ew.checkByRegEx(a,e)){var n,i;return{regex:ew.language.phrase(null==(n=null==(i=t.dataset.error)?t.dataset.error:i)?"IncorrectValueRegExp":n)}}return!1}},required:function(e){return function(t){var n;let i=a(t),d=i.closest("#r_"+(null==(n=i.data("field"))?void 0:n.substring(2)));if(d[0]||(d=i.closest("[id^=el]")),"none"==d.css("display"))return!1;if(t&&!ew.hasValue(t)){var r;return{required:_t.sprintf(ew.language.phrase(null==(r=t.dataset.error)?"EnterRequiredField":r),e)}}return!1}},ssn:function(e){let t=ew.getValue(e);if(!ew.checkSsn(t)){var a;return{ssn:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectSSN":a)}}return!1},time:function(e){return function(t){let a=ew.getValue(t);if(!ew.checkTime(a,e)){var n;return{time:_t.sprintf(ew.language.phrase(null==(n=t.dataset.error)?"IncorrectTime":n),e)}}return!1}},url:function(e){let t=ew.getValue(e);if(!ew.checkUrl(t)){var a;return{url:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectUrl":a)}}return!1},userLevelId:function(e){var t,a;if(e&&!ew.checkInteger(e.value))return{userLevelId:ew.language.phrase(null==(t=e.dataset.error)?"UserLevelIDInteger":t)};let n=parseInt(e.value,10);return!!(1>n)&&{userLevelId:ew.language.phrase(null==(a=e.dataset.error)?"UserLevelIDIncorrect":a)}},userLevelName:function(e){return function(t){let a=document.getElementById("x_"+e);if(a&&t){let e=t.value.trim(),s=parseInt(a.value.trim(),10);if(0===s&&!ew.sameText(e,"Default")){var n;return{userLevelName:ew.language.phrase(null==(n=t.dataset.error)?"UserLevelDefaultName":n)}}if(-1===s&&!ew.sameText(e,"Administrator")){var i;return{userLevelName:ew.language.phrase(null==(i=t.dataset.error)?"UserLevelAdministratorName":i)}}if(-2===s&&!ew.sameText(e,"Anonymous")){var d;return{userLevelName:ew.language.phrase(null==(d=t.dataset.error)?"UserLevelAnonymousName":d)}}if(0<s&&["anonymous","administrator","default"].includes(e.toLowerCase())){var r;return{userLevelName:ew.language.phrase(null==(r=t.dataset.error)?"UserLevelNameIncorrect":r)}}}return!1}},username:function(e){return function(t){var a;return!(e||!t.value.match(new RegExp("["+ew.escapeRegExChars(ew.INVALID_USERNAME_CHARACTERS)+"]")))&&{username:ew.language.phrase(null==(a=t.dataset.error)?"InvalidUsernameChars":a)}}},zip:function(e){let t=ew.getValue(e);if(!ew.checkZip(t)){var a;return{zip:ew.language.phrase(null==(a=e.dataset.error)?"IncorrectZip":a)}}return!1}},maps:{__proto__:null,done:mt,init:ht,show:ft}},{__proto__:null,AjaxLookup:Ct,AutoSuggest:Nt,Field:xt,Form:It,Select2Defaults:Ca,Select2Utils:ca,_export:ee,addEventHandlers:function(e){let t=ew.events[e];if(t)for(const[n,i]of Object.entries(t))a("[data-table="+e+"][data-field="+n+"]").on(i)},addGridRow:function(e){var t;let n=null==e?void 0:e.closest(".ew-grid"),i=a(n),d=i.find("table.ew-table").last(),r=d.parent("div"),s=d.find("tr.ew-template");if(!e||!n||!d[0]||!s[0])return!1;let o=a(d[0].rows).last();d.find("td.ew-table-last-row").removeClass("ew-table-last-row");let l=s.clone(!0,!0).removeClass("ew-template"),c=n.querySelector("div.ew-form[id^=f][id$=grid]")||n.querySelector("form.ew-form[id^=f][id$=list]")||n.querySelector("form.ew-form[id^=f][id$=grid]"),u=a(c),p=u.is("div")?"_"+c.id:"",g=u.find("#"+ew.FORM_KEY_COUNT_NAME+p),f=parseInt(g.val(),10)+1,m=ew.FORM_ROW_ACTION_NAME.replace(/^k_/,"k"+f+"_")+p,h=s.find("script:contains('$rowindex$')").add("tr.ew-template + script[data-rowindex='$rowindex$']");l.attr({id:"r"+f+l.attr("id").substring(2),"data-rowindex":f}),l.children("td").each((function(){a(this).find("*").each((function(){a.each(this.attributes,(function(e,t){t.value=t.value.replace(/\$rowindex\$/g,f)}))}))}));let b=l.find(".ew-icon").closest("a, button");null==(t=bootstrap.Tooltip.getInstance(b[0]))||t.dispose(),b.tooltip({...ew.tooltipOptions,container:"body",trigger:"hover"}),g.val(f).after(a("<input>").attr({type:"hidden",id:m,name:m,value:"insert"})),o.after(l),h.get().forEach((e=>Ue(e.text.replace(/\$rowindex\$/g,f,e.nonce))));let w=u.data("form");return null==w||w.initEditors(),null==w||w.initUpload(),be(d[0],!0),r.scrollTop(r[0].scrollHeight),d.trigger("rowadded",[f]),!1},addOptionDialogShow:function(e){var t;e.lnk=e.lnk||(null==(t=e.evt)?void 0:t.currentTarget);var n=ew.addOptionDialog||a("#ew-add-opt-dialog").on("hidden.bs.modal",(function(){Be(n.data("args").el);var e=n.removeData("args").find(".modal-body form").data("form");e&&e.destroyEditor(),n.find(".modal-body").html(""),n.find(".modal-footer .btn-primary").off(),n.data("showing",!1)}));if(!n[0])return void K({title:"DIV #ew-add-opt-dialog not found.",icon:"error"});if(!n.data("showing")){n.data("showing",!0);var i=function(e){var t=e,d=n.data("args"),r=Pa.get(d.lnk),s=n.find(".modal-body form input[name='"+ew.API_OBJECT_NAME+"']").val(),o=d.el,l=/^x(\d+)_/,c=o.match(l),u=c?c[0]:"x_",p=c?c[1]:-1,g=o.replace(l,"x_"),f=r.getList(o),m;if(a.isString(e)&&(t=M(e)),null!=(m=t)&&m.success&&t[s]){n.modal("hide");var h=t[s],b=r.$element[0],w=_e(o,b);if(w){var y=f.linkField,_=f.displayFields.slice(),v=f.filterFields.slice(),E=f.parentFields.slice();E.forEach(((e,t)=>{1==e.split(" ").length&&(E[t]=E[t].replace(/^x_/,u))}));var A=""==y?"":h[y],S={lf:A};if(_.forEach(((e,t)=>{e in h&&(S["df"+(0<t?t+1:"")]=h[e])})),v.forEach(((e,t)=>{e in h&&(S["ff"+(0<t?t+1:"")]=h[e])})),A&&0<_.length&&S.df){null===f.ajax&&f.lookupOptions.push(S);var T=E.map((e=>xe(e,b))),d={data:S,parents:T,valid:!0,name:Ne(w),form:b};if(Ra.trigger("addoption",[d]),d.valid){var x=$e(w),I=Fe(w,S,b);w.options&&(w.options[w.options.length-1].selected=!0,w.list&&a(w.target).find("input").last().trigger("focus"),ie(w)?(a(w).val(A).trigger("change"),a(w.input).val(I).trigger("focus")):a(w).trigger("change").trigger("focus"));var O=a(b),C=O.is("div")?"_"+b.id:"",N=O.find("#"+ew.FORM_KEY_COUNT_NAME+C).val();if(0<N)for(var R=1;R<=N;R++)if(R!=p){var F=_e(g.replace(/^x/,"x"+R),b),k=$e(F);JSON.stringify(x)==JSON.stringify(k)&&(Fe(F,S,b),null==F.render||F.render())}}}}}else{var L;if(null!=(L=t)&&L.error){let e=P(t);e&&K({title:e,icon:"error"})}else{var D=a("<div></div>").html(e).find("div.ew-message-dialog"),U;if(D[0])U=D.html();else{var B;U=(null==(B=t)?void 0:B.failureMessage)||e,U&&""!=(U+"").trim()||(U=ew.language.phrase("InsertFailed"))}K({title:U,icon:"info"})}}},d=function(e){n.modal("hide"),K("Server Error "+e.status+": "+e.statusText)},r=async function(t){let e=ew.addOptionDialog,n=e.find(".modal-body form")[0],r=Pa.get(n.id),s=null==t?void 0:t.target,o=a(s);return await r.canSubmit(t)&&(o.prop("disabled",!1).removeClass("disabled"),document.body.style.cursor="wait",a.post(w([ew.API_ADD_ACTION,n.elements[ew.API_OBJECT_NAME].value]),a(n).serialize(),i).fail(d).always((function(){r.enableForm(),o.prop("disabled",!1).removeClass("disabled"),document.body.style.cursor="default"}))),!1};n.modal("hide"),n.data("args",e);var s=function(t){var d=Pa.get(e.lnk),s="x_",o=e.el.match(/^(x\d+_)/);o&&(s=o[1]);var i=d.getList(e.el),l=i.parentFields.slice().map((e=>1==e.split(" ").length?e.replace(/^x_/,s):e)),c=d.htmlForm,u=l.map((e=>xe(e,c))),p=l.map((e=>Oe(e,c))),g=i.filterFieldVars.slice();n.find(".modal-title").html(a(e.lnk).closest(".ew-add-opt-btn").data("title")),n.find(".modal-body").html(Me(t));var c=n.find(".modal-body form")[0];c&&a(c).on("keydown",(function(t){if("Enter"==t.key&&"TEXTAREA"!=t.target.nodeName)return r()})),ew.addOptionDialog=n.modal("show"),n.find(".modal-footer .btn-primary").click(r).focus(),c&&u.forEach(((e,t)=>{var a=_e(g[t],c);a&&e[0]&&(ie(a)?(a.value=e[0],a.input.value=p[t][0],a.add(e[0],p[t][0],!0)):a.options||a.length?Fe(a,{lf:e[0]},d,!0):a.value=e[0])})),De(t,e.el,!0),n.trigger("load.ew")};return a.get(e.url,s).fail(d),!1}},addScript:Ue,ajax:function(e,t){if(a.isObject(e)&&(e.url||e.action)){var n;e.url?e.url.startsWith(w())?n=e.url.replace(w(),"").split("/")[0]:e.url.startsWith(ew.API_URL)&&(n=e.url.replace(ew.API_URL,"").split("/")[0]):(n=e.action,delete e.action);var i=Object.assign({},e),d=e=>{if(a.isObject(e)&&"OK"==e.result){var t=e.records;return Array.isArray(t)&&1==t.length?(t=t[0],Array.isArray(t)&&1==t.length?t[0]:t):t}return e},r=i.url||w(n),s=i.type||([ew.API_LIST_ACTION,ew.API_VIEW_ACTION,ew.API_DELETE_ACTION].includes(n)?"GET":"POST");if(delete i.url,delete i.type,i.dataType="json",j(t))a.ajax({url:r,type:s,data:i,success:function(e){t(d(e))}});else{var o=a.ajax({url:r,async:!1,type:s,data:i});return d(o.responseJSON)}}},alert:K,applyTemplate:function(e,t,n,i,d,r,s){let o={data:r||{},id:e,template:t,class:n,export:i,enabled:!0};if(Ra.trigger("rendertemplate",[o]),o.enabled){var l;let n=s?document.querySelector("#ew-modal-dialog.show"):document.body,i=null==n||null==(l=n.querySelector("#"+t))?void 0:l.content;if(!i)return;if(i.querySelectorAll(".ew-slot").forEach((e=>{let t=e.name||e.id,a=n.querySelector("#"+t);null!=a&&a.content?(1<e.dataset.rowspan&&Array.prototype.slice.call(a.content.childNodes).forEach((t=>t.rowSpan=e.dataset.rowspan)),e.replaceWith(a.content.cloneNode(!0))):e.remove()})),a.views){let t=i.textContent,d=t.includes("{{")&&t.includes("}}");if(!d){let e=ew.jsRenderAttributes.map((e=>"["+e+"*='{{']["+e+"*='}}']")).join(",");d=i.querySelector(e)}if(d){let t=Array.prototype.slice.call(i.querySelectorAll("script"));t.forEach((e=>e.remove()));let d=document.createElement("div");d.appendChild(i);let r=d.innerHTML.replace(/{{([^}]+)}}/g,(e=>ye(e))),s=a.templates(r);n.querySelector("#"+e).innerHTML=s.render(o.data),t.forEach((e=>document.body.appendChild(e)))}else n.querySelector("#"+e).appendChild(i)}else n.querySelector("#"+e).appendChild(i)}i&&"print"!=i&&J(e,i,d)},autoFill:Ve,buildUrl:x,checkByRegEx:function(e,t){return!(e&&0!=e.length)||!!e.match(t)},checkCreditCard:function(e){if(!e||0==e.length)return!0;var t=e.replace(/\D/g,"");if(0==t.length)return!1;for(var a=1!=t.length%2,n=0,d=0,r=t.length,s;d<r;d++)s=parseInt(t.charAt(d),10),a?(s*=2,n+=s%10,1<=s/10&&n++,a=!1):(n+=s,a=!0);return 0==n%10},checkDate:function(e,t){return!(e&&0!=e.length)||et(e,t).isValid},checkEmail:Je,checkEmails:function(e,t){if(!e||0==e.length)return!0;for(var a=e.replace(/,/g,";").split(";"),n=0,d=a.length;n<d;n++){if(0<t&&d>t)return!1;if(!Je(a[n]))return!1}return!0},checkGuid:function(e){return!(e&&0!=e.length)||/^(\{\w{8}-\w{4}-\w{4}-\w{4}-\w{12}\}|\w{8}-\w{4}-\w{4}-\w{4}-\w{12})$/.test(e.trim())},checkInteger:function(e){return!(e&&0!=e.length)||!e.includes(ew.DECIMAL_SEPARATOR)&&ze(e)},checkNumber:ze,checkPhone:function(e){return!(e&&0!=e.length)||/^\(\d{3}\) ?\d{3}( |-)?\d{4}|^\d{3}( |-)?\d{3}( |-)?\d{4}$/.test(e.trim())},checkRange:function(e,t,n){return!(e&&0!=e.length)||((a.isNumber(t)||a.isNumber(n))&&ze(e)&&(e=ew.parseNumber(e)),!(null!==t&&e<t)&&!(null!==n&&e>n))},checkSsn:function(e){return!(e&&0!=e.length)||/^(?!000)([0-6]\d{2}|7([0-6]\d|7[012]))([ -]?)(?!00)\d\d\3(?!0000)\d{4}$/.test(e.trim())},checkTime:function(e,t){return!(e&&0!=e.length)||et(e,t).isValid},checkUrl:function(e){if(!e||0==e.length)return!0;try{new URL(e)}catch(t){return!1}return!0},checkZip:function(e){return!(e&&0!=e.length)||/^\d{5}$|^\d{5}-\d{4}$/.test(e.trim())},clearDelete:me,clearError:function(e){if(e.jquery){let t=e.attr("type");e="checkbox"==t||"radio"==t?e.get():e[0]}a(e).closest(ka).find(".invalid-feedback").html("")},clearOptions:Ce,clearSelected:fe,clickDelete:he,confirmDelete:function(e){return he(e),V({title:ew.language.phrase("DeleteConfirm"),icon:"question"},(t=>{t&&(e.dataset.json&&e.href?ew.modalDialogShow({url:E(e.href,{action:"delete"}),lnk:e,json:!0,callback:!0}):e.href?window.location=O(E(e.href,{action:"delete"})):me(e))})),!1},convertToBool:Z,copyToClipboard:Ye,createFilter:function(e){if(!e.selectId.includes("$rowindex$")){if(a.isObject(e.data)){let t=new ew.AjaxLookup(e.data);e.data=t.options.map((e=>({id:e.lf,text:t.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})})))}if(a.isObject(e.ajax)){let t=e.ajax.limit,n=new ew.AjaxLookup({...e.ajax,...{action:"modal"}});e.ajax={url:e=>{let a=e.page?(e.page-1)*t:-1;return n.getUrl(e.term,a)},type:"POST",dataType:"json",data:n.generateRequest.bind(n),delay:e.debounce,processResults:function(e){var t,a;let i=this;return{results:n.transform(e).map((e=>({id:e.lf,text:n.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})}))),pagination:{more:i.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+(null==(t=null==(a=e.records)?void 0:a.length)?0:t)<n.recordCount}}},transport:(e,t,n)=>a.ajax(e).then((e=>{let a=P(e);a&&K({title:a,icon:"error"}),t(e)})).fail(n)}}let t=a("select[data-select2-id='"+e.selectId+"']").select2(e);t.on("select2:open",(function(){var t;null==(t=a(this).data("select2").$dropdown.find(".select2-search__field").addClass("form-control")[0])||t.focus({preventScroll:e.preventScroll})})),a.isObject(e.ajax)&&t.on("select2:opening",(function(){a(this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()}))}},createModalLookup:function(e){if(!e.selectId.includes("$rowindex$")){if(a.isObject(e.data)){let t=new ew.AjaxLookup(e.data);e.data=t.options.map((e=>({id:e.lf,text:t.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})})))}if(a.isObject(e.ajax)){let t=e.ajax.limit,n=new ew.AjaxLookup({...e.ajax,...{action:"modal"}});e.ajax={url:e=>{let a=e.page?(e.page-1)*t:-1;return n.getUrl(e.term,a)},type:"POST",dataType:"json",data:n.generateRequest.bind(n),delay:e.debounce,processResults:function(e){var t,a;let i=this;return{results:n.transform(e).map((e=>({id:e.lf,text:n.formatResult({lf:e.lf,df:e.df,df2:e.df2,df3:e.df3,df4:e.df4})}))),pagination:{more:i.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+(null==(t=null==(a=e.records)?void 0:a.length)?0:t)<n.recordCount}}},transport:(e,t,n)=>a.ajax(e).then((e=>{let a=P(e);a&&K({title:a,icon:"error"}),t(e)})).fail(n)}}let t=a("select[data-select2-id='"+e.selectId+"']").select2(e);t.on("select2:open",(function(){var e;null==(e=a(this).data("select2").$dropdown.find(".select2-search__field").addClass("form-control")[0])||e.focus({preventScroll:!0})})),a.isObject(e.ajax)&&t.on("select2:opening",(function(){a(this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()}))}},createSearchParams:_,createSelect:function(e){if(!e.selectId.includes("$rowindex$")){if(a.isObject(e.data)){let t=new ew.AjaxLookup(e.data);e.data=t.toSelect2Data(t.options)}if(a.isObject(e.ajax)){let t=e.ajax.limit,n=new ew.AjaxLookup({...e.ajax,...{action:"modal"}});e.ajax={url:e=>{let a=e.page?(e.page-1)*t:-1;return n.getUrl(e.term,a)},type:"POST",dataType:"json",data:n.generateRequest.bind(n),delay:e.debounce,processResults:function(e){var t,a;let i=this;return{results:n.toSelect2Data(n.transform(e)),pagination:{more:i.container.$results.find(".select2-results__option:not(.select2-results__option--load-more)").length+(null==(t=null==(a=e.records)?void 0:a.length)?0:t)<n.recordCount}}},transport:(e,t,n)=>a.ajax(e).then((e=>{let a=P(e);a&&K({title:a,icon:"error"}),t(e)})).fail(n)}}let t={name:e.name,options:e};Ra.trigger("select2",[t]);let n=a("select[data-select2-id='"+e.selectId+"']").select2(t.options);n.on("select2:open",(function(){var e;null==(e=a(this).data("select2").$dropdown.find(".select2-search__field")[0])||e.focus({preventScroll:!0})})),a.isObject(e.ajax)&&n.on("select2:opening",(function(){a(this).data("select2").$results.find(".select2-results__option:not(.loading-results)").remove()})),e.minimumResultsForSearch===1/0&&n.on("select2:opening select2:closing",(function(){a(this).data("select2").$dropdown.find(".select2-search--dropdown").addClass("select2-search--hide")}))}},currentPage:He,currentUrl:Na,deleteGridRow:function(e,t){var n;null==(n=bootstrap.Tooltip.getInstance(e))||n.dispose();let i=e.closest(".ew-grid, .ew-multi-column-grid"),d=e.closest("tr, div[data-rowindex]"),r=null==d?void 0:d.closest(".ew-table"),s=parseInt(null==d?void 0:d.dataset.rowindex,10),o=(null==i?void 0:i.querySelector("div.ew-form[id^=f][id$=grid]"))||(null==i?void 0:i.querySelector("form.ew-form[id^=f][id$=list], form.ew-form[id^=f][id$=grid]")),l=a(o),c=l.data("form");if(!e||!i||!d||!o||!c)return!1;let u=l.is("div")?"_"+o.id:"",p="#"+ew.FORM_KEY_COUNT_NAME+u,g=function(){if(d.remove(),i.classList.contains(".ew-grid")&&be(r,!0),0<s){let e=l.find("#k"+s+"_action"+u);e[0]?e.val("insert"==e.val()?"insertdelete":"delete"):l.find(p).after(a("<input>").attr({type:"hidden",id:"k"+s+"_action"+u,name:"k"+s+"_action"+u,value:"delete"}))}a(r).trigger("rowdeleted",[s])};return j(c.emptyRow)&&c.emptyRow(t)?g():V({title:ew.language.phrase("DeleteConfirm"),icon:"question"},(e=>{e&&g()})),!1},deleteSearchParam:T,disable2FA:function(e){V({title:sprintf(ew.language.phrase("2FARemoveConfirm"),ew.language.phrase("2FAType"+e)),preConfirm:t=>{if(t)return a.get(w([ew.API_2FA_ACTION,ew.API_2FA_RESET,ew.CURRENT_USER_IDENTIFIER,e])).then((t=>{var n;if(null!=t&&null!=(n=t.error)&&n.description)W(t.error.description);else if(!(null!=t&&t.success))!0!==(null==t?void 0:t.success)&&W(sprintf(ew.language.phrase("2FARemoveFailed"),ew.language.phrase("2FAType"+e)));else if(a.isObject(t.config)){ew.vars.twofa=t.config;for(let e of["config2fa","select2fa","verify2fa"])ew.refreshTemplate(e,t.config)}})).fail(((e,t,a)=>W(a)))}})},displayValue:Re,emailDialogShow:function(e){let t=ew.emailDialog||a("#ew-email-dialog").on("shown.bs.modal",(t=>setTimeout((()=>{var e;return null==(e=t.target.querySelector(".modal-body .form-control"))?void 0:e.focus()}),200))).on("click",".modal-footer .btn-primary",(function(n){var e;n.preventDefault(),null!=(e=a(this).closest(".modal").find(".modal-body form").data("form"))&&e.submit()&&t.modal("hide")}));if(!t[0])return K("DIV #ew-email-dialog not found."),!1;let n=e.evt.currentTarget.form;if(e.exportSelected&&!pe(n))return K({title:ew.language.phrase("NoRecordSelected"),icon:"warning"}),!1;let i=t.find(".modal-body form"),d=i.data("form");return d||(d=(new Ot).setId(i.attr("id")).addFields([["sender",[ew.Validators.required(ew.language.phrase("Sender")),ew.Validators.email]],["recipient",[ew.Validators.required(ew.language.phrase("Recipient")),ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperRecipientEmail"))]],["cc",ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperCcEmail"))],["bcc",ew.Validators.emails(ew.MAX_EMAIL_RECIPIENT,ew.language.phrase("EnterProperBccEmail"))],["subject",ew.Validators.required(ew.language.phrase("Subject"))]]).setValidate((function(){return this.validateFields()})).setSubmit((function(){if(!this.validate())return!1;let d=A(i.serialize(),e.key,Q(),n&&e.exportSelected?a(n).find("input[type=checkbox][name='key_m[]']:checked").serialize():null);return t.modal("hide"),e.custom?ee({...e,...{export:"email",custom:!0,emailForm:i[0]}}):Ge(i.find("#tblvar").val(),d),!1})).build(),i.data("form",d)),ew.emailDialog=t.modal("hide").find(".modal-title").html(e.hdr).end().modal("show"),!1},enable2FA:function(e){if(document.body.style.cursor="wait",Se(e,"google")){let t=w([ew.API_2FA_ACTION,ew.API_2FA_SHOW,ew.CURRENT_USER_IDENTIFIER,e]);a.get(t,(t=>{var n;null!=t&&t.url?V({imageUrl:t.url,title:ew.language.phrase("Scan2FAQrCode"),input:"text",confirmButtonText:ew.language.phrase("Verify"),showLoaderOnConfirm:!0,allowEscapeKey:!1,allowOutsideClick:()=>!Swal.isLoading(),willOpen:()=>{Swal.showLoading(Swal.getConfirmButton()),Swal.disableInput(),Swal.getImage().onload=()=>{Swal.enableInput(),Swal.hideLoading(),Swal.getInput().focus()}},preConfirm:t=>a.get(w([ew.API_2FA_ACTION,ew.API_2FA_VERIFY,ew.CURRENT_USER_IDENTIFIER,e,t])).then((e=>{if(!0!==(null==e?void 0:e.success))throw new Error(ew.language.phrase("2FAVerificationFailed"));return e})).catch((e=>Swal.showValidationMessage(e)))},(e=>{var t;if(null!=e&&null!=(t=e.error)&&t.description)W(e.error.description);else if(null!=e&&e.success&&a.isObject(e.config)){ew.vars.twofa=e.config;for(let t of["config2fa","select2fa","verify2fa"])ew.refreshTemplate(t,e.config)}})).catch((e=>W(null==e?void 0:e.message))):null!=t&&null!=(n=t.error)&&n.description&&K({title:t.error.description,icon:"error"})})).fail(((e,t,a)=>W(a))).always((()=>document.body.style.cursor="default"))}else{let t=w([ew.API_2FA_ACTION,ew.API_2FA_SHOW,ew.CURRENT_USER_IDENTIFIER,e]),n=Se(e,"email")?ew.language.phrase("EnterOTPEmailAddress"):ew.language.phrase("EnterOTPPhoneNumber");a.get(t,(t=>{var i;t.success?V({title:n,input:"text",inputValue:t.account,confirmButtonText:ew.language.phrase("SendOtp"),showLoaderOnConfirm:!0,allowEscapeKey:!1,allowOutsideClick:()=>!Swal.isLoading(),preConfirm:t=>a.get(w([ew.API_2FA_ACTION,ew.API_2FA_SEND_OTP,ew.CURRENT_USER_IDENTIFIER,e,t])).then((e=>{if(!0!==(null==e?void 0:e.success))throw new Error(sprintf(ew.language.phrase("SendOtpFailed"),P(e)));return e})).catch((e=>Swal.showValidationMessage(e)))},(t=>{var n;null!=t&&null!=(n=t.error)&&n.description?W(t.error.description):null!=t&&t.success&&V({title:ew.language.phrase("EnterSecurityCode"),input:"text",confirmButtonText:ew.language.phrase("Verify"),showLoaderOnConfirm:!0,allowEscapeKey:!1,allowOutsideClick:()=>!Swal.isLoading(),preConfirm:t=>a.get(w([ew.API_2FA_ACTION,ew.API_2FA_VERIFY,ew.CURRENT_USER_IDENTIFIER,e,t])).then((e=>{if(!0!==(null==e?void 0:e.success))throw new Error(ew.language.phrase("2FAVerificationFailed"));return e})).catch((e=>Swal.showValidationMessage(e)))},(e=>{var t;if(null!=e&&null!=(t=e.error)&&t.description)W(e.error.description);else if(null!=e&&e.success&&a.isObject(e.config)){ew.vars.twofa=e.config;for(let t of["config2fa","select2fa","verify2fa"])ew.refreshTemplate(t,e.config)}})).catch((e=>W(null==e?void 0:e.message)))})).catch((e=>W(null==e?void 0:e.message))):null!=t&&null!=(i=t.error)&&i.description&&K({title:t.error.description,icon:"error"})})).fail(((e,t,a)=>W(a))).always((()=>document.body.style.cursor="default"))}return!1},escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},executeScript:De,export:ee,exportCustom:J,exportEmail:Ge,fetch:Le,fieldContainerSelector:ka,fileDownload:R,filter:function(t){let e=t.currentTarget.dataset;a("select[data-select2-id='f"+e.table+"srch_"+e.field+"']").select2("open")},fixLayoutHeight:it,formatCurrency:function(e,t){if(t||(t=ew.CURRENCY_FORMAT),t.includes(";")){let a=t.split(";");t=0<=e?a[0]:a[1]}t=t.replace("¤","$");let a=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);return"latn"==ew.NUMBERING_SYSTEM&&(a.numeralSystem=void 0),a.delimiters.thousands!==ew.GROUPING_SEPARATOR&&(a.delimiters.thousands=ew.GROUPING_SEPARATOR),a.delimiters.decimal!==ew.DECIMAL_SEPARATOR&&(a.delimiters.decimal=ew.DECIMAL_SEPARATOR),ew.format(e,t,{locale:a,currency:(ew.IS_RTL?"‎":"")+ew.CURRENCY_SYMBOL})},formatDateTime:Qe,formatNumber:function(e,t){let a=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);return"latn"==ew.NUMBERING_SYSTEM&&(a.numeralSystem=void 0),a.delimiters.thousands!==ew.GROUPING_SEPARATOR&&(a.delimiters.thousands=ew.GROUPING_SEPARATOR),a.delimiters.decimal!==ew.DECIMAL_SEPARATOR&&(a.delimiters.decimal=ew.DECIMAL_SEPARATOR),ew.format(e,t||ew.NUMBER_FORMAT,{locale:a})},formatPercent:function(e,t){let a=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);return"latn"==ew.NUMBERING_SYSTEM&&(a.numeralSystem=void 0),a.delimiters.thousands!==ew.GROUPING_SEPARATOR&&(a.delimiters.thousands=ew.GROUPING_SEPARATOR),a.delimiters.decimal!==ew.DECIMAL_SEPARATOR&&(a.delimiters.decimal=ew.DECIMAL_SEPARATOR),ew.format(e,t||ew.PERCENT_FORMAT,{locale:a})},formatTimeSpan:function(e,t,a){let n=La.fromJSDate(e,{zone:"utc"}),i=La.fromJSDate(t,{zone:"utc"});i.isValid&&i.equals(i.startOf("day"))&&(i=i.minus(1));let d=new Da({start:n,end:i});if(d.isValid){let e=d.count()/864e5;a||(a=Number.isInteger(e)&&1<=e)}return a?d.isValid&&1<d.count("days")||n.isValid&&i.isValid&&n.startOf("day")<i.startOf("day")?Qe(n,ew.DATE_FORMAT)+" - "+Qe(i,ew.DATE_FORMAT):n.isValid&&!t?Qe(n,ew.DATE_FORMAT):"":n.isValid&&i.isValid?n.startOf("day")<i.startOf("day")?Qe(n,ew.DATE_FORMAT+" "+ew.TIME_FORMAT)+" - "+Qe(i,ew.DATE_FORMAT+" "+ew.TIME_FORMAT):Qe(n,ew.TIME_FORMAT)+" - "+Qe(i,ew.TIME_FORMAT):n.isValid?Qe(n,ew.TIME_FORMAT):""},forms:Pa,getAncestorBy:Ee,getApiUrl:w,getContent:je,getElement:ve,getElements:_e,getError:P,getForm:G,getId:Ne,getNumberingSystem:function(){return ew.NUMBERING_SYSTEM||new Intl.NumberFormat(ew.LANGUAGE_ID).resolvedOptions().numberingSystem},getOptionTexts:Oe,getOptionValue:Ie,getOptionValues:xe,getOptions:$e,getQueryBuilderFilterInput:function(){return function(e,t){var a,n;let i=this.status.id.replace(/_query_builder$/,""),d=e.filter.id,r=null==(a=document.getElementById("tpx_"+i+"_"+d))||null==(a=a.content)?void 0:a.cloneNode(!0).querySelector(".ew-search-field"),s=null==(n=null==r?void 0:r.innerHTML.replace(/\binvalid-feedback\b/,ew.queryBuilderErrorClass).replace(new RegExp('(data-field=")?(\\b|_)x_'+d+"(\\[\\]|\\b)","g"),((e,a,n)=>a?e:n+t)))?"":n;return'<div class="d-inline-flex position-relative">'+s+"</div>"}},getQueryBuilderFilterValidation:function(e){return{callback:function(t,n){let d=n.$el.find(".rule-value-container"),r=0;for(let s=0;s<n.operator.nb_inputs;s++)d.find("[name='"+n.id+"_value_"+s+"']").each((function(){let t=a(this),n=t.next("."+ew.queryBuilderErrorClass).empty();null==e||null==e.forEach||e.forEach((e=>{let t=e(this);a.isObject(t)&&(r++,n.append("<span>"+Object.values(t)[0]+"</span>"))})),n.html()&&t.addClass("is-invalid").one("click",(()=>t.removeClass("is-invalid")))}));return!r||""}}},getQueryBuilderValueSetter:function(){return function(e,t){let n=e.$el.find(".rule-value-container").find("select, selection-list, input[name^=sv_], input[data-field]")[0],i=Array.isArray(t)?t:a.isValue(t)?[t]:[];if(null!=n&&n.matches("select, selection-list")){let e=Pa.get(n);i.forEach((t=>Fe(n,{lf:t},e,!0))),e.updateList(n,void 0,void 0,!0)}else ew.selectOption(n,i);return null}},getSearchParam:function(e,t){return v(e).get(t)},getSearchParams:v,getUserParams:z,getValue:function(e,t){let n=e;return a.isString(e)?n=2==e.split(" ").length?_e(e):_e(e,t):["checkbox","radio"].includes(e.type)&&(n=_e(e)),n?n.options?n.list?"select-multiple"==n.type?n.values:n.value:a(n).val():Array.isArray(n)?n.length?a(n).filter(":checked").map(((e,t)=>t.value)).get():void 0:oe(n)?n.checked?n.value:void 0:ew.isHiddenTextArea(n)?(a(n).data("editor").save(),n.value):n.value:void 0},getchartParams:Q,hasFormData:function(e){for(var t="[name^=x_],[name^=y_],[name^=z_],[name^=w_],[name="+ew.TABLE_BASIC_SEARCH+"]",n=a(e).find(t).filter(":enabled").get(),d=0,r=n.length,s;d<r;d++)if(s=n[d],/^(z|w)_/.test(s.name)){if(/^IS/.test(a(s).val()))return!0}else if("checkbox"==s.type||"radio"==s.type){if(s.checked)return!0}else if("select-one"==s.type||"select-multiple"==s.type){if(!!a(s).val())return!0}else if(["text","textarea","password","search","color","date","datetime-local","datetime","email","hidden","month","number","range","tel","time","url","week"].includes(s.type)&&s.value)return!0;return!1},hasValue:function(e){return""!=Ie(e)},headerCase:function(e){return e?(e+"").replace(/^[^A-Za-z0-9]*|[^A-Za-z0-9]*$/g,"").replace(/([a-z])([A-Z])/g,((e,t,a)=>t+"_"+a.toLowerCase())).replace(/[^A-Za-z0-9]+|_+/g,"-").toLowerCase().replace(/(-?)(\w+)(-?)/g,((e,t,a,n)=>t+a.charAt(0).toUpperCase()+a.slice(1)+n)):""},htmlDecode:ye,htmlEncode:function(e){return(e+"").replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},importDialogShow:function(e){var t,n;e.lnk=e.lnk||(null==(t=e.evt)?void 0:t.currentTarget),null==(n=bootstrap.Tooltip.getInstance(e.lnk))||n.hide();let i=ew.importDialog||a("#ew-import-dialog");if(!i[0])return K("DIV #ew-import-dialog not found."),!1;let d=i.find("#importfiles"),r=d.closest(".ew-file-drop-zone"),s=i.find(".modal-body"),o=s.find(":input[id!=importfiles]"),l=s.find(".message"),c=s.find(".progress"),u=function(e){let{row:t,success:n,error:i,count:d}=e,r=()=>{T.addRow(t).then((e=>e.getElement().classList.toggle("text-danger",i))),i&&console.log(sprintf(ew.language.phrase("ImportRowError"),d+" "+JSON.stringify(t),i))};t={_index:d,_success:n,_error:i,...t},T?T.initialized?r():T.on("tableBuilt",r):(T=new Tabulator("#ew-import-dialog .result",a.extend({data:[t],index:"_index",autoColumns:!0,autoColumnsDefinitions:e=>(e.forEach((e=>{e.headerSort=!1,e.resizable=!1,["_index","_error"].includes(e.field)?e.visible=!1:"_success"==e.field&&(e.title="#",e.headerSort=!0,e.headerSortTristate=!0,e.formatter=e=>{e.getElement().style.textOverflow="clip";let t=e.getRow(),a=t.getData();return a._error&&new bootstrap.Tooltip(t.getElement(),{placement:"bottom",title:a._error,container:"#ew-import-dialog .result"}),(a._success?'<i class="fa-solid fa-check text-success"></i>':'<i class="fa-solid fa-xmark text-danger"></i>')+" #"+a._index})})),e)},ew.importTabulatorOptions)),T.on("tableBuilt",(()=>T.element.querySelector(".tabulator-row").classList.toggle("text-danger",i))))},p=e=>i.find(".modal-footer .btn").prop("disabled",!e),g=function(e,t){let n=a("<div>"+e+"</div>");t&&n.addClass(t),l.removeClass("d-none").html(n),"text-danger"==t&&p(!0)},f=()=>l.addClass("d-none").html(""),m=(e,t)=>c.removeClass("d-none").find(".progress-bar").removeClass("text-bg-success text-bg-info").addClass(t||"text-bg-success").attr("aria-valuenow",e).css("width",e+"%").html(e+"%"),h=()=>c.addClass("d-none").find(".progress-bar").attr("aria-valuenow",0).css("width","0%").html("0%"),b=function(e){const t=parseInt(100*e.loaded/e.total,10);m(t,"text-bg-primary"),100===t?g(ew.language.phrase("ImportUploadComplete"),"text-primary"):g(sprintf(ew.language.phrase("ImportUploadProgress"),t),"text-primary")},y=function(t){const e=M(t.data)||{};try{let t=e.totalCount||0,a=e.count||0,n=e.successCount||0,d=e.failCount||0,r=e.file;if(0<t&&i.find(".modal-footer .ew-close-btn").data("import-progress")){e.row&&u(e);let i=parseInt(100*a/t,10);m(i),g(sprintf(ew.language.phrase("ImportResult"),a,t,r,n,d),0<d?"text-danger":"text-primary")}}catch(t){}},_=function(t){var e;let a=[],n=M(t.data)||{},d=n.files;m(100),i.find(".modal-footer .ew-close-btn").data("import-progress",!1),Array.isArray(d)&&d.forEach((e=>{let t=e.totalCount||0,n=e.count||0,i=e.successCount||0,d=e.failCount||0;a.push(sprintf(ew.language.phrase("ImportResult"),n,t,e.file,i,d))})),n.success?(n.rollbacked&&a.push(ew.language.phrase("ImportSave")),g(a.join("<br>"),"text-success"),i.find(".modal-footer .ew-close-btn").data("imported",!0)):(0<ew.IMPORT_MAX_FAILURES&&n.failCount>=ew.IMPORT_MAX_FAILURES&&a.push(sprintf(ew.language.phrase("ImportMaxFailuresExceeded"),ew.IMPORT_MAX_FAILURES)),g(a.join("<br>"),"text-danger")),document.body.style.cursor="default",i.find(".modal-footer .ew-close-btn").prop("disabled",!1);let r=i.find(".modal-footer .ew-import-btn").toggleClass("d-none",!n.rollbacked||!n.success);n.rollbacked&&r.off("click").one("click",A),console.log("Closing EventSource..."),null==(e=x)||e.close()},v=function(t){var e;document.body.style.cursor="default",i.find(".modal-footer .ew-close-btn").data("import-progress",!1);let a=M(t.data)||{};a.error&&g(a.error,"text-danger"),console.log("Closing EventSource..."),null==(e=x)||e.close()},E=function(e){var t;document.body.style.cursor="wait",m(0),null==(t=T)||t.clearData(),d.data(ew.API_FILE_TOKEN_NAME,e),i.find(".modal-footer .ew-close-btn").data("import-progress",!0);let a=new URLSearchParams(o.serialize());a.set(ew.API_ACTION_NAME,ew.API_IMPORT_ACTION),a.set(ew.API_FILE_TOKEN_NAME,e),a.set("rollback","1"),x=new EventSource(He()+"?"+a.toString()),x.addEventListener("message",y),x.addEventListener("error",v),x.addEventListener("complete",_)},A=function(){var e;document.body.style.cursor="wait",m(0),null==(e=T)||e.clearData(),i.find(".modal-footer .ew-close-btn").data("import-progress",!0);let t=new URLSearchParams(o.serialize());t.set(ew.API_ACTION_NAME,ew.API_IMPORT_ACTION),t.set(ew.API_FILE_TOKEN_NAME,d.data(ew.API_FILE_TOKEN_NAME)),t.set("rollback","0"),x=new EventSource(He()+"?"+t.toString()),x.addEventListener("message",y),x.addEventListener("error",v),x.addEventListener("complete",_)},S=ew.importUploadOptions,T,x;return S.acceptFileTypes||(S.acceptFileTypes=new RegExp("\\.("+ew.IMPORT_FILE_ALLOWED_EXTENSIONS.replace(/,/g,"|")+")$","i")),d.data("blueimpFileupload")||d.fileupload(Object.assign({url:w(ew.API_UPLOAD_ACTION),dataType:"json",autoUpload:!0,singleFileUploads:!1,dropZone:r,messages:{acceptFileTypes:ew.language.phrase("UploadErrorAcceptFileTypes"),maxFileSize:ew.language.phrase("UploadErrorMaxFileSize"),maxNumberOfFiles:ew.language.phrase("UploadErrorMaxNumberOfFiles"),minFileSize:ew.language.phrase("UploadErrorMinFileSize")},beforeSend:function(e,t){t.data.set("session",ew.SESSION_ID),t.data.set(ew.TOKEN_NAME_KEY,ew.TOKEN_NAME),t.data.set(ew.ANTIFORGERY_TOKEN_KEY,ew.ANTIFORGERY_TOKEN),ew.API_JWT_TOKEN&&e.setRequestHeader(ew.API_JWT_AUTHORIZATION_HEADER,"Bearer "+ew.API_JWT_TOKEN)},done:function(t,e){var a;if(Array.isArray(null==e||null==(a=e.result)||null==(a=a.files)?void 0:a.importfiles)){let t=[];e.result.files.importfiles.forEach((function(e){e.error&&t.push(sprintf(ew.language.phrase("ImportUploadError"),e.name,e.error))})),t.length?g(t.join("\n"),"text-danger"):(T=null,E(e.result[ew.API_FILE_TOKEN_NAME]))}},change:function(){f()},processfail:function(t,e){e.files.forEach((function(e){e.error&&g(ew.language.phrase("ImportUploadError",e.name,e.error),"text-danger")}))},fail:function(t,e){g(sprintf(ew.language.phrase("ImportServerError"),e.textStatus,e.errorThrown),"text-danger")},progressall:function(t,e){b(e)}},S)),i.modal("hide").find(".modal-title").html(e.hdr),i.find(".modal-footer .ew-close-btn").off("click.ew").on("click.ew",(function(){let e=a(this);e.data("imported")&&(e.data("imported",!1),window.location.reload())})),f(),ew.importDialog=i.on("show.bs.modal",(function(){var e,t,a;h(),null==(e=this.querySelector(".modal-footer .ew-import-btn"))||e.classList.add("d-none"),null==(t=T)||t.element.removeAttribute("style"),null==(a=T)||a.destroy(),T=null})).modal("show"),!1},initExportLinks:C,initForms:B,initIcons:h,initLightboxes:k,initMultiSelectCheckboxes:N,initPage:function(t){var e=null==(d=null==t?void 0:t.target)?document:d,n=a(e),i=n.find("table.ew-table:not(.ew-export-table)"),d;ew.initPanels(e),ew.renderJsTemplates(t),F(t),B(t),D(t),b(t),h(t),We(t),k(t),L(t),i.each(be),n.find(".ew-column-dropdown").each((function(){var e;let t=this.dataset.table;null==(e=localStorage.getItem(ew.PROJECT_NAME+"_"+t+"_invisible_fields"))||e.split(",").forEach((e=>a("#tbl_"+t+"list").find("th[data-name='"+e+"'],td[data-name='"+e+"']").toggleClass("d-none",!0))),a(this).find(".ew-dropdown-checkbox").on("click",(function(n){let e=this.querySelector(".ew-dropdown-check-input[data-field]"),i=null==e?void 0:e.dataset.field;t&&i&&(e.classList.toggle("ew-checked"),a("#tbl_"+t+"list").find("th[data-name='"+i+"'],td[data-name='"+i+"']").toggleClass("d-none",!e.classList.contains("ew-checked"))),localStorage.setItem(ew.PROJECT_NAME+"_"+t+"_invisible_fields",Array.from(n.currentTarget.closest(".dropdown-menu").querySelectorAll(".ew-dropdown-check-input[data-field]:not(.ew-checked)"),(e=>e.dataset.field)))}))})).on("show.bs.dropdown",(function(t){let e=t.currentTarget.dataset.table,n=t.currentTarget.querySelectorAll(".ew-dropdown-check-input[data-field]");for(let i of n){let t=i.dataset.field;i.classList.toggle("ew-checked",!!a("#tbl_"+e+"list").find("th[data-name='"+t+"']:not(.d-none)")[0])}})),C(t),N(t);var r=n.find(".ew-report");r[0]&&(r.find(".card").on("collapsed.lte.widget",(function(){var e=a(this),t=e.closest("[class^='col-']"),n=t.css("min-height");n&&t.data("min-height",n),t.css("min-height",0)})).on("expanded.lte.widget",(function(){var e=a(this),t=e.closest("[class^='col-']"),n=t.css("min-height");n&&t.css("min-height",n)})),r.find(".ew-group-toggle").on("click",(function(){ew.toggleGroup(this)}))),("undefined"!=typeof ew.USE_JAVASCRIPT_MESSAGE&&ew.USE_JAVASCRIPT_MESSAGE||"undefined"!=typeof ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST&&ew.MS_USE_MESSAGE_BOX_INSTEAD_OF_TOAST)&&Xe(t)},initPasswordOptions:b,initPdfObjects:L,initSearchFilters:We,initTooltips:D,inlineAction:async function(e){var t;let n=a(null==(t=e.evt)?void 0:t.currentTarget),i=n.closest(".ew-grid, .ew-multi-column-grid");if(n.tooltip("hide"),!i[0]&&n.is(".dropdown-item")){let e=a("#"+n.closest(".dropdown-menu").attr("aria-labelledby"));e[0]&&(n=e,i=n.closest(".ew-grid, .ew-multi-column-grid"))}if(!n[0])return;let{url:d,ewAction:r,action:s}=e,o=i.find("form"),l=o[0],c=n.closest("tr[data-rowindex], div[data-rowindex]"),u=c.data("key"),p=c.data("rowindex"),g;if("add"!=s&&(!i[0]||!l))return;let f=function(e){let t="";("404"==e.status||"403"==e.status)&&(t=ew.language.phrase("MessageError404Additional")),e.status&&W("Server Error "+e.status+": "+e.statusText+"<br>"+t)},m=function(){document.body.style.cursor="default"},h=async function(e){if(e instanceof Response){let t=e.headers.get("Content-Type");if(null!=t&&t.includes("json")){let t=await e.json();null!=t&&t.success?(c.remove(),W(ew.language.phrase("DeleteSuccess"),"success")):W(P(t)||ew.language.phrase("DeleteFailed"))}else K(await e.text())}},b=()=>a(".ew-list-options, .ew-list-option-body").find("[data-ew-action='inline'][data-action='add'],[data-ew-action='inline'][data-action='copy'],[data-ew-action='inline'][data-action='edit']").addClass("disabled"),w=()=>a(".ew-list-options, .ew-list-option-body").find("[data-ew-action='inline'][data-action='add'],[data-ew-action='inline'][data-action='copy'],[data-ew-action='inline'][data-action='edit']").removeClass("disabled"),_=()=>i.find(".ew-grid-middle-panel .ew-table")[0],v=e=>{let t=0;Array.from(e.rows).forEach((e=>e.dataset.rowindex="0"===e.dataset.rowindex?"0":t+++""))},A=async function(e){if(e instanceof Response){let t=await e.clone().text(),n=a("<div>"+t+"</div>"),d=n.find("tr[data-rowindex=0], div[data-rowindex=0]"+(u?", tr[data-key='"+u+"'], div[data-key='"+u+"']":"")).filter("[data-rowtype=2], [data-rowtype=3]"),r=d.data("inline"),o=d.data("rowtype"),p=r&&2==o?0:r&&3==o?1:d.data("rowindex"),f=d.add(n.find("script[data-rowindex="+p+"]"));if(["add","copy","edit"].includes(s)&&!f[0])return W(t);if(["add","copy"].includes(s)){if(document.querySelector("main.ew-no-record")&&n.find("main:not(.ew-no-record)")[0])await nt(Promise.resolve(e));else{if(d.is("TR")){let e=_();e.matches(".ew-infinite-scroll-table")?a(e.tBodies).last().append(f):a(e.tBodies).last().prepend(f),v(e),be(e,!0)}else i.find(".ew-multi-column-row").append(f);b()}ew.initPage(a.Event({type:"load.ew",target:i[0]})),Pa.get(l.id).tryFocus(),ue(i.find("[data-rowtype=2]")[0])}else"edit"==s&&(g=c.replaceWith(f),i.data("detached",g),d.is("TR")&&be(_(),!0),b(),ew.initPage(a.Event({type:"load.ew",target:i[0]})),Pa.get(l.id).tryFocus(),ue(i.find("[data-rowtype=3]")[0]))}},S=async function(t){if(t instanceof Response){let n=t.headers.get("Content-Type");if(null!=n&&n.includes("json")){let e=await t.json(),a=P(e);if(a)return void W(a)}if(t.headers.get("Infinite-Scroll")){let e=await t.text(),n=a("<div>"+e+"</div>"),d=n.find(".main"),r;if(["insert","update"].includes(s)){if(r=n.find("tr[data-rowindex][data-rowtype="+ew.ROWTYPE_VIEW+"], div[data-rowindex][data-rowtype="+ew.ROWTYPE_VIEW+"]"),!r[0])return;"insert"==s?i.find("tr[data-rowtype="+ew.ROWTYPE_ADD+"], div[data-rowtype="+ew.ROWTYPE_ADD+"]").replaceWith(r[0]):"update"==s&&r.get().forEach((e=>i.find("tr[data-key='"+e.dataset.key+"'], div[data-key='"+e.dataset.key+"']").replaceWith(e)))}else["add","edit","multiedit"].includes(s)&&(r=n.find("tr[data-rowindex][data-rowtype="+ew.ROWTYPE_VIEW+"], div[data-rowindex][data-rowtype="+ew.ROWTYPE_VIEW+"]"),["edit","multiedit"].includes(s)?r.get().forEach((e=>i.find("tr[data-key='"+e.dataset.key+"'], div[data-rowtype='"+e.dataset.key+"']").replaceWith(e))):"add"==s&&i.find(".ew-grid-middle-panel .ew-table > tbody:last").append(r));let o=_();v(o),be(o,!0),Xe({target:n}),ew.initPage(a.Event({type:"load.ew",target:d[0]}))}else await nt(Promise.resolve(t));let d=t.headers.get("Return-Url");d&&["inline","modal"].includes(e.ewAction)&&!Te(y(d).pathname,Na.pathname)&&i.find("[data-ew-action=modal][data-url='"+d+"'], [data-ew-action=inline][data-url='"+d+"']").trigger("click")}};if("inline"==r){if("cancel"==s){if("0"==p)c.remove();else{var x;null==(x=i.data("detached"))||x.replaceAll(c)}w()}else if(l&&["insert","update"].includes(s)){let t=Pa.get(l.id);if(await t.canSubmit(e.evt)){document.body.style.cursor="wait";let e=E(o.serialize(),{action:s}),n=Le(E(d,{rnd:Ze()}),{method:"POST",body:e}).catch(f).finally((()=>{t.enableForm(),m()}));if(t.submitWithFetch){let e={form:l,result:n},i=a.Event("aftersubmit",{originalEvent:e.evt});t.trigger(i,[e])}else n.then(S).finally(w)}}else if("delete"==s){if(!u&&(c=i.find("input[type=checkbox][name='key_m[]']:checked").closest("tr[data-rowindex], div[data-rowindex]"),!c[0]))return K({title:ew.language.phrase("NoRecordSelected"),icon:"warning"}),!1;V({title:ew.language.phrase("DeleteConfirm"),icon:"question"},(e=>{if(e){document.body.style.cursor="wait";let e=u?"GET":"POST",t=T(o.serialize(),"action"),n=Pa.get(l.id),i=Le(E(d,{action:"delete",rnd:Ze()}),{method:e,body:t}).catch(f).finally((()=>{n.enableForm(),m()}));if(n.submitWithFetch){let e={form:l,result:i},t=a.Event("aftersubmit",{originalEvent:e.evt});n.trigger(t,[e])}else i.then(h)}}))}else document.body.style.cursor="wait",Le(E(d,{rnd:Ze()})).then(A).catch(f).finally(m)}else if("grid"==r||"modal"==r){if(("grid"==r&&"edit"==s||"modal"==r&&["multiedit","update"].includes(s))&&!pe(l))return K({title:ew.language.phrase("NoRecordSelected"),icon:"warning"}),!1;ew.modalDialogShow({...e,callback:S})}return!1},isAutoSuggest:ie,isBooleanCheckbox:oe,isFilter:ne,isFunction:j,isHidden:Ae,isHiddenTextArea:te,isMaskedPassword:function(e){var t=a(e).val();return null==t?void 0:t.match(/^\*+$/)},isMediumScreen:at,isMobile:function(){return ew.IS_MOBILE||!at()},isModalLookup:ae,isNativeSelectOne:re,isSelect2:de,isTextbox:se,keySelected:pe,lazyLoad:F,mergeSearchParams:A,modalDialogHide:Ke,modalDialogShow:function(t){var n,i,d,r,s,o;t.lnk||(t.lnk=null==(n=t.evt)?void 0:n.currentTarget),null==(i=bootstrap.Tooltip.getInstance(t.lnk))||i.hide();let{ewAction:l,action:c}=t,u=t.f||(null==(d=t.evt)||null==(d=d.currentTarget)?void 0:d.form);if(("grid"==l&&"edit"==c||"modal"==l&&["multiedit","update"].includes(c))&&!pe(u))return K({title:ew.language.phrase("NoRecordSelected"),icon:"warning"}),!1;let e=t.url||(null==(r=t.evt)||null==(r=r.currentTarget)?void 0:r.dataset.url),p=ew.modalDialog||a("#ew-modal-dialog").on("hidden.bs.modal",Ke);if(p.on("hidden.bs.modal",(()=>p.data("showing",!1))),p.data("showing")&&e&&p.data("url")==e)return!1;p.data({showing:!0,url:e}),t.reload=!1,p.find(".modal-dialog").removeClass("modal-sm modal-md modal-lg modal-xl").addClass(t.size||"modal-xl");let g=function(){let e=p.data("args");return null===e.ask?"":e.ask&&""!=e.ask?e.ask:void 0},f=function(){let e=p.data("args"),t=a(e.lnk);return e.caption||t.data("caption")||t.data("original-title")||""},m=function(){let e=p.data("args");return null===e.btn?"":e.btn&&""!=e.btn?ew.language.phrase(e.btn):f()},h=function(e){p.modal("hide");let t="";("404"==e.status||"403"==e.status)&&(t=ew.language.phrase("MessageError404Additional")),e.status&&K({title:"Server Error "+e.status+": "+e.statusText,html:t,icon:"error"})},b=function(){document.body.style.cursor="default"},w=function(e){let t=document.createElement("a");return t.href=e,window.location.pathname.endsWith(t.pathname)},_=function(){p.data("showing")&&!p.hasClass("show")&&p.data("showing",!1).trigger("hidden.bs.modal")},v=function(e){let n=P(e);if(n)K(n),_();else if(a.isString(e.warningMessage))K(e.warningMessage,"warning"),_();else if(a.isString(e.message))K(e.message,"body"),_();else if(e.success&&!j(null==t?void 0:t.callback)||a.isString(e.successMessage)){var i,d,r;let t=p.data("args");p.modal("hide"),e.successMessage&&W(e.successMessage,"success");let a=null==t?void 0:t.lnk,n=null==a||null==(i=a.closest(".dropdown-menu[aria-labelledby]"))?void 0:i.getAttribute("aria-labelledby"),s=n?document.getElementById(n):null,o=null==(d=null==a?void 0:a.closest(".tab-pane"))?null==s?void 0:s.closest(".tab-pane"):d,l=null==o||null==(r=o.parentNode)||null==(r=r.parentNode)?void 0:r.querySelector("[data-bs-toggle='tab'][data-bs-target='#"+o.id+"']:not([tabindex])");p.trigger("success.ew.modal",[{result:e,tabPane:o,navItem:l}])}else if(e.reload)p.modal("hide"),window.location.reload();else if(a.isBoolean(e.success)&&j(null==t?void 0:t.callback))p.modal("hide"),t.callback(e);else if(e.url){let n=e.url;e.modal?w(n)?!e.error&&(p.modal("hide"),nt(fetch(n))):(t.reload=!0,t.url=n,e.caption&&(t.caption=e.caption),t.btn=e.view?null:"",p.data({args:t,url:n}),n=E(n,{modal:"1",rnd:Ze()}),document.body.style.cursor="wait",a.get(n).done(I).fail(h).always(b)):(p.modal("hide"),window.location=O(n))}},A=function(){let e=p.find(".modal-footer").last().empty(),t=p.find(".card-body button[type=submit]").first().addClass("ew-submit").on("click",x);if(!t[0]){if(p.find(".modal-body .ew-modal-buttons").contents().clone().find("button").each((function(){if("submit"==this.type){this.type="button",this.classList.add("ew-submit"),"btn-cancel"==this.id&&this.classList.add("ew-cancel");let t=a(this);t.on("click",(function(n){"set-action"==this.dataset.ewAction&&(this.form.elements.action.value=this.dataset.value),!1===t.data("ajax")?a(this.form).trigger("submit"):x(n)}))}else"btn-cancel"==this.id&&(this.dataset.href?a(this).on("click",(function(){let e=p.find(".modal-body form")[0],t=Pa.get(e.id);null==t||t.updateTextArea(),null!=t&&t.modified&&ew.hasFormData(this.form)?ew.prompt(ew.language.phrase("ConfirmCancel"),(e=>{e&&(Te(this.dataset.href,Na.pathname)?p.modal("hide"):tt(this.dataset.href))})):Te(this.dataset.href,Na.pathname)?p.modal("hide"):tt(this.dataset.href)})):a(this).on("click",(()=>p.modal("hide"))));e[0].appendChild(this)})),!p.find(".card-body button[type=submit], .modal-footer .btn")[0]){let t=m();t?(a('<button type="button" class="btn btn-primary ew-btn">'+t+"</button>").on("click",x).appendTo(e),e.append('<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CancelBtn")+"</button>")):e.append('<button type="button" class="btn btn-default ew-btn" data-bs-dismiss="modal">'+ew.language.phrase("CloseBtn")+"</button>")}e.find("button").on("mousedown",(t=>t.preventDefault())),e.find(".btn-primary").focus()}},S=e=>{let n=e.headers.get("Return-Url");n&&t.table&&["inline","modal"].includes(t.ewAction)&&!Te(y(n).pathname,Na.pathname)&&a(".ew-grid."+t.table).find("[data-ew-action=modal][data-url='"+n+"'], [data-ew-action=inline][data-url='"+n+"']").trigger("click")},T=async function(e){let t=p.data("args");if(e instanceof Response){let n=e.headers.get("Content-Type");if(null!=n&&n.includes("json")){let a=await e.json();if(j(null==t?void 0:t.callback)){let e=P(a);return e?W(e):p.modal("hide"),void t.callback(a)}v(a)}else{let n=await e.clone().text(),i=je(n).trim();if(i.startsWith("<")&&i.endsWith(">")){if(t.ajax&&"add"==t.action&&document.querySelector("main.ew-no-record")&&a(i).find("main:not(.ew-no-record)")[0])return p.modal("hide"),await nt(Promise.resolve(e)),void S(e);if(p.find(".modal-body").html(i),p.find(".modal-body .ew-infinite-scroll-grid .ew-grid-middle-panel").css("height","auto"),!p.find(".modal-body .ew-modal-buttons").length&&j(null==t?void 0:t.callback))return p.modal("hide"),void t.callback(e);A(),De(n,"modal_dialog",!0),p.trigger("load.ew")}else n&&(p.modal("hide"),K(n))}}},x=async function(n){let e=p.find(".modal-body form")[0],i=a(e),d=Pa.get(e.id),r=null==n?void 0:n.target;if(r.classList.contains("disabled"))return!1;if(r.classList.contains("ew-cancel"))a.post(i.attr("action"),i.serialize(),I).fail(h).always(b);else if(await d.canSubmit(n)){b();let s=p.find(".modal-body"),o=s.find("#confirm");if(("1"==t.ask||"1"==g())&&o&&""!=o.val()||a.isUndefined(o)&&("1"==t.ask||"1"==g())&&("update"==t.action||"insert"==t.action||"edit"==t.action))$(r).prop("disabled",!1).removeClass("disabled"),ew.prompt({title:ew.language.phrase("MessageConfirmSaveMessage"),showCancelButton:!0,icon:"question"},(t=>{if(t)if(i.hasClass("ew-login-form"))d.submit();else{document.body.style.cursor="wait";let t=Le(i.attr("action"),{method:"POST",body:i.serialize()}).catch(h).finally((()=>{d.enableForm(),b()}));d.submitWithFetch?t.then((async t=>{var i;let r=t.clone(),s=null==(i=r.headers.get("Content-Type"))?void 0:i.includes("json"),o=s?await r.json():null,l=(null==o?void 0:o.validation)||P(o);s&&l||p.modal("hide");let c={form:e,result:Promise.resolve(t),context:l?"#ew-modal-dialog.show .modal-body":null},u=a.Event("aftersubmit",{originalEvent:n});d.trigger(u,[c])})):t.then(T)}}));else if(i.hasClass("ew-login-form"))d.submit();else{document.body.style.cursor="wait";let t=Le(i.attr("action"),{method:"POST",body:i.serialize()}).catch(h).finally((()=>{d.enableForm(),b()}));d.submitWithFetch?t.then((async t=>{var i;let r=t.clone(),s=null==(i=r.headers.get("Content-Type"))?void 0:i.includes("json"),o=s?await r.json():null,l=(null==o?void 0:o.validation)||P(o);s&&l||p.modal("hide");let c={form:e,result:Promise.resolve(t),context:l?"#ew-modal-dialog.show .modal-body":null},u=a.Event("aftersubmit",{originalEvent:n});d.trigger(u,[c])})):t.then(T)}}return!1},I=function(t){let n=M(t);if(a.isObject(n))v(n);else{let n=p.data("args"),r=a(n.lnk),s=je(t);p.find(".modal-title").html(f()),p.find(".modal-body").html(s),p.find(".modal-body .ew-infinite-scroll-grid .ew-grid-middle-panel").css("height","auto"),e=e.substring(0,-1==e.indexOf("#")?e.length:e.indexOf("#")),e=e.substring(0,-1==e.indexOf("?")?e.length:e.indexOf("?")),e=e.substring(e.lastIndexOf("/")+1,e.length);var i=e,d="";1==ew.MS_SHOW_HELP_ONLINE&&(d="&nbsp;<a href='javascript:void(0);' id='helponline' onclick='getHelp(\""+i+"\");' title='"+ew.language.phrase("Help")+"'><span class='fa fa-question-circle ew-icon'></span></a>"),p.find(".modal-title").html(f()+d),A(),p.find(".modal-footer").toggle(!1!==n.footer);let o=r.data()||{};o.table&&p.find(".modal-dialog").addClass("table-"+o.table),p.find(".modal-body form").on("keydown",(t=>{if("Enter"==t.key&&"TEXTAREA"!=t.target.nodeName)return p.find(".modal-footer .btn.btn-primary").trigger("click"),!1}));let l=p.find(".modal-body form").find("#"+ew.TOKEN_NAME_KEY),c=p.find(".modal-body form").find("#"+ew.ANTIFORGERY_TOKEN_KEY);l.length&&c.length&&(ew.TOKEN_NAME=l.val(),ew.ANTIFORGERY_TOKEN=c.val()),o.ajax&&o.table&&"view"==o.action&&[".ew-add",".ew-copy",".ew-edit",".ew-delete"].forEach((e=>{let t=p.find(".modal-body "+e+"[data-ew-action=modal]"),n=a("[data-ew-action=modal][data-table='"+o.table+"'][data-url='"+t.data("url")+"']").not(".modal-body *").first();n[0]?t.on("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),n.trigger("click")})):t.addClass("d-none")})),ew.modalDialog=p.modal("show"),De(t,"modal_dialog",!0);let u=bootstrap.Modal.getInstance(p[0]);u._focustrap.__handleFocusin||(u._focustrap.__handleFocusin=u._focustrap._handleFocusin,u._focustrap._handleFocusin=function(t){var e;null!=(e=t.target)&&e.matches("[class^=cke_dialog_]")||this.__handleFocusin(t)}),p.trigger("load.ew")}};if(!0===t.callback&&null!=(s=p.data("args"))&&s.callback&&(t.callback=p.data("args").callback),e&&null!=(o=p.data("args"))&&o.reload&&(t.reload=!0,p.data("args").reload=!1),p.modal("hide"),p.data("args",t),e){document.body.style.cursor="wait";let n=ew.getSearchParams(e);n.set("rnd",Ze()),"delete"!=n.get("action")&&n.set("modal","1"),a.ajax({url:E(e,n),method:u?"POST":"GET",data:u?a(u).serialize():"",headers:t.json?{Accept:"application/json, */*; q=0.01"}:{}}).done(I).fail(h).always(b)}else t.html&&function(e){let t=p.data("args");p.find(".modal-title").html(f()),p.find(".modal-body").html(e),A(),p.find(".modal-footer").toggle(!1!==t.footer),ew.modalDialog=p.modal("show")}(t.html);return!1},newOption:Fe,onError:function(e,t,n,i){if(t.jquery){let e=t.attr("type");t="checkbox"==e||"radio"==e?t.get():t[0]}else t instanceof xt&&(t=t.element);return a(t).closest(ka).find(".invalid-feedback").append("<p>"+n+"</p>"),i&&le(t),null==e||e.makeVisible(t),!1},opt2FA:function(e){return a.get(w([ew.API_2FA_ACTION,e.checked?ew.API_2FA_ENABLE:ew.API_2FA_DISABLE,ew.CURRENT_USER_IDENTIFIER])).then((t=>{var a;null!=t&&null!=(a=t.error)&&a.description?(W(t.error.description),e.indeterminate=!0):null!=t&&t.success&&t.enabled?W(ew.language.phrase("2FAEnabled"),"success"):null!=t&&t.success&&t.disabled?W(ew.language.phrase("2FADisabled"),"success"):!0!==(null==t?void 0:t.success)&&(W(ew.language.phrase("2FAOptFailed")),e.indeterminate=!0)})).fail(((e,t,a)=>W(a)))},parseDate:et,parseDateTime:et,parseJson:M,parseNumber:function(e){let t=ew.getLocaleFromPlatform(ew.LANGUAGE_ID);return"latn"==ew.NUMBERING_SYSTEM&&(t.numeralSystem=void 0),t.delimiters.thousands!==ew.GROUPING_SEPARATOR&&(t.delimiters.thousands=ew.GROUPING_SEPARATOR),t.delimiters.decimal!==ew.DECIMAL_SEPARATOR&&(t.delimiters.decimal=ew.DECIMAL_SEPARATOR),ew.parse(e,{locale:t})},parseTime:et,parseUrl:y,prompt:V,random:Ze,redirect:tt,refresh:nt,removeScript:Be,removeSpaces:function(e){return/^(<(p|br)\/?>(&nbsp;)?(<\/p>)?)?$/i.test(e.replace(/\s/g,""))?"":e},resendOtp:function(e){let t=e.dataset,n="timer."+t.authType,i=e.closest("#verify2fa"),d=a(i);return!d.data(n)&&(e.classList.add("disabled"),ew.sendOtp(t).finally((()=>{var e;i.querySelector("#securitycode").focus();let r=0;null==(e=d.data(n))||e.cancel(),d.removeData(n).data(n,a.later(1e3,null,(()=>{r++;let e=ew.resendOtpInterval-r,a=i.querySelector("#btn-send-otp[data-auth-type="+t.authType+"]");if(0<e)a.innerHTML=ew.language.phrase("SendOtpAgain")+(" ("+e+"s)"),a.classList.add("disabled");else{var s;null==(s=d.data(n))||s.cancel(),d.removeData(n),a.innerHTML=ew.language.phrase("SendOtpAgain"),a.classList.remove("disabled")}}),null,!0))})))},reset2FA:function(){V({html:ew.language.phrase("2FAResetConfirm"),preConfirm:e=>{if(e)return a.get(w([ew.API_2FA_ACTION,ew.API_2FA_RESET,ew.CURRENT_USER_IDENTIFIER])).then((e=>{var t;if(null!=e&&null!=(t=e.error)&&t.description)W(e.error.description);else if(!(null!=e&&e.success))!0!==(null==e?void 0:e.success)&&W(ew.language.phrase("2FAResetFailed"));else if(a.isObject(e.config)){ew.vars.twofa=e.config;for(let t of["config2fa","select2fa","verify2fa"])ew.refreshTemplate(t,e.config)}})).fail(((e,t,a)=>W(a)))}})},samePath:Te,sameString:function(e,t){return e+""==t+""},sameText:Se,sanitizeUrl:O,scrollIntoView:ue,searchOperatorChange:U,selectAll:ge,selectAllKeys:function(e){ge(e);let t=null==e?void 0:e.closest(".ew-table");t&&a(t.tBodies).each((function(){a(this.rows).each((function(){let t=a(this);t.is(":not(.ew-template):not(.ew-table-preview-row)")&&t.toggleClass("table-active ew-table-selected-row",e.checked).triggerHandler("change")}))}))},selectKey:function(t){let e=t.target,n=null==e?void 0:e.closest(".ew-table");if(n){fe(n);let i=a(e).closest(".ew-table > tbody > tr");i.siblings("[data-rowindex='"+i.data("rowindex")+"']").addBack().each((function(){a(this).toggleClass("table-active ew-table-selected-row",e.checked).triggerHandler("change")})),t.stopPropagation()}},selectOption:ke,sendOtp:function(e){const{authType:t,user:a,account:n}=e;return["google","email","sms"].includes(t)?a?n?(document.body.style.cursor="wait",Le(w([ew.API_2FA_ACTION,ew.API_2FA_SEND_OTP,a,t,n])).then((async e=>{var t;document.body.style.cursor="default";let a=await e.json();return null!=a&&null!=(t=a.error)&&t.description?W(a.error.description):null!=a&&a.success?null!=a&&a.success&&W(ew.language.phrase("SendOtpSuccess"),"success"):W(ew.language.phrase("SendOtpFailed")),a})).catch((e=>{document.body.style.cursor="default",W(e)}))):K("Missing verified account"):K("Missing user identifier"):K("Invalid authentication type")},setActiveUser:function(e){let t=e.checked?"1":"0",a=new URL(window.location);return a.searchParams.set("activeuser",t),window.location=O(a.toString()),!1},setFocus:le,setInvalid:function(e){if(!e)return;let t=a(e);if(Ae(t))return;!e.options&&e.length&&(e=t[0]);let n=t.closest(ka),i=()=>n.find(".is-invalid").removeClass("is-invalid");if(ie(e))n.find(".ew-auto-suggest").removeClass("is-valid").addClass("is-invalid").one("click keydown paste",i);else if(te(e))t.removeClass("is-valid").addClass("is-invalid"),t.data("editor").instance.once("change",i);else if(ae(e))t.removeClass("is-valid").addClass("is-invalid").one("select2:open",i);else if(["checkbox","radio"].includes(e.type))t.removeClass("is-valid").addClass("is-invalid").one("click keydown",i);else{let e=ew.BROWSER_NAME.includes("Safari")&&!ew.BROWSER_NAME.includes("Chrome")?"change input":"click input";t.parent().one(e,i),t.add(t.closest(".input-group")).removeClass("is-valid").addClass("is-invalid")}},setLanguage:function(e){let t=e.value||e.dataset.language;if(!t)return!1;let a=new URL(window.location);return a.searchParams.set("language",t),window.location=O(a.toString()),!1},setLayout:I,setSearchParam:S,setSearchParams:E,setSearchType:function(e){var t=e.dataset.searchType,a="Auto";"="==t?a="Exact":"AND"==t?a="All":"OR"==t&&(a="Any"),e.closest(".ew-basic-search").querySelector("input.ew-basic-search-type").value=t||"",e.closest(".dropdown-menu").querySelectorAll(".dropdown-item").forEach((e=>e.classList.remove("active"))),e.closest(".dropdown-item").classList.add("active");var n=e.closest(".input-group").querySelector("#searchtype"),i=ew.language.phrase("QuickSearch"+a+"Short");return n.innerHTML=i,n.classList.toggle("me-2",!!i),!1},setSessionTimer:function(){if(!ew.IS_LOGGED_IN)return;let e=a("div.ew-footer-text"),t=()=>{a.get(w(ew.API_SESSION_ACTION),{rnd:Ze()}).then((e=>{e&&a.isObject(e)&&(ew.TOKEN_NAME=e[ew.TOKEN_NAME_KEY],ew.ANTIFORGERY_TOKEN=e[ew.ANTIFORGERY_TOKEN_KEY],e.JWT&&(ew.API_JWT_TOKEN=e.JWT),o())}))},n=()=>{var e;h=ew.SESSION_TIMEOUT,c=ew.SESSION_TIMEOUT,m=ew.SESSION_TIMEOUT_COUNTDOWN,l=ew.SESSION_TIMEOUT-ew.SESSION_TIMEOUT_COUNTDOWN,0>l&&(l=0,m=0),p&&p.cancel(),null==(e=u)||e.cancel()},i=()=>{n(),window.location=O(ew.TIMEOUT_URL+"?expired=1")},d=function(){g=a.later(1e3,null,(function(){let t='<span class="text-danger">'+ew.language.phrase("SessionCountDown")+"</span>";if(!(0<h))e.find(".msTimer").html(""),a.later(1e3,null,(function(){}));else if(h<=ew.SESSION_TIMEOUT_COUNTDOWN||0>=l)e.find(".msTimer").html(""),h=0;else{let a="",n="",i=Math.floor(h/60),d=h%60;a=1==i.toString().length?"0"+i:i,n=1==d.toString().length?"0"+d:d,t.includes("%m")&&t.includes("%s")?(t=t.replace("%m",'<span class="ew-session-counter-minute">'+a+"</span>"),t=t.replace("%s",'<span class="ew-session-counter-second">'+n+"</span>")):t.includes("%s")&&(t=t.replace("%s",'<span class="ew-session-counter-second">'+n+"</span>")),e.find(".msTimer").html(t)}h--}),null,!0)},r=function(){0>c&&(c=0,h=0,g.cancel()),p&&p.cancel()},s=()=>{var e;if(null==(e=f)||e.cancel(),0<m){let e='<span class="text-danger">'+ew.language.phrase("SessionWillExpire")+"</span>",a="",n="",d=Math.floor(h/60),r=h%60,s;a=1==d.toString().length?"0"+d:d,n=1==r.toString().length?"0"+r:r,e.includes("%m")&&e.includes("%s")?(e=e.replace("%m",'<span class="ew-session-counter-minute">'+a+"</span>"),e=e.replace("%s",'<span class="ew-session-counter-second">'+n+"</span>")):e.includes("%s")&&(e=e.replace("%s",'<span class="ew-session-counter-second">'+n+"</span>")),Swal.fire({...ew.sweetAlertSettings,html:e,icon:"warning",showConfirmButton:!0,confirmButtonText:ew.language.phrase("OKBtn"),timer:1e3*m,timerProgressBar:!0,allowOutsideClick:!1,allowEscapeKey:!1,willOpen:()=>{s=setInterval((()=>{let t,a,n,i;const d=Swal.getHtmlContainer(),r=d.querySelector.bind(d);let s=Math.round(Swal.getTimerLeft()/1e3),o=d.querySelector(".ew-session-counter-minute"),l=d.querySelector(".ew-session-counter-second");o&&l?(t=Math.floor(s/60),a=s%60):l&&(t=1,a=s),n=1==t.toString().length?"0"+t.toString():t.toString(),i=1==a.toString().length?"0"+a.toString():a.toString(),o&&l?(o.textContent=n,l.textContent=i):l&&(l.textContent=i),e='<span class="text-danger">'+ew.language.phrase("SessionCountDown")+"</span>",e.includes("%m")&&e.includes("%s")?(e=e.replace("%m",'<span class="ew-session-counter-minute">'+n+"</span>"),e=e.replace("%s",'<span class="ew-session-counter-second">'+i+"</span>")):e.includes("%s")&&(e=e.replace("%s",'<span class="ew-session-counter-second">'+i+"</span>")),document.title=e.replace(/<[^>]*>?/gm,"")}),1e3)},willClose:()=>{clearInterval(s)}}).then((e=>{e.value?(t(),document.title=document_title,alertify.success(ew.language.phrase("MessageSessionExtended")).dismissOthers()):e.dismiss===Swal.DismissReason.timer&&(i(),p.cancel(),g.cancel(),window.location=O(ew.TIMEOUT_URL+"?expired=1"))}))}else i(),p.cancel(),g.cancel(),window.location=O(ew.TIMEOUT_URL+"?expired=1")},o=()=>{var e;0<ew.SESSION_TIMEOUT&&window.location.pathname!=(null==(e=ew.vars.login)||null==(e=e.login)?void 0:e.url)&&(n(),u=a.later(1e3*l,null,s))},l,c,u,p,g,f,m,h;if(0<ew.SESSION_KEEP_ALIVE_INTERVAL||ew.IS_LOGGED_IN&&ew.IS_REMEMBER_ME){let e=Math.max(ew.SESSION_KEEP_ALIVE_INTERVAL||ew.SESSION_TIMEOUT-ew.SESSION_TIMEOUT_COUNTDOWN,ew.MIN_SESSION_KEEP_ALIVE_INTERVAL);f=a.later(1e3*e,null,t,null,!0)}else o(),function(){r(),p=a.later(1e3,null,d)}()},setValid:ce,setupGrid:we,setupTable:be,showBackupCodes:function(){let e="<p>"+ew.language.phrase("BackupCodesMsg")+"</p>";return K({title:ew.language.phrase("BackupCodes"),html:e,showDenyButton:!0,showLoaderOnDeny:!0,showCancelButton:!0,confirmButtonText:ew.language.phrase("CopyToClipboard"),denyButtonText:ew.language.phrase("GetNewCodes"),customClass:{denyButton:"btn btn-primary ew-swal2-deny-button"},willOpen:()=>{Swal.showLoading(),Swal.disableButtons(),a.get(w([ew.API_2FA_ACTION,ew.API_2FA_BACKUP_CODES,ew.CURRENT_USER_IDENTIFIER])).then((t=>{t.success&&Array.isArray(t.codes)&&(Swal.update({html:e+'<textarea class="form-control ew-backup-codes" readonly>'+t.codes.join("\n")+"</textarea>"}),Swal.enableButtons(),Swal.getConfirmButton().focus())})).fail(((e,t,a)=>W(a))).always((()=>Swal.hideLoading()))},preConfirm:()=>{let e=Ye(Swal.getHtmlContainer().querySelector("textarea"));return e&&W(ew.language.phrase("CopiedToClipboard"),"success"),!1},preDeny:async()=>(Swal.showLoading(Swal.getDenyButton()),await a.get(w([ew.API_2FA_ACTION,ew.API_2FA_NEW_BACKUP_CODES,ew.CURRENT_USER_IDENTIFIER])).then((t=>{t.success&&Array.isArray(t.codes)&&(Swal.update({html:e+'<textarea class="form-control ew-backup-codes" readonly>'+t.codes.join("\n")+"</textarea>"}),Swal.getConfirmButton().focus(),a.isObject(t.config)&&ew.renderJsTemplates({target:a(".ew-2fa-form")[0]}))})).fail(((e,t,a)=>W(a))).always((()=>Swal.hideLoading())),!1)})},showDrillDown:function(t,e,n,i,d){if(null!=t&&t.ctrlKey){let e=E(n,{d:"2"});return tt(e)}let r=a(e),s=r.data("config")||{},o={obj:r[0],config:{title:d,placement:"bottom",...s},id:i,url:n};Ra.trigger("drilldown",[o]);let l=o.url.split("?");o.file=l[0]||"",o.data=l[1]||"",s=o.config,bootstrap.Popover.getInstance(e)||r.popover({...ew.popoverOptions,...s,trigger:"manual",template:'<div class="popover" role="tooltip"><h3 class="popover-header d-none" style="cursor: move;"></h3><div class="popover-body"></div></div>',content:ew.spinnerTemplate(),container:a("#ew-drilldown-panel").draggable(ew.draggableOptions),boundary:"viewport"}).on("show.bs.popover",(function(){r.attr("data-bs-original-title","")})).on("shown.bs.popover",(function(){if(r.data("args")){let t=r.data("args").data;a.ajax({cache:!1,dataType:"html",type:"POST",data:t,url:r.data("args").file,success:function(t){let n=a(bootstrap.Popover.getInstance(e)._getTipElement());s.title&&n.find(".popover-header").empty().removeClass("d-none").append('<button type="button" class="btn-close" aria-label="'+ew.language.phrase("CloseBtn")+'"></button>'+s.title).find(".btn-close").on("click",(function(){r.popover("hide")}));let d=t.match(/<body[^>]*>([\s\S]*?)<\/body\s*>/i);t=d?d[0]:t;let o=ew.stripScript(t);n.find(".popover-body").html(a("<div></div>").html(o).find("#ew-report")).find(".ew-table").each(ew.setupTable),ew.executeScript(t,i,!0),r.popover("update")},error:function(t){if(t.responseText){let d=bootstrap.Popover.getInstance(e);if(a.isString(t.responseText)&&t.responseText.startsWith("{")&&t.responseText.endsWith("}")){var n,i;let e=M(t.responseText);if(null!=e&&null!=(n=e.error)&&n.type&&null!=e&&null!=(i=e.error)&&i.description)return null==d||d.hide(),K({title:e.error.type,html:e.error.description,customClass:{title:"ew-swal2-title text-danger",htmlContainer:"ew-swal2-html-container text-danger"}})}null==d||d.setContent({".popover-body":'<p class="text-danger">'+t.responseText+"</p>"})}}})}})).on("hidden.bs.popover",(function(){ew.removeScript(i)})),r.data("args",o).popover("show")},showMessage:Xe,showToast:W,sort:function(t,e){let{sortUrl:a,sortType:n,context:i,ajax:d}=e;return t.shiftKey&&!t.ctrlKey?a=E(a,{cmd:"resetsort"}):2==n&&t.ctrlKey&&(a=E(a,{ctrl:"1"})),Z(d)?nt(fetch(I(a,!1)),i):window.location=O(a),!1},stripScript:Me,submitAction:function(t,e){var n;let i=t.currentTarget,d=e.f||i.form||i.closest("form"),r=a(d),s=e.key,o=e.action,l=e.url||He(),c=e.msg,u=e.data,p=e.success,g=Array.isArray(e.method)&&e.method.length?e.method[0]:e.method||"",f=Se(g[0],"A")||Se(g[0],"a"),m=Se(g[0],"R")||Se(g[0],"r"),h=!e.method||Se(g[0],"P")||Se(g[0],"p"),b=!e.select&&!e.key||e.select&&Se(e.select[0],"M");if((b||h)&&!d)return K({title:ew.language.phrase("NoHtmlForm"),icon:"error"}),!1;if(b&&!pe(d))return K({title:ew.language.phrase("NoRecordSelected"),icon:"error"}),!1;let w=function(e){if(a.isString(e))Xe(e);else if(a.isObject(e)){let t=P(e);t?K(t):a.isString(e.successMessage)&&K(e.successMessage,"success"),e.disabled&&(i.disabled=!0)}},_=function(e,t){let n=r.find("input[type=hidden][name='"+e+"']");n[0]?n.val(t):a("<input>").attr({type:"hidden",name:e,value:t}).appendTo(r)},v=function(e){if(h&&d){if(o&&_("action",o),a.isUndefined(e)||_("actionvalue",e),a.isObject(u))for(const[e,t]of Object.entries(u))_(e,t);if(!b&&a.isObject(s))for(const[e,t]of Object.entries(s))_(e,t);y(l).pathname!=Na.pathname&&r.off("submit.ew"),r.prop({action:l,method:"post"}).trigger("submit")}else if(f||m)if(u=new URLSearchParams(u),o&&(u.set("action",o),r.find("#action").remove()),f&&u.set("ajax",o),a.isUndefined(e)||u.set("actionvalue",e),f&&(u=A(u,r.serialize())),!b&&a.isObject(s)&&(u=A(u,s)),f){p&&a.isString(p)&&(p=window[p]);let e=a.isObject(p)?p:{};e.data=u.toString(),e.method||(e.method="POST"),e.success||(e.success=j(p)?p:w),a.ajax(l,e)}else m&&tt(l,null,"GET",u)};return c=a.isString(c)?null==(n=window[c])?c:n:c,c?V(c).then((e=>e.isDismissed||v(e.value))):v(),!1},toast:q,toggleChat:function(e){document.body.style.cursor="wait",a.get(w([ew.API_CHAT_ACTION,e]),(t=>{var n;null!=t&&null!=(n=t.error)&&n.description?K(t.error.description):null!=t&&t.success&&(a("#disable-chat").toggleClass("d-none",!e),a("#enable-chat").toggleClass("d-none",!!e),a(".chat-wrapper")[e?"fadeIn":"fadeOut"]())})).fail(((e,t,a)=>K(a))).always((()=>document.body.style.cursor="default"))},toggleGroup:X,toggleLayout:function(e){var t;null==(t=bootstrap.Tooltip.getInstance(e))||t.hide(),document.body.style.cursor="wait",fetch(O(I(e.dataset.url,e.dataset.layout))).then((e=>e.text())).then((e=>{let t=a(".ew-multi-column-grid").html(a("<div>"+e+"</div>").find(".ew-multi-column-grid").html());ew.initPage({target:t[0]}),t.trigger("load.ew")})).catch((e=>K({title:e,icon:"error"}))).finally((()=>document.body.style.cursor="default"))},togglePassword:function(t){let e=a(t.currentTarget),n=e.closest(".input-group").find("input"),i=e.find("i");"text"==n.attr("type")?(n.attr("type","password"),i.toggleClass("fa-eye-slash fa-eye")):"password"==n.attr("type")&&(n.attr("type","text"),i.toggleClass("fa-eye-slash fa-eye"))},toggleSearchOperator:function(t,e,a){var n=t.currentTarget.form.elements[e];n&&(n.value=n.value==a?"=":a)},tooltip:qe,updateChart:function(e){let t=new URL(e.form.action),n=a(e).closest(".ew-chart-top, .ew-chart-bottom"),i=a(ew.overlayTemplate());t.search=a(e.form).serialize(),n.addClass("ew-loading").append(i),fetch(t.toString()).then((async e=>{let t=a("<div>"+await e.text()+"</div>"),i=t.find(".ew-chart-top, .ew-chart-bottom").filter("[data-chart='"+n.data("chart")+"']"),d=t.find(".ew-debug");i[0]&&n.replaceWith(i),d[0]&&i.next(".ew-debug").replaceWith(d)})).finally((()=>n.removeClass("ew-loading").find(i).remove()))},updateDropdownPosition:function(){var e=a(".select2-container--open").prev(".ew-select").data("select2");e&&(e.dropdown._positionDropdown(),e.dropdown._resizeDropdown())},updateOptions:H,updateSelected:function(e){return!!(null!=e&&e.querySelector("input[type=checkbox][name^=u_]:checked,input[type=hidden][name^=u_][value='1']"))},upload:function(e){let t=a(e);if(t.data("blueimpFileupload"))return;let n=t.attr("name"),i=n.replace(/\$/g,"\\$"),d=t.data("table"),r=t.is("[multiple]"),s=t.closest(".ew-file-drop-zone"),o=t.closest(ka),c=o.find("#ft_"+i),u=o.find("#fn_"+i),p=o.find("#fa_"+i),g=o.find(".ew-file-label"),f=g.html(),m=function(t){r||!u.val()||confirm(ew.language.phrase("UploadOverwrite"))||(t.preventDefault(),t.stopPropagation())},h=w(ew.API_JQUERY_UPLOAD_ACTION),b=a.templates("#template-download"),y=a.templates("#template-upload"),_=G(e),E=a(_),A="confirm"==E.find("#confirm").val()||t.attr("readonly")||t.prop("disabled");A&&!t.prop("disabled")&&t.prop("disabled",!0);const{acceptFileTypes:S,maxFileSize:T,maxNumberOfFiles:x}=t.data(),I={id:n,table:d,session:ew.SESSION_ID,replace:r?"0":"1",acceptFileTypes:S,maxFileSize:T,maxNumberOfFiles:x};t.fileupload(ew.deepAssign({url:h,type:"POST",multipart:!0,autoUpload:!0,loadImageFileTypes:/^image\/(gif|jpe?g|png)$/i,loadVideoFileTypes:/^video\/mp4$/i,loadAudioFileTypes:/^audio\/(mpeg|mp3)$/i,filesContainer:c,uploadTemplateId:null,downloadTemplateId:null,uploadTemplate:y.render.bind(y),downloadTemplate:b.render.bind(b),previewMaxWidth:ew.UPLOAD_THUMBNAIL_WIDTH,previewMaxHeight:ew.UPLOAD_THUMBNAIL_HEIGHT,dropZone:s,messages:{acceptFileTypes:ew.language.phrase("UploadErrorAcceptFileTypes"),maxNumberOfFiles:ew.language.phrase("UploadErrorMaxNumberOfFiles"),maxFileSize:ew.language.phrase("UploadErrorMaxFileSize"),minFileSize:ew.language.phrase("UploadErrorMinFileSize")},formData:I,readonly:A},ew.uploadOptions)).on("fileuploaddone",(function(t,e){if(!e.result.files[0].error){let t=e.result.files[0].name,a=r?u.val()?u.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[]:[];a.push(t),u.val(a.join(ew.MULTIPLE_UPLOAD_SEPARATOR)),p.val("0"),r||c.find("tbody > tr:not(:last-child)").remove()}})).on("fileuploaddestroy",(function(t){let e=t.originalEvent.target.dataset.url,a=v(e),n=a.get("id"),i=a.get(n);if(i){let e=u.val()?u.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[],t=e.indexOf(i);-1<t&&e.splice(t,1),u.val(e.join(ew.MULTIPLE_UPLOAD_SEPARATOR)),p.val("0")}})).on("fileuploadchange",(function(n,e){var i;c.toggleClass("ew-has-rows",0<(null==(i=e.files)?void 0:i.length));let d=u.val()?u.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[];e.files.forEach((e=>d.push(e.name)));let r=t.data("maxNumberOfFiles");if(a.isNumber(r)&&0<r&&d.length>r)return K({title:ew.language.phrase("UploadErrorMaxNumberOfFiles"),icon:"error"}),!1;let s=t.data("size");if(a.isNumber(s)&&0<s&&d.join(ew.MULTIPLE_UPLOAD_SEPARATOR).length>s)return K({title:ew.language.phrase("UploadErrorMaxFileLength"),icon:"error"}),!1})).on("fileuploadadded fileuploadfinished fileuploaddestroyed",(function(t,e){var a,n;c.toggleClass("ew-has-rows",0<(null==(a=e.files)?void 0:a.length)||0<(null==(n=e.result)||null==(n=n.files)?void 0:n.length));let i=u.val()?u.val().split(ew.MULTIPLE_UPLOAD_SEPARATOR):[];g.html(i.join(", ")||f)})).on("fileuploadadded",(function(t,e){var a;c.toggleClass("ew-has-rows",0<(null==(a=e.files)?void 0:a.length)),e.context.find(".start").click(m)})).on("fileuploadcompleted",(function(t,e){let a={target:e.context};k(a),L(a),ew.updateDropdownPosition(),e.context.find("img").on("load",ew.updateDropdownPosition)})),u.val()&&a.ajax({url:h,data:{id:n,table:d,session:ew.SESSION_ID},dataType:"json",context:this,success:function(i){if(null!=i&&i[n]){let d=t.fileupload("option","done");d&&d.call(e,a.Event(),{result:{files:i[n]}})}A&&c.find("td.delete").hide()}})},valueChanged:function(e,t,a,n){let i=ve("x"+t+"_"+a,e),d=ve("o"+t+"_"+a,e),r=ve("fn_x"+t+"_"+a,e);if("hidden"==(null==i?void 0:i.type)&&!d)return!1;if(!d&&(!i||Array.isArray(i)&&0==i.length))return!1;if(d&&i)if(!n){let e=Ie(d),t=r?Ie(r):Ie(i);if(e==t)return!1}else if(Z(Ie(d))===Z(Ie(i)))return!1;return!0},valueSeparator:Pe},{__proto__:null,checkSubscription:pt,isPushNotificationSupported:dt,pushNotificationDialogShow:async function(e){let n=t.pushDialog||a("#ew-push-notification-dialog").on("shown.bs.modal",(t=>setTimeout((()=>{var e;return null==(e=t.target.querySelector(".modal-body .form-control"))?void 0:e.focus()}),200))).on("click",".modal-footer .btn-primary",(function(t){var e;t.preventDefault(),null!=(e=a(this).closest(".modal").find(".modal-body form").data("form"))&&e.submit()&&n.modal("hide")}));if(!n[0])return console.log("DIV #ew-push-notificatoin-dialog not found"),!1;if(!e.url)return console.log("Missing URL of Web Push API"),!1;let i=e.evt.currentTarget,d=a(i.form),r=n.find(".modal-body form"),s=r.data("form");if(r.data("all",!1),!d.find("input[name='key_m[]']:checked")[0]){let e=await t.prompt(t.language.phrase("SendPushNotificationsToAll"),(e=>e));if(r.data("all",e),!e)return}return s||(s=(new t.FormBuilder).setId(r.attr("id")).addFields([["title",t.Validators.required(t.language.phrase("PushNotificationFormTitle"))],["body",t.Validators.required(t.language.phrase("PushNotificationFormBody"))]]).setValidate((function(){return this.validateFields()})).setSubmit((function(){if(!this.validate())return!1;let n=[r.serialize(),r.data("all")?"":d.find("input[name='key_m[]']:checked").serialize()].join("&");return a.post(e.url,n,(e=>{var a;if(Array.isArray(e)){let a=e.reduce(((e,t)=>e+(t.success?1:0)),0),n=e.length-a;0<a&&0==n?t.alert(sprintf(t.language.phrase("PushNotificationSuccess"),a),"success"):0==a&&0<n?t.alert(sprintf(t.language.phrase("PushNotificationFailure"),n)):0==a&&0==n?t.alert(t.language.phrase("NoSubscriptions"),"primary"):t.alert(sprintf(t.language.phrase("PushNotificationSent"),a,n),"primary")}else null!=e&&null!=(a=e.error)&&a.description&&t.alert(e.error.description)})),!0})).build(),r.data("form",s)),t.pushDialog=n.modal("hide").find(".modal-title").html(e.hdr||i.dataset.caption).end().modal("show"),!1},subscribeNotification:ut,unsubscribeNotification:gt},{__proto__:null,fullCalendar:function(e,t,n){let{ajax:i,updateTable:d,eventFields:r,addUrl:s,viewUrl:o,editUrl:l,deleteUrl:c,copyUrl:u,fullCalendarOptions:p,eventPopoverOptions:g}=t,f;delete t.addUrl;let m=e=>{let t=(e,t)=>{let n;return"string"==typeof t&&(n=t.match(/^(\d{4}-\d{2}-\d{2}) (\d{2}:\d{2}:\d{2})/))?n[1]+"T"+n[2]:"allDay"==e?ew.convertToBool(t):"url"!=e||t?"display"!=e||t?"classNames"==e&&t&&a.isString(t)?t.replace(/\s+/g," ").split(" "):"classNames"!=e||t?"groupId"!=e||t?"description"!=e||t?t:"":"":[""]:"auto":""};if(e.success){let a=e.action,i=e[d];Array.isArray(i)||(i=[i]);for(let e of i){for(let[t,a]of Object.entries(r))t!=a&&null!==a&&a in e&&(e[t]=e[a],delete e[a]);if(a==ew.API_DELETE_ACTION){var n;null==(n=f.getEventById(e.id))||n.remove()}else if(a==ew.API_ADD_ACTION){for(let a in e){let n=Object.keys(r).find((e=>e===a)),i=e[a];n&&void 0!==i&&(e[n]=t(n,i))}f.addEvent(e)}else{let a=f.getEventById(e.id),n=e.groupId;for(let i in e){let d=Object.keys(r).find((e=>e===i)),s=t(d,e[i]);d&&void 0!==s?(s=t(d,s),"start"==d?a.setStart(s):"end"==d?a.setEnd(s):"allDay"==d?a.setAllDay(s):"description"==d?a.setExtendedProp(d,s):"id"!=d&&!n&&a.setProp(d,s)):s&&a.setExtendedProp(i,s)}}}ew.alert({title:ew.language.phrase("MessageUpdated"),icon:"success"})}},h=e=>{let t=e.event,a=[t,...e.relatedEvents],n=t.id?ew.API_EDIT_ACTION:ew.API_ADD_ACTION;a.forEach((t=>b(t,n).then((t=>{t.success?m(t):(t.failureMessage&&ew.alert(t.failureMessage),e.revert())})).catch((t=>{console.log(t),e.revert()}))))},b=(e,t)=>new Promise(((n,i)=>{let s=e.toPlainObject({collapseExtendedProps:!0}),o={};for(let[e,t]of Object.entries(r))if(e in s){let a=s[e];t||(t=e),a instanceof Date?a=a.toISOString().slice(0,-5).replace(/T/," "):"string"==typeof a&&a.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)?a=a.substring(0,19).replace(/T/," "):"boolean"==typeof a?a=a?"1":"0":"classNames"==e&&(a=Array.isArray(a)?a.join(" "):a),o[t]=a,delete s[e]}o={...o,...s};let l=t==ew.API_ADD_ACTION?ew.getApiUrl([t,d]):ew.getApiUrl([t,d,e.id]);a.post(l,o,(e=>n(e))).fail((e=>i(e)))})),w=e=>Object.keys(currentTable.fields).find((t=>currentTable.fields[t].name==e)),y=(e,t)=>{let a=e.split("?");return a[0]+=t?(a[0].endsWith("/")?"":"/")+t:"",a.join("?")},_=e=>{var t;let n=s,d=new URLSearchParams,o=null==(t=e.view)?void 0:t.type;if(a.isObject(e)&&(e.startStr||e.endStr)){let t=w(r.start),a=w(r.end),n=w(r.allDay);t&&e.startStr&&d.set(t,e.startStr),a&&e.endStr&&d.set(a,e.endStr),n&&["timeGridWeek","timeGridDay"].includes(o)&&d.set(n,e.allDay?"1":"0")}a.isString(e)&&e.match(/^\d+$/)&&(n=y(n,e));let l=d.toString();n+=l?"?"+l:"",ew.modalDialogShow({url:n,ask:"1",callback:i?m:null,json:i,btn:ew.language.phrase("AddBtn"),caption:ew.language.phrase("AddLink")})},v=e=>ew.modalDialogShow({url:y(o,e),callback:i?m:null,json:i,btn:null,caption:ew.language.phrase("ViewLink")}),E=e=>ew.modalDialogShow({url:y(l,e),ask:"1",callback:i?m:null,json:i,btn:null,caption:ew.language.phrase("EditLink")}),A=e=>ew.prompt({title:ew.language.phrase("DeleteEventConfirm"),icon:"question"},(t=>{t&&ew.modalDialogShow({url:ew.setSearchParams(y(c,e),{action:"delete"}),callback:i?m:null,json:i})}));s&&(p.customButtons=Object.assign(p.customButtons||{},{add:{text:ew.language.phrase("AddEvent"),click:_}}),p.headerToolbar.start+=" add");let S=e=>{let t={...bootstrap.Popover.Default,...g,trigger:"manual"},n=bootstrap.Popover.getOrCreateInstance(e.el,t),i=Array.from(document.querySelectorAll("script[data-name='event-popover']")).sort(((e,t)=>(e=parseInt(e.dataset.seq,10)||0,t=parseInt(t.dataset.seq,10)||0,e-t))).shift(),d=a.templates(i.text);e.event.setExtendedProp("timeSpan",ew.formatTimeSpan(e.event.start,e.event.end,e.event.allDay));let r=d.render(e.event).trim();if(r){var s,o;let t=null==(s=null==(o=Array.from(e.el.classList.values()).find((e=>e.match(/^event-([\w+]+)\b/))))?void 0:o.replace(/^event-/,"popover-"))?"popover-default":s;return n._templateFactory=null,n._config.title=e.event.title,n._config.content=r,n._config.customClass+=(n._config.customClass?" ":"")+"ew-event-popover "+t,n}return null},T=e=>{let t=0,a=0;if(e){let n=e.el.getBoundingClientRect(),i=e.jsEvent;t=n.left+i.offsetX,a=n.top+i.offsetY}return()=>({width:0,height:0,top:a,right:t,bottom:a,left:t})},x={getBoundingClientRect:T()},I;n&&t.useContextMenu&&(o||l||s&&u||c)&&(n.dataset.bsToggle="dropdown",document.addEventListener("keydown",(e=>!e.button||"Escape"!==e.key||bootstrap.Dropdown.clearMenus())),I=bootstrap.Dropdown.getOrCreateInstance(n,{reference:x}),I._menu.querySelectorAll(".dropdown-item").forEach((e=>e.addEventListener("click",(t=>{let e=t.currentTarget.dataset,a=e.action,n=e.eventId;a&&n&&("view"==a&&o?v(n):"edit"==a&&l?E(n):"copy"==a&&s&&u?_(n):"delete"==a&&c&&A(n))})))));let O=ew.deepAssign(p,{drop:function(e){let t=document.getElementById("remove-event");t.checked&&e.draggedEl.parentNode.removeChild(e.draggedEl)},select:e=>{Cookies.set("calendarDefaultDate",ew.formatDateTime(e.start,"yyyy-MM-dd"),{expires:365,path:"/"}),Cookies.set("calendarDefaultView",e.view.type,{expires:365,path:"/"}),s&&_(e)},eventReceive:h,eventDragStart:e=>{var t;return null==(t=bootstrap.Popover.getInstance(e.el))?void 0:t.hide()},eventDrop:h,eventResize:h,eventClick:e=>{if(e.jsEvent.preventDefault(),2==e.jsEvent.button){let n=e.event.extendedProps._view||e.event.extendedProps._edit||e.event.extendedProps._copy||e.event.extendedProps._delete;if(I&&n){var a;null==(a=bootstrap.Popover.getInstance(e.el))||a.hide(),I.hide(),I._menu.querySelectorAll(".dropdown-item").forEach((a=>{a.dataset.eventId=e.event.id,a.classList.toggle("d-none",!t[a.dataset.action+"Url"]||!e.event.extendedProps["_"+a.dataset.action])})),I._menu.querySelectorAll(".dropdown-item:not(.d-done)").length&&(x.getBoundingClientRect=T(e),I.show())}}else if(e.event.url)window.open(e.event.url);else if(t.usePopover&&g.trigger.match(/\bclick\b/)){var n;null==(n=S(e))||n.toggle()}else t.showViewPageOnEventClick&&v(e.event.id)},eventMouseEnter:e=>{var a,n;null!=(a=I)&&a._isShown(I._menu)||t.popoverViews.includes(e.view.type)&&t.usePopover&&g.trigger.match(/\bhover\b/)&&(null==(n=S(e))||n.show())},eventMouseLeave:e=>{var a,n;null!=(a=I)&&a._isShown(I._menu)||t.popoverViews.includes(e.view.type)&&t.usePopover&&g.trigger.match(/\bhover\b/)&&(null==(n=bootstrap.Popover.getInstance(e.el))||n.hide())}}),C={element:e,options:O};return a(document).trigger("calendar",[C]),f=new window.FullCalendar.Calendar(e,C.options),f}});var ja=a(document);loadjs.ready("load",(function(){var e;a.views.settings.debugMode(ew.DEBUG),ew.setSessionTimer(),ew.initPage(),a("#ew-modal-dialog").on("load.ew",ew.initPage),a("#ew-add-opt-dialog").on("load.ew",ew.initPage);let t=ew.currentUrl.searchParams.get("hash"),n=null==(e=a("#"+t).offset())?void 0:e.top;n&&a("html, body").animate({scrollTop:n},800),ja.trigger("load.ew")})),ja.on("addoption",(function(t,e){let n=e.data,d=e.parents;for(let r=0,i=d.length,s;r<i;r++){if(s=d[r],!s.length)return e.valid=!1;let t=n["ff"+(0<r?r+1:"")];if(!a.isUndefined(t)&&!s.includes(t+""))return e.valid=!1}})),ja.on("click","[data-ew-action]:not([data-ew-action=''])",(function(t){let e=Object.assign({},a(this).data()),n=e.ewAction;if(!n)return!0;if("none"==n)return!1;if("redirect"==n)return ew.redirect(e.url);if("reload"==n)return location.reload(),!1;if("submit"==n)return delete e.ewAction,ew.submitAction(t,e);if("modal"==n)return t.preventDefault(),e.ajax?ew.inlineAction({evt:t,...e}):ew.modalDialogShow({evt:t,...e});if("inline"==n||"grid"==n)return t.preventDefault(),ew.inlineAction({evt:t,...e});if("export"==n)return ew.export({evt:t,...e});if("layout"==n)return ew.toggleLayout(this);if("language"==n)return ew.setLanguage(this);if("active-user"==n)return ew.setActiveUser(this);if("filter"==n)return ew.filter(t);if("sort"==n)return ew.sort(t,this.dataset);if("refresh"==n){let e=ew.setLayout(this.dataset.url,!1);return e&&"#"!=e&&ew.refresh(fetch(e),this.dataset.context),!1}if("email"==n)return delete e.ewAction,ew.emailDialogShow({evt:t,...e});if("set-action"==n)this.form.elements.action.value=e.value;else{if("drilldown"==n)return ew.showDrillDown(t,this,e.url,e.id,e.hdr);if("add-option"==n)return delete e.ewAction,ew.addOptionDialogShow({evt:t,...e});if("search-type"==n)return ew.setSearchType(this);if("search-operator"==n)ew.toggleSearchOperator(t,e.target,e.value);else if("search-toggle"==n){let e=document.getElementById(this.dataset.form+"_search_panel");e&&(bootstrap.Collapse.getOrCreateInstance(e).toggle(),this.classList.toggle("active"))}else if("highlight"==n)a("mark."+this.dataset.name).toggleClass("mark"),this.classList.toggle("active");else{if("inline-delete"==n)return ew.confirmDelete(this);if("add-grid-row"==n)return ew.addGridRow(this);if("delete-grid-row"==n)return ew.deleteGridRow(this,this.dataset.rowindex);if("select-all"==n)ew.selectAll(this);else if("select-key"==n)ew.selectKey(t);else if("select-all-keys"==n)ew.selectAllKeys(this);else{if("import"==n)return ew.importDialogShow({evt:t,hdr:e.hdr});if("password"==n)return ew.togglePassword(t);if("push"==n)return ew.pushNotificationDialogShow({evt:t,url:e.apiUrl});if("opt-2fa"==n)return ew.opt2FA(this);if("config-2fa"==n)return ew.enable2FA(e.type);if("disable-2fa"==n)return t.stopPropagation(),ew.disable2FA(e.type);if("reset-2fa"==n)return ew.reset2FA();if("2fa-next"==n){var i;return null==(i=window.$loginWizard)||i.smartWizard("next"),!1}if("2fa-prev"==n)return window.$loginWizard.smartWizard("prev"),!1;if("toggle-chat"==n)return ew.toggleChat(e.value);if("send-otp"==n)return ew.resendOtp(this);if("backup-codes"==n)return ew.showBackupCodes();if("scroll-top"==n)return a(document).scrollTop(a("#top").offset().top),!1}}}})).on("change","[data-ew-action]:not([data-ew-action=''])",(function(){let e=Object.assign({},a(this).data());if(!e.ewAction)return!0;let t=e.ewAction.split(" ").filter((e=>!!e));for(let a of t)if("submit-form"==a){var n;null==(n=this.form)||n.submit()}else{if("change-page-size"==a){let t=ew.sameText(this.value,"ALL")?"ALL":ew.parseNumber(this.value);if(ew.convertToBool(e.ajax)){let e=ew.setLayout(this.dataset.url,!1)+"&"+this.name+"="+t;ew.refresh(fetch(e),this.dataset.context)}else{let e=ew.setSearchParam(this.dataset.url,this.name,t);ew.redirect(e)}return!1}if("update-options"==a)ew.updateOptions.call(this);else if("autofill"==a)ew.autoFill(this);else{if("search-operator"==a)return ew.searchOperatorChange(this);"language"==a?ew.setLanguage(this):"chart-order"==a&&ew.updateChart(this)}}})).on("keydown","[data-ew-action]:not([data-ew-action=''])",(function(t){let e=Object.assign({},a(this).data()),n=e.ewAction;if("change-page"==n&&"Enter"==t.key){if(ew.convertToBool(e.ajax)){let e=ew.setLayout(this.dataset.url,!1)+"&"+this.name+"="+ew.parseNumber(this.value);ew.refresh(fetch(e),this.dataset.context)}else ew.currentUrl.searchParams.set(this.name,ew.parseNumber(this.value)),window.location=ew.sanitizeUrl(ew.currentUrl.toString());return!1}})),ja.on("click",".ew-row-link",(t=>t.stopPropagation())),ja.on("show.bs.modal",".modal",(function(){var e=1050+a(".modal:visible").length;a(this).css("z-index",e),setTimeout((function(){a(".modal-backdrop").not(".modal-stack").css("z-index",e-1).addClass("modal-stack")}),0)})),ja.on("hidden.bs.modal",".modal",(function(){a(".modal:visible").length&&a("body").addClass("modal-open")})),a.blueimp.fileupload.prototype.options.processQueue.unshift({action:"cropImage",fileTypes:"@loadImageFileTypes",maxFileSize:"@loadImageMaxFileSize",cropperOptions:"@",cropperCanvasOptions:"@",disabled:"@disableImageCrop"}),a.widget("blueimp.fileupload",a.blueimp.fileupload,{processActions:{cropImage:function(e,t){let n=e.files[e.index];if(t.disabled||a.isNumber(t.maxFileSize)&&n.size>t.maxFileSize||t.fileTypes&&!t.fileTypes.test(n.type))return e;let i=URL.createObjectURL(n),d=a.Deferred(),r=this,s=ew.cropperDialog||a("#ew-cropper-dialog").on("shown.bs.modal",(function(){s.data("cropper",new Cropper(this.querySelector("#ew-crop-image"),t.cropperOptions))})).on("hidden.bs.modal",(function(){var e;null==(e=s.data("cropper"))||e.destroy(),s.removeData("cropper"),s.find("#ew-crop-image").attr("src","data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")}));return ew.cropperDialog=s,s.find("#ew-crop-image").attr("src",i),s.find(".ew-crop-btn").off("click").on("click",(function(){if(s.data("cropper"))try{let a=s.data("cropper").getCroppedCanvas(t.cropperCanvasOptions);a.toBlob((t=>{e.files[e.index]=new File([t],n.name,{type:n.type}),d.resolveWith(r,[e])}),n.type)}catch(t){ew.alert(t),d.rejectWith(r,[e])}finally{s.modal("hide")}})),s.find(".ew-skip-btn").off("click").on("click",(function(){d.resolveWith(r,[e]),s.modal("hide")})),s.modal("show"),d.promise()}}}),a.extend({isBoolean:function(e){return"boolean"==typeof e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isObject:function(e){return e&&("object"==typeof e||this.isFunction(e))||!1},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isValue:function(e){return this.isObject(e)||this.isString(e)||this.isNumber(e)||this.isBoolean(e)},isDate:function(e){return"date"===this.type(e)&&"Invalid Date"!==e.toString()&&!isNaN(e)},later:function(e,t,a,n,i){e=e||0,t=t||{};var s=a,l=n,c,u;if(this.isString(a)&&(s=t[a]),!!s)return this.isUndefined(n)||this.isArray(l)||(l=[n]),c=function(){s.apply(t,l||[])},u=i?setInterval(c,e):setTimeout(c,e),{interval:i,cancel:function(){this.interval?clearInterval(u):clearTimeout(u)}}}}),a.fn.fields=function(e){let t={},n=this.attr("id"),i=this[0],d=n.match(/^[xy](\d*)_/),r,s,o;d?(r=ew.getForm(i),s=this.data("table"),o=d[1]):null!=i&&i.htmlForm&&(r=i.$element,s=i.id.replace(new RegExp("^f|"+i.pageId+"$","g"),""),o=i.htmlForm.dataset.rowindex);let l="[data-table"+(s?"="+s:"")+"][data-field"+(e?"=x_"+e:"")+"]"+(a.isValue(o)?"[name^=x"+o+"]":"")+":not(.ew-custom-option)";return r&&l&&a(r).find(l).each((function(){var e,n;let i=this.dataset.field.substring(2),d=this.getAttribute("name");i=/^y_/.test(d)?"y_"+i:i,t[i]=null==(e=null==(n=t[i])?void 0:n.add(this))?a(this):e})),e?t[e]:t},a.fn.extend({row:function(){var e,t,a;let n=null==(e=null==(t=this.data("field"))?void 0:t.substring(2))?"":e,i=null==(a=this.data("table"))?"":a,d=this.closest("#r_"+n+", #xs_"+n+", .row."+i+"_"+n);return d[0]||(d=this.closest(".ew-table > tbody > tr")),d},visible:function(e){var t,a,n;let i=null==(t=null==(a=this.data("field"))?void 0:a.substring(2))?"":t,d=null==(n=this.data("table"))?"":n,r=this.closest("#r_"+i+", #xs_"+i+", .row."+d+"_"+i);return r[0]||(r=this.closest("[id^=el]")),"undefined"==typeof e?$el.is(":visible"):(r.toggleClass("d-none d-sm-none",!e),this)},readonly:function(e){return"undefined"==typeof e?this.prop("readOnly"):(this.prop("readOnly",e),this)},disabled:function(e){return"undefined"==typeof e?this.prop("disabled"):(this.prop("disabled",e),this)},value:function(e){return"undefined"==typeof e?ew.getValue(this[0]):(ew.selectOption(this[0],e),this)},toNumber:function(){return ew.parseNumber(this.value())},toDate:function(){var e;let t=this.data(),a=t.table,n=t.field.replace(/^[xy]_/,""),i=null==(e=ew.vars.tables)||null==(e=e[a])||null==(e=e.fields)||null==(e=e[n])?void 0:e.clientFormatPattern;return ew.parseDateTime(this.value(),i)},toJsDate:function(){return this.toDate().toJSDate()}}),bootstrap.Dropdown.prototype.toggle=function(){if(!this._element.classList.contains("ew-dropdown-toggle")){if(this._element.closest("[data-widget]")&&a(this._element).on("click.ew.dropdown",(t=>{bootstrap.Dropdown.clearMenus(t.originalEvent),t.stopPropagation()})),this._menu.closest(".table-responsive")){let e=this._menu.closest(".popover-body, .modal-body, .offcanvas-body, body");e.appendChild(this._menu);let t=this._menu;this._element.id||(this._element.id="dropdownbtn"+ew.random()),t.setAttribute("aria-labelledby",this._element.id);let a=new MutationObserver((function(e){e.forEach((e=>{switch(e.type){case"attributes":e.target.classList.contains("show")?t.classList.add("d-block"):t.classList.remove("d-block")}}))}));a.observe(this._parent,{attributeFilter:["class"],attributeOldValue:!1,subtree:!1})}this._element.classList.add("ew-dropdown-toggle")}return this._isShown()?this.hide():this.show()},loadjs.ready(["wrapper","head"],(function(){let e=a(".chat-wrapper"),t=e.find("#chat-check"),n=e.find(".chat-btn").addClass("show"),i=n.find(".close"),d=n.find(".comment"),r=e.find(".direct-chat"),s=r.find(".card-header"),o=s.find(".card-collapse"),l=r.find(".card-body"),c=l.find("iframe");t.on("click",(()=>{var e;if(!(null!=(e=Pace)&&e.running)){const e=t.prop("checked");i.toggle(e),d.toggle(!e),r.toggle(e);let a=c[0];e&&!a.src&&(a.src=a.dataset.src)}})),r.on("removed.lte.cardwidget",(()=>t.prop("checked",!1).triggerHandler("click"))),r.on("maximized.lte.cardwidget",(()=>{e.after(r),o.hide(),r.delay(150).queue((function(){let e=r.height()-s.outerHeight();l.height(e),c.addClass("w-100").height(e-parseInt(r.css("border-radius"),10)),r.dequeue()})),c[0].contentDocument.location.reload(!0)})).on("minimized.lte.cardwidget",(()=>{e.append(r),o.show(),r.toggle(t.prop("checked")),r.queue((function(){l.height("auto"),c.removeClass("w-100").height("auto"),r.dequeue()})),c[0].contentDocument.location.reload(!0)}))}));var $a=e=>null===e||void 0===e,Ka=e=>"function"==typeof e,Va=e=>"number"==typeof e&&isNaN(e),qa=e=>"number"==typeof e&&isFinite(e);var Wa=(e,t)=>{if(!qa(e))return NaN;const a=""+e,n=a.indexOf("e");return-1===n?+(a+"e"+t):+(a.slice(0,n)+"e"+(+a.slice(n+1)+t))};var Ga=e=>Math.round(Math.log(e)*Math.LOG10E);const Ha=(e,t)=>{const a={};for(let n=0;n<e.length;++n)if(n in e){const[i,d]=t(e[n],n);a[i]=d}return a};var Ya=Ha;var za=e=>e.replace(/[.*+?^${}()|[\]\\]/g,(e=>`\\${e}`));var Ja=e=>{const t={};return function(...a){const n=1<a.length?a.join("-(:-:)-"):a[0];if(n in t)return t[n];const i=e.apply(this,a);return t[n]=i,i}};const Xa=(()=>{const e={};let t="",a;for(;a!==1/0;)a=+("1"+t),e[a]=!0,t+="0";for(t="",a=void 0;0!==a;)a=+("0."+t+"1"),e[a]=!0,t+="0";return e})();var Za=e=>!!Xa[e];const Qa=(e,t,a)=>{if(!qa(e)||t===a.base)return e;if(!(t in a.scale))return NaN;const n=a.scale[t]||1;return Za(n)?Wa(e,Ga(n)):e*n},en=(e,t,a,n)=>{if(!qa(e)||t===a)return e;const i=Qa(e,t,n),d=Object.assign(Object.assign({},n.scale),{[n.base]:1});if(isNaN(i)||!(t in d)||!(a in d))return NaN;const r=n.scale[a]||1;return Za(r)?Wa(i,-Ga(r)):i/r},tn=(e,t,a,n)=>{const i=Object.assign({exclude:[],cutOffNumber:1},n);let d=null;const r=a.scale;return Object.keys(r).sort(((e,t)=>r[e]-r[t])).forEach((n=>{const r=-1===i.exclude.indexOf(n);if(!r)return;const s=en(e,t,n,a),o=Math.abs(s);(!d||o>=i.cutOffNumber&&o<Math.abs(d[0]))&&(d=[s,n])})),d||[e,t]},an=e=>({toBase:(t,a)=>Qa(t,a,e),convert:(t,a,n)=>en(t,a,n,e),toBest:(t,a,n)=>tn(t,a,e,n),scaleDefinition:e});var nn=(e,t)=>{if(1>t)return"";let a="",n=e;for(;1<t;)1&t&&(a+=n),t>>>=1,n+=n;return a+n};const dn=Ja((e=>{if(!e)return an({base:"",scale:{}});const t=e.split("|"),a={"":1};return t.forEach(((e,t)=>{e&&(a[e]=+(1+nn("0",t)))})),an({base:"",scale:a})}));var rn=dn;const sn=(e,t)=>{if(!t||10!==t.length)return e;const a=e.length,n=Ya(t,((e,t)=>[e.replace(/\u200e/g,""),""+t]));let i="";for(let d=0;d<a;d++){const t=e[d];i+=n[t]||t}return i},on=(e,t)=>{var a;const n=rn(null===(a=t.locale)||void 0===a?void 0:a.abbreviations),i=Object.keys(n.scaleDefinition.scale).sort(((e,t)=>t.length-e.length));let d=1;for(const a of i){const t=za(a),i=new RegExp("[^a-zA-Z]"+`(${t})|(${t.replace(/\u200e/g,"")})`+"(?:\\)(?:\\))?)?$");if(e.match(i)){d=n.toBase(d,a);break}}return d};var ln=(e,t)=>{var a;const n=t.locale;let i;const d=sn(e,null===(a=t.locale)||void 0===a?void 0:a.numeralSystem);if(t.zeroFormat&&d===t.zeroFormat)i=0;else if(t.nullFormat&&d===t.nullFormat||!d.replace(/[^0-9]+/g,"").length)i=null;else{const a=n.delimiters.decimal,r="."===a?d:d.replace(/\./g,"").replace(a,"."),s=on(e,t),o=(r.split("-").length+Math.min(r.split("(").length-1,r.split(")").length-1))%2?1:-1,l=r.replace(/[^0-9.]+/g,"");i=o*Wa(+l,Ga(s))}return i};var cn={code:"en",delimiters:{thousands:",",decimal:"."},abbreviations:"|||K|||M|||B|||T",ordinal:e=>{const t=e%10;return 1===Math.floor(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"}},un=e=>"object"==typeof e&&null!==e,pn=e=>"string"==typeof e;var gn=e=>0>e?Math.ceil(e):Math.floor(e);const fn=e=>{let t=!1,a="";const n=[];for(let d=0;d<e.length;d++){const i=e.charAt(d);"'"!==i||t?"'"===i&&t&&"\\"!==e.charAt(d-1)?(t=!1,n.push({escaped:!0,value:a})):t?a+=i:n.length&&!n[n.length-1].escaped?n[n.length-1].value+=i:n.push({escaped:!1,value:i}):(t=!0,a="")}return n},mn=(e,t)=>-1!==bn(e).indexOf(t),hn=(e,t,a)=>fn(e).map((n=>n.escaped?`'${n.value}'`:n.value.replace(t,(()=>a)))).join(""),bn=e=>fn(e).filter((t=>!t.escaped)).map((t=>t.value)).join(""),wn=e=>fn(e).map((t=>t.escaped?t.value.replace(/\\'/g,"'"):t.value)).join("");var yn=(e,t)=>-1!==e.indexOf(t);var _n=e=>{const t=bn(e),a=yn(t,"(")&&yn(t,")"),n=!a&&yn(t,"+");let i=e;return i=hn(i,"(",`'ɵnps'`),i=hn(i,")",`'ɵnpe'`),i=hn(i,/(-|\+)/,`'ɵs'`),[i,{negativeParentheses:a,forceSign:n}]};var vn=e=>{let t=null,a=!1;if(mn(e,"a")){a=!0;const n=bn(e),i=n.match(/a(k|m|b|t)?/);t=i?i[1]:null}let n=e;return n=hn(n,/a(k|m|b|t)?/,`'ɵa'`),[n,{compact:a,compactUnit:t,compactAuto:a&&!t}]};var En=(e,t)=>{if(!e)return["",""];const a=e.indexOf(t);return-1===a?[e,""]:[e.slice(0,a),e.slice(a+1)]};const An=(e,t)=>e?e.split("").filter((e=>e===t)).length:0;var Sn=e=>{const t=bn(e),a=En(t,".")[1];let n=0,i=0;if(!!a){const e=a.trim();if(yn(e,"[")){const t=e.replace("]",""),a=En(t,"[");n=An(a[0],"0"),i=n+An(a[1],"0")}else if(yn(e,"#"))n=An(e.split("#")[0],"0"),i=e.length;else if(yn(e,"X"))n=An(e.split("X")[0],"0"),i=500;else{const t=An(e.split(" ")[0],"0");n=t,i=t}}return{minimumFractionDigits:n,maximumFractionDigits:i}};var Tn=e=>{let t=!1,a=e;return mn(e,"[.]")&&(t=!0,a=hn(a,"[.]",".")),[a,{optionalFractionDigits:t}]};const xn=e=>hn(e,/((((0|#)+,)?(0|#)+(\.([0#X]|\[0+\])+)?){1})/,`'ɵn'`),In=e=>{const t=bn(e),a=t.split(".")[0].split(",")[0];return/#/g.test(a)?0:(a.match(/0/g)||[]).length},On=e=>yn(e,`'ɵs'`)||yn(e,`'ɵnps'`)?e:e.replace(`'ɵn'`,(()=>`'ɵs''ɵn'`)),Cn=Ja((e=>{const t=pn(e)&&e||"0,0.##########",[a,n]=_n(t),[i,d]=vn(a),[r,s]=Tn(i),o=r,l=bn(o),c=Sn(o),u=In(o),p=-1<l.indexOf(","),g=xn(o),f=On(g);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n),d),s),c),{grouping:p,minimumIntegerDigits:u,patternMask:f})}));var Nn=e=>"-"===e[0]?e.slice(1):e;var Pn=(e,t,a,n)=>{const{compact:i,compactAuto:d}=a,{abbreviations:r}=n.locale;if(!i||!d)return[e,t];const s=rn(r),[o,l]=s.toBest(e,t||"");return[o,l]};const Rn=(e,t,a)=>{const n={k:3,m:6,b:9,t:12}[e],i=(null===t||void 0===t?void 0:t.split("|"))||[];let d=null;for(let r=0;r<i.length;r++)if(i[n-r]){d=n-r;break}return null===d?[a,null]:[Wa(a,-d),i[d]]};var Fn=(e,t,a)=>{const{compact:n,compactUnit:i}=t,{abbreviations:d}=a.locale;if(!n)return[e,null];if(!!i)return Rn(i,d,e);const r=rn(d),[s,o]=r.toBest(e,"");return[s,o||null]};var kn=(e,t,a)=>{const n=t||0,i=a||Math.round,d=Wa(e,n),r=i(d),s=Wa(r,-n);return s};const Ln=e=>{const[t,a]=En(e,"e"),n=+a;if(0>n)return e;const[i,d]=En(t,"."),r=n-d.length;return`${i}${d}${nn("0",r)}`},Dn=(e,t,a)=>{const n=Math.abs(t),[i,d]=En(a,"."),r="-"===i[0]?i.slice(1):i;let s=r,o=d;for(let d=0;d<n;d+=1){const e=s[0]||"";s=s.slice(0,s.length-1),o=(e||"0")+o}return`${0>e?"-":""}${s||0}.${o}`};var Mn=e=>{const t=(e||0).toString(),a=0<=t.indexOf("e");if(!a)return t;const[n,i]=En(t,"e"),d=+i;return 0<=d?Ln(t):Dn(e,d,n)};const Un=(e,t)=>{const[a,n]=En(e,".");return`${a}.${n+nn("0",t-n.length)}`};var Bn=(e,t,a,n)=>{const i=Mn(e),d=t-(n||0),r=En(i,".")[1],s=r?Math.min(Math.max(r.length,d),t):d,o=kn(e,s,a);let l=Mn(o);return!d||(l=Un(l,d)),l};var jn=(e,t,a)=>{const{rounding:n}=a,{minimumFractionDigits:i,maximumFractionDigits:d}=t,r=n||Math.round;if(0<i||0<d){return Bn(e,d,r,d-i)}return Bn(e,0,r)};var $n=(e,t)=>{if(!t||10!==t.length)return e;const a=e.length;let n="";for(let i=0;i<a;i++){const a=e[i];n+=t[a]||a}return n};var Kn=(e,t)=>{const{minimumIntegerDigits:a}=t;return 0===a&&1>+e&&-1<+e?"":e.length>=a?e:`${nn("0",a-e.length)}${e}`};var Vn=(e,t,a,n)=>{const{negativeParentheses:i,forceSign:d}=n;let r=e;return i&&t?r=r.replace(/'ɵ(nps|npe)'/g,(e=>`'ɵnps'`===e?"(":")")):d?r=r.replace(`'ɵs'`,t?"-":a?"":"+"):t&&(r=r.replace(`'ɵs'`,"-")),r};var qn=(e,t)=>{const{optionalFractionDigits:a}=t,[n,i]=En(e,".");return a&&0===+i?[n,""]:[n,i]};var Wn=(e,t,a)=>{const{delimiters:n,digitGroupingStyle:i}=a.locale,{grouping:d}=t;if(!d||!n.thousands)return e;const r=e,s=n.thousands,o=!(null!==i&&void 0!==i)||!i.length?[3]:i,l=[...o];let c="",u=1;for(let n=r.length-1;0<=n;n--)u===l[0]&&0!==n?(c=s+r[n]+c,1<l.length&&l.shift(),u=1):(c=r[n]+c,u+=1);return c};var Gn=(e,t,a)=>a?t?e.replace(`'ɵa'`,(()=>`'${t.replace(/'/g,(()=>"\\'"))}'`)):e.match(/'ɵn'\s*'ɵa'/)?e.replace(/\s*'ɵa'/,""):e.replace(/'ɵa'\s*/,""):e;const Hn=(e,t,a)=>{if(!t.compact){const n=jn(e,t,a);return[n,null]}const[n,i]=Fn(e,t,a),d=+jn(n,t,a),[r,s]=Pn(+d,i,t,a),o=jn(r,t,a);return[o,s]};var Yn=(e,t,a)=>{var n;const i=Cn(t),d=qa(e)?e:0,[r,s]=Hn(d,i,a);if("NaN"===r)return"";const o=a.signedZero?0>e:0>+r,l=a.signedZero?0===e:0==+r,c=Nn(r),[u,p]=qn(c,i),g=Kn(u,i),f=Wn(g,i,a),m=a.locale.numeralSystem,h=$n(f,m),b=$n(p,m),w=h+(!b?"":((null===(n=a.locale.delimiters)||void 0===n?void 0:n.decimal)||".")+b),y=Gn(i.patternMask,s,i.compact),_=y.replace(`'ɵn'`,(()=>`'${w.replace(/'/g,"\\'")}'`)),v=Vn(_,o,l,i),E=v.replace(/'ɵ(nps|npe|s|a|n)'/g,""),A=wn(E);return A};const zn=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],Jn=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],Xn=zn.concat(Jn.slice(1)),Zn=`(${Xn.join("|").replace(/B/g,"B(?!PS)")})`,Qn=an({base:"B",scale:Ya(zn,((e,t)=>[e,Math.pow(1e3,t)]))}),ei=an({base:"B",scale:Ya(Jn,((e,t)=>[e,Math.pow(1024,t)]))});const ti={EUR:"€",USD:"$",XCD:"EC$",AUD:"A$",INR:"₹",BRL:"R$",CAD:"CA$",XAF:"FCFA",CNY:"CN¥",NZD:"NZ$",XPF:"CFPF",GBP:"£",HKD:"HK$",ILS:"₪",JPY:"¥",KRW:"₩",XOF:"CFA",MXN:"MX$",TWD:"NT$",VND:"₫"};var ai=[{name:"percentage",regexps:{format:/%!?/,unformat:/%/},format:(e,t,a)=>{const n=mn(t,"%!"),i=a.scalePercentage&&!n?Wa(e,2):e,d=hn(t,/%!?/,`'ɵ%ɵ'`),r=Yn(i,d,a);return r.replace("ɵ%ɵ","%")},unformat:(e,t)=>{const a=ln(e.replace(/\s?%/,""),t);return a&&t.scalePercentage?Wa(a,-2):a}},{name:"currency",regexps:{format:/(\$)/},format:(e,t,a)=>{var n;const i=null===(n=a.currency)||void 0===n?void 0:n.toUpperCase(),d=ti[i]||i||"",r=hn(t,/\$/,`'ɵcurrencyɵ'`),s=Yn(e,r,a);return s.replace("ɵcurrencyɵ",(()=>d))}},{name:"ordinal",regexps:{format:/o/},format:(e,t,a)=>{var n,i;const d=(null===(i=(n=a.locale).ordinal)||void 0===i?void 0:i.call(n,e))||"",r=hn(t,/o/,`'ɵordɵ'`),s=Yn(e,r,a);return s.replace("ɵordɵ",(()=>d))}},{name:"time",regexps:{format:/([0-9]{1,2}:[0-9]{2}) *$/,unformat:/([0-9]{1,2}:[0-9]{2}) *$/},format:e=>{const t=Math.abs(e),a=0>e?"-":"",n=gn(t/3600),i=gn((t-3600*n)/60),d=gn(t-3600*n-60*i);return`${a}${n}:${(10>i?"0":"")+i}:${(10>d?"0":"")+d}`},unformat:e=>{const t=/^ *-/.test(e),a=e.replace(/^ *-/,""),n=a.split(":").reverse();let i=0;return i+=+n[0],i+=60*+n[1],i+=3600*(+n[2]||0),t&&0!==i?-i:i}},{name:"bytes",regexps:{format:/([0\s]b[bd])|(b[bd][0\s])/,unformat:(e,t)=>!("bytes"!==t.type)&&new RegExp(Zn).test(e)},format:(e,t,a)=>{const n=mn(t,"bb")?ei:Qn,[i,d]=n.toBest(e,"B"),r=hn(t,/b[bd]/,`'ɵbytesɵ'`),s=Yn(i,r,a);return s.replace("ɵbytesɵ",d||"")},unformat:(e,t)=>{var a;const n=ln(e.replace(new RegExp(Zn),""),t),i=(null===(a=e.match(Zn))||void 0===a?void 0:a[0])||"",d=!ei.scaleDefinition.scale[i]?Qn:ei;return n?d.toBase(n,i):n}},{name:"exponential",regexps:{format:/[eE][+-][0-9]+/,unformat:/[eE][+-][0-9]+/},format:(e,t,a)=>{const n="number"!=typeof e||Va(e)?"0e+0":e.toExponential(),i=En(n,"e"),d=hn(t,/e[+|-]{1}0/i,""),r=Yn(+i[0],d,a);return r+"e"+i[1]},unformat:(e,t)=>{var a;const n=ln(e.replace(/e[+-]{1}[0-9]{1,3}/i,""),t),i=+((null===(a=e.match(/e([+-]{1}[0-9]{1,3})/i))||void 0===a?void 0:a[1])||"0");return qa(n)?Wa(n,i):n}},{name:"bps",regexps:{format:/BPS/,unformat:/BPS/},format:(e,t,a)=>{const n=Wa(e,4),i=hn(t,/BPS/,`'ɵBPSɵ'`),d=Yn(n,i,a);return d.replace("ɵBPSɵ","BPS")},unformat:(e,t)=>{const a=ln(e.replace(/\s?BPS/,""),t);return qa(a)?Wa(a,-4):a}}];var ni=e=>0<=e?Math.round(e):0==e%.5?Math.floor(e):Math.round(e);const ii=e=>null!==e&&void 0!==e&&e.decimal&&pn(null===e||void 0===e?void 0:e.thousands)&&e.decimal!==e.thousands,di=e=>{const t=cn;return un(e)?bt(e,{delimiters:ii(e.delimiters)?e.delimiters:t.delimiters,abbreviations:e.abbreviations||t.abbreviations,ordinal:e.ordinal||t.ordinal}):t},ri=e=>"ceil"===e?Math.ceil:"floor"===e?Math.floor:"truncate"===e?gn:"half-up"===e?Math.round:"half-away-from-zero"===e?ni:Ka(e)?e:ni,si=e=>e?Ka(e)?e(ai):[...e,...ai]:ai;var oi=e=>{var t,a,n;const i=e||{},d=ri(i.rounding),r=di(i.locale),s=si(i.formatters);return{defaultPattern:i.defaultPattern||"0,0.##########",nullFormat:i.nullFormat||"",nanFormat:i.nanFormat,zeroFormat:i.zeroFormat,locale:r,rounding:d,type:i.type,scalePercentage:null===(t=i.scalePercentage)||void 0===t||t,trim:null===(a=i.trim)||void 0===a||a,formatters:s,currency:i.currency,signedZero:!!i.signedZero,nonBreakingSpace:!(null===(n=i.nonBreakingSpace)||void 0===n)&&n}};const li=(e,t)=>{for(const a of t.formatters){const n=a.regexps.unformat;if(!n)continue;const i=Ka(n)?n(e,t):!!e.match(n);if(i)return a.unformat}};var ci=(e,t)=>{const a=oi(t);let n;if($a(e)||Va(e))n=null;else if("number"==typeof e)n=0===e?0:e;else if(!("string"==typeof e)){const t=+e;n=0==t?t:t||null}else if(a.zeroFormat&&e===a.zeroFormat)n=0;else if(a.nullFormat&&e===a.nullFormat)n=null;else{const t=e.replace(/\u00A0/," "),i=li(t,a);n=(i||ln)(t,a)}return n};const ui=(e,t)=>{const a=bn(e);for(const n of t.formatters){const i=n.regexps.format;if(!i)continue;const d=Ka(i)?i(e,t):!!a.match(i);if(d)return n.format}};var pi=(e,t,a)=>{var n;try{const n=pn(e)?parseFloat(e):e,i=oi(a),d=t||i.defaultPattern;let r;if(n===1/0||n===-Infinity)r=0<n?"∞":"-∞";else{if(Va(n))return pn(i.nanFormat)?i.nanFormat:pn(i.nullFormat)?i.nullFormat:"";if($a(n))r=pn(i.nullFormat)?i.nullFormat:"";else if(0===n&&pn(i.zeroFormat))r=i.zeroFormat;else{const e=ui(d,i);r=(e||Yn)(n||0,d,i)}}return r=pn(r)?r:"",r=i.nonBreakingSpace?r.replace(/ /g,(()=>" ")):r,r=i.trim?r.trim():r,r}catch(e){return(null===(n=a)||void 0===n?void 0:n._errorFormat)||""}};wt.withOptions=e=>{const t=bt(e,{locale:Ka(e.locale)?e.locale():e.locale});return(e,a,n)=>{const i=pn(a)?a:null,d=un(a)?a:un(n)?n:{};return pi(e,i,bt(t,d))}};var gi=e=>e?e.filter(((e,t,a)=>a.indexOf(e)===t)):[];const fi="֑-߿‏‫‮יִ-﷽ﹰ-ﻼ",mi=new RegExp("^[^"+fi+"]*?["+fi+"]"),hi=e=>mi.test(e),bi=e=>hi(e)?e+"‎":e,wi=["yue","ko","ja"],yi=()=>"object"==typeof Intl&&!!Intl&&"function"==typeof Intl.NumberFormat,_i=e=>{try{const t=1234567890..toLocaleString(e,{useGrouping:!1}),a={},n=t.split("").find((e=>!!a[e]||void(a[e]=!0))),i=n?t.replace(new RegExp(za(n||""),"g"),""):t,d=i.split(""),r=[d[d.length-1],...d.slice(0,-1)];return r.join("")}catch(e){return null}},vi=(e,t)=>{try{const a=12345678.123.toLocaleString(e),n=a.replace(new RegExp(`[${za(t)}]`,"g"),""),[i=",",d="."]=gi(n.split(""));return[i,d]}catch(e){return null}},Ei=(e,t)=>{if(wi.some((t=>0===e.indexOf(t))))return[4];try{const a=[];let n=0;1e11.toLocaleString(e).split("").reverse().forEach((e=>{e===t?(a.push(n),n=0):n+=1}));for(let e=a.length;e--&&a[e]===a[e-1];)a.pop();return a}catch(e){return null}},Ai=(e,t,a)=>{try{if(!yi())return null;const n={notation:"compact",useGrouping:!1,compactDisplay:a},[d,r,s]=t.split("");let o="";for(let t=1;50>t;t++){const i=(+(1+nn("0",t))).toLocaleString(e,n);if(!new RegExp(`^${r}[^${d}]+$`).test(i))o+="|";else if("long"===a){const a=(+(2+nn("0",t))).toLocaleString(e,n),d=i.replace(new RegExp(`${r}`,"g"),"").trim(),l=a.replace(new RegExp(`${s}`,"g"),"").trim();o+="|"+bi(d)+":::"+bi(l)}else{const e=i.replace(new RegExp(`${r}`,"g"),"").trim();o+="|"+bi(e)}}let l=o,c=l.length;for(;c--&&"|"===l[c];)l=l.slice(0,-1);return l}catch(e){return null}},Si=Ja((e=>{const t=e||"en",a=_i(t),n=a||"0123456789",i=vi(t,n),[d,r]=!!i&&2<=i.length?i:[",","."],s=Ei(t,d),o=Ai(t,n,"short"),l=Ai(t,n,"long");return{_abbreviationsLong:l||cn.abbreviations,code:t,delimiters:{thousands:d,decimal:r},abbreviations:o||cn.abbreviations,digitGroupingStyle:!(null!==s&&void 0!==s)||!s.length?void 0:s,numeralSystem:"0123456789"===a||null===a||void 0===a?void 0:a.split("").map(bi),ordinal:cn.ordinal}}));Object.assign(t,{__proto__:null,format:wt,getLocaleFromPlatform:e=>Si(e),parse:(e,t)=>ci(e,t),round:(e,t,a)=>kn(e,t,a)},vt)})(ew,jQuery,luxon);
